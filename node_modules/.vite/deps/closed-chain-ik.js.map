{
  "version": 3,
  "sources": ["../../linear-solve/gauss-jordan.js", "../../gl-matrix/esm/common.js", "../../gl-matrix/esm/mat3.js", "../../gl-matrix/esm/mat4.js", "../../gl-matrix/esm/quat.js", "../../gl-matrix/esm/vec3.js", "../../gl-matrix/esm/vec4.js", "../../gl-matrix/esm/vec2.js", "../../closed-chain-ik/src/core/utils/quaternion.js", "../../closed-chain-ik/src/core/utils/constants.js", "../../closed-chain-ik/src/core/Frame.js", "../../closed-chain-ik/src/core/Link.js", "../../closed-chain-ik/src/core/utils/euler.js", "../../closed-chain-ik/src/core/utils/glmatrix.js", "../../closed-chain-ik/src/core/Joint.js", "../../closed-chain-ik/src/core/Goal.js", "../../closed-chain-ik/src/core/utils/solver.js", "../../closed-chain-ik/src/core/utils/matrix.js", "../../svd-js/build-es/svd.js", "../../closed-chain-ik/src/core/ChainSolver.js", "../../closed-chain-ik/src/core/utils/findRoots.js", "../../closed-chain-ik/src/core/MatrixPool.js", "../../closed-chain-ik/src/core/Solver.js", "../../closed-chain-ik/src/worker/serialize.js", "../../closed-chain-ik/src/worker/utils.js", "../../closed-chain-ik/src/worker/WorkerSolver.js", "../../three/examples/jsm/lines/LineSegmentsGeometry.js", "../../three/examples/jsm/lines/LineMaterial.js", "../../three/examples/jsm/lines/LineSegments2.js", "../../three/examples/jsm/lines/LineGeometry.js", "../../three/examples/jsm/lines/Line2.js", "../../closed-chain-ik/src/three/IKLinkHelper.js", "../../closed-chain-ik/src/three/IKJointHelper.js", "../../closed-chain-ik/src/three/IKRootsHelper.js", "../../closed-chain-ik/src/three/urdfHelpers.js"],
  "sourcesContent": ["/**\n * Gauss-Jordan elimination\n */\n\nvar linear = (function(){\n/**\n * Used internally to solve systems\n * If you want to solve A.x = B,\n * choose data=A and mirror=B.\n * mirror can be either an array representing a vector\n * or an array of arrays representing a matrix.\n */\nfunction Mat(data, mirror) {\n  // Clone the original matrix\n  this.data = new Array(data.length);\n  for (var i=0, cols=data[0].length; i<data.length; i++) {\n    this.data[i] = new Array(cols);\n    for(var j=0; j<cols; j++) {\n      this.data[i][j] = data[i][j];\n    }\n  }\n\n  if (mirror) {\n    if (typeof mirror[0] !== \"object\") {\n      for (var i=0; i<mirror.length; i++) {\n        mirror[i] = [mirror[i]];\n      }\n    }\n    this.mirror = new Mat(mirror);\n  }\n}\n\n/**\n * Swap lines i and j in the matrix\n */\nMat.prototype.swap = function (i, j) {\n  if (this.mirror) this.mirror.swap(i,j);\n  var tmp = this.data[i];\n  this.data[i] = this.data[j];\n  this.data[j] = tmp;\n}\n\n/**\n * Multiply line number i by l\n */\nMat.prototype.multline = function (i, l) {\n  if (this.mirror) this.mirror.multline(i,l);\n  var line = this.data[i];\n  for (var k=line.length-1; k>=0; k--) {\n    line[k] *= l;\n  }\n}\n\n/**\n * Add line number j multiplied by l to line number i\n */\nMat.prototype.addmul = function (i, j, l) {\n  if (this.mirror) this.mirror.addmul(i,j,l);\n  var lineI = this.data[i], lineJ = this.data[j];\n  for (var k=lineI.length-1; k>=0; k--) {\n    lineI[k] = lineI[k] + l*lineJ[k];\n  }\n}\n\n/**\n * Tests if line number i is composed only of zeroes\n */\nMat.prototype.hasNullLine = function (i) {\n  for (var j=0; j<this.data[i].length; j++) {\n    if (this.data[i][j] !== 0) {\n      return false;\n    }\n  }\n  return true;\n}\n\nMat.prototype.gauss = function() {\n  var pivot = 0,\n      lines = this.data.length,\n      columns = this.data[0].length,\n      nullLines = [];\n\n  for (var j=0; j<columns; j++) {\n    // Find the line on which there is the maximum value of column j\n    var maxValue = 0, maxLine = 0;\n    for (var k=pivot; k<lines; k++) {\n      var val = this.data[k][j];\n      if (Math.abs(val) > Math.abs(maxValue)) {\n        maxLine = k;\n        maxValue = val;\n      } \n    }\n    if (maxValue === 0) {\n      // The matrix is not invertible. The system may still have solutions.\n      nullLines.push(pivot);\n    } else {\n      // The value of the pivot is maxValue\n      this.multline(maxLine, 1/maxValue);\n      this.swap(maxLine, pivot);\n      for (var i=0; i<lines; i++) {\n        if (i !== pivot) {\n          this.addmul(i, pivot, -this.data[i][j]);\n        }\n      }\n    }\n    pivot++;\n  }\n\n  // Check that the system has null lines where it should\n  for (var i=0; i<nullLines.length; i++) {\n    if (!this.mirror.hasNullLine(nullLines[i])) {\n      throw new Error(\"singular matrix\");\n    }\n  }\n  return this.mirror.data;\n}\n\n/**\n * Solves A.x = b\n * @param A\n * @param b\n * @return x\n */\nexports.solve = function solve(A, b) {\n  var result = new Mat(A,b).gauss();\n  if (result.length > 0 && result[0].length === 1) {\n    // Convert Nx1 matrices to simple javascript arrays\n    for (var i=0; i<result.length; i++) result[i] = result[i][0];\n  }\n  return result;\n}\n\nfunction identity(n) {\n  var id = new Array(n);\n  for (var i=0; i<n; i++) {\n    id[i] = new Array(n);\n    for (var j=0; j<n; j++) {\n      id[i][j] = (i === j) ? 1 : 0;\n    }\n  }\n  return id;\n}\n\n/**\n * invert a matrix\n */\nexports.invert = function invert(A) {\n  return new Mat(A, identity(A.length)).gauss();\n}\n\nreturn exports;\n})();\n\nif (typeof module.exports === \"object\") module.exports = linear;\n", "/**\n * Common utilities\n * @module glMatrix\n */\n\n// Configuration Constants\nexport var EPSILON = 0.000001;\nexport var ARRAY_TYPE = typeof Float32Array !== \"undefined\" ? Float32Array : Array;\nexport var RANDOM = Math.random;\nexport var ANGLE_ORDER = \"zyx\";\n\n/**\n * Symmetric round\n * see https://www.npmjs.com/package/round-half-up-symmetric#user-content-detailed-background\n *\n * @param {Number} a value to round\n */\nexport function round(a) {\n  if (a >= 0) return Math.round(a);\n  return a % 0.5 === 0 ? Math.floor(a) : Math.round(a);\n}\n\n/**\n * Sets the type of array used when creating new vectors and matrices\n *\n * @param {Float32ArrayConstructor | ArrayConstructor} type Array type, such as Float32Array or Array\n */\nexport function setMatrixArrayType(type) {\n  ARRAY_TYPE = type;\n}\nvar degree = Math.PI / 180;\nvar radian = 180 / Math.PI;\n\n/**\n * Convert Degree To Radian\n *\n * @param {Number} a Angle in Degrees\n */\nexport function toRadian(a) {\n  return a * degree;\n}\n\n/**\n * Convert Radian To Degree\n *\n * @param {Number} a Angle in Radians\n */\nexport function toDegree(a) {\n  return a * radian;\n}\n\n/**\n * Tests whether or not the arguments have approximately the same value, within an absolute\n * or relative tolerance of glMatrix.EPSILON (an absolute tolerance is used for values less\n * than or equal to 1.0, and a relative tolerance is used for larger values)\n *\n * @param {Number} a          The first number to test.\n * @param {Number} b          The second number to test.\n * @param {Number} tolerance  Absolute or relative tolerance (default glMatrix.EPSILON)\n * @returns {Boolean} True if the numbers are approximately equal, false otherwise.\n */\nexport function equals(a, b) {\n  var tolerance = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : EPSILON;\n  return Math.abs(a - b) <= tolerance * Math.max(1, Math.abs(a), Math.abs(b));\n}", "import * as glMatrix from \"./common.js\";\n\n/**\n * 3x3 Matrix\n * @module mat3\n */\n\n/**\n * Creates a new identity mat3\n *\n * @returns {mat3} a new 3x3 matrix\n */\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(9);\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[5] = 0;\n    out[6] = 0;\n    out[7] = 0;\n  }\n  out[0] = 1;\n  out[4] = 1;\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Copies the upper-left 3x3 values into the given mat3.\n *\n * @param {mat3} out the receiving 3x3 matrix\n * @param {ReadonlyMat4} a   the source 4x4 matrix\n * @returns {mat3} out\n */\nexport function fromMat4(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[4];\n  out[4] = a[5];\n  out[5] = a[6];\n  out[6] = a[8];\n  out[7] = a[9];\n  out[8] = a[10];\n  return out;\n}\n\n/**\n * Creates a new mat3 initialized with values from an existing matrix\n *\n * @param {ReadonlyMat3} a matrix to clone\n * @returns {mat3} a new 3x3 matrix\n */\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(9);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  return out;\n}\n\n/**\n * Copy the values from one mat3 to another\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the source matrix\n * @returns {mat3} out\n */\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  return out;\n}\n\n/**\n * Create a new mat3 with the given values\n *\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m10 Component in column 1, row 0 position (index 3)\n * @param {Number} m11 Component in column 1, row 1 position (index 4)\n * @param {Number} m12 Component in column 1, row 2 position (index 5)\n * @param {Number} m20 Component in column 2, row 0 position (index 6)\n * @param {Number} m21 Component in column 2, row 1 position (index 7)\n * @param {Number} m22 Component in column 2, row 2 position (index 8)\n * @returns {mat3} A new mat3\n */\nexport function fromValues(m00, m01, m02, m10, m11, m12, m20, m21, m22) {\n  var out = new glMatrix.ARRAY_TYPE(9);\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m10;\n  out[4] = m11;\n  out[5] = m12;\n  out[6] = m20;\n  out[7] = m21;\n  out[8] = m22;\n  return out;\n}\n\n/**\n * Set the components of a mat3 to the given values\n *\n * @param {mat3} out the receiving matrix\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m10 Component in column 1, row 0 position (index 3)\n * @param {Number} m11 Component in column 1, row 1 position (index 4)\n * @param {Number} m12 Component in column 1, row 2 position (index 5)\n * @param {Number} m20 Component in column 2, row 0 position (index 6)\n * @param {Number} m21 Component in column 2, row 1 position (index 7)\n * @param {Number} m22 Component in column 2, row 2 position (index 8)\n * @returns {mat3} out\n */\nexport function set(out, m00, m01, m02, m10, m11, m12, m20, m21, m22) {\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m10;\n  out[4] = m11;\n  out[5] = m12;\n  out[6] = m20;\n  out[7] = m21;\n  out[8] = m22;\n  return out;\n}\n\n/**\n * Set a mat3 to the identity matrix\n *\n * @param {mat3} out the receiving matrix\n * @returns {mat3} out\n */\nexport function identity(out) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 1;\n  out[5] = 0;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Transpose the values of a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the source matrix\n * @returns {mat3} out\n */\nexport function transpose(out, a) {\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\n  if (out === a) {\n    var a01 = a[1],\n      a02 = a[2],\n      a12 = a[5];\n    out[1] = a[3];\n    out[2] = a[6];\n    out[3] = a01;\n    out[5] = a[7];\n    out[6] = a02;\n    out[7] = a12;\n  } else {\n    out[0] = a[0];\n    out[1] = a[3];\n    out[2] = a[6];\n    out[3] = a[1];\n    out[4] = a[4];\n    out[5] = a[7];\n    out[6] = a[2];\n    out[7] = a[5];\n    out[8] = a[8];\n  }\n  return out;\n}\n\n/**\n * Inverts a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the source matrix\n * @returns {mat3 | null} out, or null if source matrix is not invertible\n */\nexport function invert(out, a) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2];\n  var a10 = a[3],\n    a11 = a[4],\n    a12 = a[5];\n  var a20 = a[6],\n    a21 = a[7],\n    a22 = a[8];\n  var b01 = a22 * a11 - a12 * a21;\n  var b11 = -a22 * a10 + a12 * a20;\n  var b21 = a21 * a10 - a11 * a20;\n\n  // Calculate the determinant\n  var det = a00 * b01 + a01 * b11 + a02 * b21;\n  if (!det) {\n    return null;\n  }\n  det = 1.0 / det;\n  out[0] = b01 * det;\n  out[1] = (-a22 * a01 + a02 * a21) * det;\n  out[2] = (a12 * a01 - a02 * a11) * det;\n  out[3] = b11 * det;\n  out[4] = (a22 * a00 - a02 * a20) * det;\n  out[5] = (-a12 * a00 + a02 * a10) * det;\n  out[6] = b21 * det;\n  out[7] = (-a21 * a00 + a01 * a20) * det;\n  out[8] = (a11 * a00 - a01 * a10) * det;\n  return out;\n}\n\n/**\n * Calculates the adjugate of a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the source matrix\n * @returns {mat3} out\n */\nexport function adjoint(out, a) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2];\n  var a10 = a[3],\n    a11 = a[4],\n    a12 = a[5];\n  var a20 = a[6],\n    a21 = a[7],\n    a22 = a[8];\n  out[0] = a11 * a22 - a12 * a21;\n  out[1] = a02 * a21 - a01 * a22;\n  out[2] = a01 * a12 - a02 * a11;\n  out[3] = a12 * a20 - a10 * a22;\n  out[4] = a00 * a22 - a02 * a20;\n  out[5] = a02 * a10 - a00 * a12;\n  out[6] = a10 * a21 - a11 * a20;\n  out[7] = a01 * a20 - a00 * a21;\n  out[8] = a00 * a11 - a01 * a10;\n  return out;\n}\n\n/**\n * Calculates the determinant of a mat3\n *\n * @param {ReadonlyMat3} a the source matrix\n * @returns {Number} determinant of a\n */\nexport function determinant(a) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2];\n  var a10 = a[3],\n    a11 = a[4],\n    a12 = a[5];\n  var a20 = a[6],\n    a21 = a[7],\n    a22 = a[8];\n  return a00 * (a22 * a11 - a12 * a21) + a01 * (-a22 * a10 + a12 * a20) + a02 * (a21 * a10 - a11 * a20);\n}\n\n/**\n * Multiplies two mat3's\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the first operand\n * @param {ReadonlyMat3} b the second operand\n * @returns {mat3} out\n */\nexport function multiply(out, a, b) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2];\n  var a10 = a[3],\n    a11 = a[4],\n    a12 = a[5];\n  var a20 = a[6],\n    a21 = a[7],\n    a22 = a[8];\n  var b00 = b[0],\n    b01 = b[1],\n    b02 = b[2];\n  var b10 = b[3],\n    b11 = b[4],\n    b12 = b[5];\n  var b20 = b[6],\n    b21 = b[7],\n    b22 = b[8];\n  out[0] = b00 * a00 + b01 * a10 + b02 * a20;\n  out[1] = b00 * a01 + b01 * a11 + b02 * a21;\n  out[2] = b00 * a02 + b01 * a12 + b02 * a22;\n  out[3] = b10 * a00 + b11 * a10 + b12 * a20;\n  out[4] = b10 * a01 + b11 * a11 + b12 * a21;\n  out[5] = b10 * a02 + b11 * a12 + b12 * a22;\n  out[6] = b20 * a00 + b21 * a10 + b22 * a20;\n  out[7] = b20 * a01 + b21 * a11 + b22 * a21;\n  out[8] = b20 * a02 + b21 * a12 + b22 * a22;\n  return out;\n}\n\n/**\n * Translate a mat3 by the given vector\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the matrix to translate\n * @param {ReadonlyVec2} v vector to translate by\n * @returns {mat3} out\n */\nexport function translate(out, a, v) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2],\n    a10 = a[3],\n    a11 = a[4],\n    a12 = a[5],\n    a20 = a[6],\n    a21 = a[7],\n    a22 = a[8],\n    x = v[0],\n    y = v[1];\n  out[0] = a00;\n  out[1] = a01;\n  out[2] = a02;\n  out[3] = a10;\n  out[4] = a11;\n  out[5] = a12;\n  out[6] = x * a00 + y * a10 + a20;\n  out[7] = x * a01 + y * a11 + a21;\n  out[8] = x * a02 + y * a12 + a22;\n  return out;\n}\n\n/**\n * Rotates a mat3 by the given angle\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat3} out\n */\nexport function rotate(out, a, rad) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2],\n    a10 = a[3],\n    a11 = a[4],\n    a12 = a[5],\n    a20 = a[6],\n    a21 = a[7],\n    a22 = a[8],\n    s = Math.sin(rad),\n    c = Math.cos(rad);\n  out[0] = c * a00 + s * a10;\n  out[1] = c * a01 + s * a11;\n  out[2] = c * a02 + s * a12;\n  out[3] = c * a10 - s * a00;\n  out[4] = c * a11 - s * a01;\n  out[5] = c * a12 - s * a02;\n  out[6] = a20;\n  out[7] = a21;\n  out[8] = a22;\n  return out;\n}\n\n/**\n * Scales the mat3 by the dimensions in the given vec2\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the matrix to scale\n * @param {ReadonlyVec2} v the vec2 to scale the matrix by\n * @returns {mat3} out\n **/\nexport function scale(out, a, v) {\n  var x = v[0],\n    y = v[1];\n  out[0] = x * a[0];\n  out[1] = x * a[1];\n  out[2] = x * a[2];\n  out[3] = y * a[3];\n  out[4] = y * a[4];\n  out[5] = y * a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  return out;\n}\n\n/**\n * Creates a matrix from a vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat3.identity(dest);\n *     mat3.translate(dest, dest, vec);\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {ReadonlyVec2} v Translation vector\n * @returns {mat3} out\n */\nexport function fromTranslation(out, v) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 1;\n  out[5] = 0;\n  out[6] = v[0];\n  out[7] = v[1];\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from a given angle\n * This is equivalent to (but much faster than):\n *\n *     mat3.identity(dest);\n *     mat3.rotate(dest, dest, rad);\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat3} out\n */\nexport function fromRotation(out, rad) {\n  var s = Math.sin(rad),\n    c = Math.cos(rad);\n  out[0] = c;\n  out[1] = s;\n  out[2] = 0;\n  out[3] = -s;\n  out[4] = c;\n  out[5] = 0;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from a vector scaling\n * This is equivalent to (but much faster than):\n *\n *     mat3.identity(dest);\n *     mat3.scale(dest, dest, vec);\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {ReadonlyVec2} v Scaling vector\n * @returns {mat3} out\n */\nexport function fromScaling(out, v) {\n  out[0] = v[0];\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = v[1];\n  out[5] = 0;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Copies the values from a mat2d into a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat2d} a the matrix to copy\n * @returns {mat3} out\n **/\nexport function fromMat2d(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = 0;\n  out[3] = a[2];\n  out[4] = a[3];\n  out[5] = 0;\n  out[6] = a[4];\n  out[7] = a[5];\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Calculates a 3x3 matrix from the given quaternion\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {ReadonlyQuat} q Quaternion to create matrix from\n *\n * @returns {mat3} out\n */\nexport function fromQuat(out, q) {\n  var x = q[0],\n    y = q[1],\n    z = q[2],\n    w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var yx = y * x2;\n  var yy = y * y2;\n  var zx = z * x2;\n  var zy = z * y2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - yy - zz;\n  out[3] = yx - wz;\n  out[6] = zx + wy;\n  out[1] = yx + wz;\n  out[4] = 1 - xx - zz;\n  out[7] = zy - wx;\n  out[2] = zx - wy;\n  out[5] = zy + wx;\n  out[8] = 1 - xx - yy;\n  return out;\n}\n\n/**\n * Calculates a 3x3 normal matrix (transpose inverse) from the 4x4 matrix\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {ReadonlyMat4} a Mat4 to derive the normal matrix from\n *\n * @returns {mat3} out\n */\nexport function normalFromMat4(out, a) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2],\n    a03 = a[3];\n  var a10 = a[4],\n    a11 = a[5],\n    a12 = a[6],\n    a13 = a[7];\n  var a20 = a[8],\n    a21 = a[9],\n    a22 = a[10],\n    a23 = a[11];\n  var a30 = a[12],\n    a31 = a[13],\n    a32 = a[14],\n    a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32;\n\n  // Calculate the determinant\n  var det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n  if (!det) {\n    return null;\n  }\n  det = 1.0 / det;\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n  out[1] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n  out[2] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n  out[3] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n  out[4] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n  out[5] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n  out[6] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n  out[7] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n  out[8] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n  return out;\n}\n\n/**\n * Generates a 2D projection matrix with the given bounds\n *\n * @param {mat3} out mat3 frustum matrix will be written into\n * @param {number} width Width of your gl context\n * @param {number} height Height of gl context\n * @returns {mat3} out\n */\nexport function projection(out, width, height) {\n  out[0] = 2 / width;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = -2 / height;\n  out[5] = 0;\n  out[6] = -1;\n  out[7] = 1;\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Returns a string representation of a mat3\n *\n * @param {ReadonlyMat3} a matrix to represent as a string\n * @returns {String} string representation of the matrix\n */\nexport function str(a) {\n  return \"mat3(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \", \" + a[4] + \", \" + a[5] + \", \" + a[6] + \", \" + a[7] + \", \" + a[8] + \")\";\n}\n\n/**\n * Returns Frobenius norm of a mat3\n *\n * @param {ReadonlyMat3} a the matrix to calculate Frobenius norm of\n * @returns {Number} Frobenius norm\n */\nexport function frob(a) {\n  return Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2] + a[3] * a[3] + a[4] * a[4] + a[5] * a[5] + a[6] * a[6] + a[7] * a[7] + a[8] * a[8]);\n}\n\n/**\n * Adds two mat3's\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the first operand\n * @param {ReadonlyMat3} b the second operand\n * @returns {mat3} out\n */\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  out[4] = a[4] + b[4];\n  out[5] = a[5] + b[5];\n  out[6] = a[6] + b[6];\n  out[7] = a[7] + b[7];\n  out[8] = a[8] + b[8];\n  return out;\n}\n\n/**\n * Subtracts matrix b from matrix a\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the first operand\n * @param {ReadonlyMat3} b the second operand\n * @returns {mat3} out\n */\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  out[4] = a[4] - b[4];\n  out[5] = a[5] - b[5];\n  out[6] = a[6] - b[6];\n  out[7] = a[7] - b[7];\n  out[8] = a[8] - b[8];\n  return out;\n}\n\n/**\n * Multiply each element of the matrix by a scalar.\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the matrix to scale\n * @param {Number} b amount to scale the matrix's elements by\n * @returns {mat3} out\n */\nexport function multiplyScalar(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  out[4] = a[4] * b;\n  out[5] = a[5] * b;\n  out[6] = a[6] * b;\n  out[7] = a[7] * b;\n  out[8] = a[8] * b;\n  return out;\n}\n\n/**\n * Adds two mat3's after multiplying each element of the second operand by a scalar value.\n *\n * @param {mat3} out the receiving vector\n * @param {ReadonlyMat3} a the first operand\n * @param {ReadonlyMat3} b the second operand\n * @param {Number} scale the amount to scale b's elements by before adding\n * @returns {mat3} out\n */\nexport function multiplyScalarAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  out[3] = a[3] + b[3] * scale;\n  out[4] = a[4] + b[4] * scale;\n  out[5] = a[5] + b[5] * scale;\n  out[6] = a[6] + b[6] * scale;\n  out[7] = a[7] + b[7] * scale;\n  out[8] = a[8] + b[8] * scale;\n  return out;\n}\n\n/**\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyMat3} a The first matrix.\n * @param {ReadonlyMat3} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] && a[8] === b[8];\n}\n\n/**\n * Returns whether or not the matrices have approximately the same elements in the same position.\n *\n * @param {ReadonlyMat3} a The first matrix.\n * @param {ReadonlyMat3} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\nexport function equals(a, b) {\n  var a0 = a[0],\n    a1 = a[1],\n    a2 = a[2],\n    a3 = a[3],\n    a4 = a[4],\n    a5 = a[5],\n    a6 = a[6],\n    a7 = a[7],\n    a8 = a[8];\n  var b0 = b[0],\n    b1 = b[1],\n    b2 = b[2],\n    b3 = b[3],\n    b4 = b[4],\n    b5 = b[5],\n    b6 = b[6],\n    b7 = b[7],\n    b8 = b[8];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7)) && Math.abs(a8 - b8) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a8), Math.abs(b8));\n}\n\n/**\n * Alias for {@link mat3.multiply}\n * @function\n */\nexport var mul = multiply;\n\n/**\n * Alias for {@link mat3.subtract}\n * @function\n */\nexport var sub = subtract;", "import * as glMatrix from \"./common.js\";\n\n/**\n * 4x4 Matrix<br>Format: column-major, when typed out it looks like row-major<br>The matrices are being post multiplied.\n * @module mat4\n */\n\n/**\n * Creates a new identity mat4\n *\n * @returns {mat4} a new 4x4 matrix\n */\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = 0;\n    out[11] = 0;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = 0;\n  }\n  out[0] = 1;\n  out[5] = 1;\n  out[10] = 1;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a new mat4 initialized with values from an existing matrix\n *\n * @param {ReadonlyMat4} a matrix to clone\n * @returns {mat4} a new 4x4 matrix\n */\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n\n/**\n * Copy the values from one mat4 to another\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n\n/**\n * Create a new mat4 with the given values\n *\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\n * @returns {mat4} A new mat4\n */\nexport function fromValues(m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n\n/**\n * Set the components of a mat4 to the given values\n *\n * @param {mat4} out the receiving matrix\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\n * @returns {mat4} out\n */\nexport function set(out, m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n\n/**\n * Set a mat4 to the identity matrix\n *\n * @param {mat4} out the receiving matrix\n * @returns {mat4} out\n */\nexport function identity(out) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Transpose the values of a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\nexport function transpose(out, a) {\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\n  if (out === a) {\n    var a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n    var a12 = a[6],\n      a13 = a[7];\n    var a23 = a[11];\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a01;\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a02;\n    out[9] = a12;\n    out[11] = a[14];\n    out[12] = a03;\n    out[13] = a13;\n    out[14] = a23;\n  } else {\n    out[0] = a[0];\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a[1];\n    out[5] = a[5];\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a[2];\n    out[9] = a[6];\n    out[10] = a[10];\n    out[11] = a[14];\n    out[12] = a[3];\n    out[13] = a[7];\n    out[14] = a[11];\n    out[15] = a[15];\n  }\n  return out;\n}\n\n/**\n * Inverts a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4 | null} out, or null if source matrix is not invertible\n */\nexport function invert(out, a) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2],\n    a03 = a[3];\n  var a10 = a[4],\n    a11 = a[5],\n    a12 = a[6],\n    a13 = a[7];\n  var a20 = a[8],\n    a21 = a[9],\n    a22 = a[10],\n    a23 = a[11];\n  var a30 = a[12],\n    a31 = a[13],\n    a32 = a[14],\n    a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32;\n\n  // Calculate the determinant\n  var det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n  if (!det) {\n    return null;\n  }\n  det = 1.0 / det;\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n  out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n  out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n  out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;\n  out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n  out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n  out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n  out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;\n  out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n  out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n  out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n  out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;\n  out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;\n  out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;\n  out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;\n  out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;\n  return out;\n}\n\n/**\n * Calculates the adjugate of a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\nexport function adjoint(out, a) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2],\n    a03 = a[3];\n  var a10 = a[4],\n    a11 = a[5],\n    a12 = a[6],\n    a13 = a[7];\n  var a20 = a[8],\n    a21 = a[9],\n    a22 = a[10],\n    a23 = a[11];\n  var a30 = a[12],\n    a31 = a[13],\n    a32 = a[14],\n    a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32;\n  out[0] = a11 * b11 - a12 * b10 + a13 * b09;\n  out[1] = a02 * b10 - a01 * b11 - a03 * b09;\n  out[2] = a31 * b05 - a32 * b04 + a33 * b03;\n  out[3] = a22 * b04 - a21 * b05 - a23 * b03;\n  out[4] = a12 * b08 - a10 * b11 - a13 * b07;\n  out[5] = a00 * b11 - a02 * b08 + a03 * b07;\n  out[6] = a32 * b02 - a30 * b05 - a33 * b01;\n  out[7] = a20 * b05 - a22 * b02 + a23 * b01;\n  out[8] = a10 * b10 - a11 * b08 + a13 * b06;\n  out[9] = a01 * b08 - a00 * b10 - a03 * b06;\n  out[10] = a30 * b04 - a31 * b02 + a33 * b00;\n  out[11] = a21 * b02 - a20 * b04 - a23 * b00;\n  out[12] = a11 * b07 - a10 * b09 - a12 * b06;\n  out[13] = a00 * b09 - a01 * b07 + a02 * b06;\n  out[14] = a31 * b01 - a30 * b03 - a32 * b00;\n  out[15] = a20 * b03 - a21 * b01 + a22 * b00;\n  return out;\n}\n\n/**\n * Calculates the determinant of a mat4\n *\n * @param {ReadonlyMat4} a the source matrix\n * @returns {Number} determinant of a\n */\nexport function determinant(a) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2],\n    a03 = a[3];\n  var a10 = a[4],\n    a11 = a[5],\n    a12 = a[6],\n    a13 = a[7];\n  var a20 = a[8],\n    a21 = a[9],\n    a22 = a[10],\n    a23 = a[11];\n  var a30 = a[12],\n    a31 = a[13],\n    a32 = a[14],\n    a33 = a[15];\n  var b0 = a00 * a11 - a01 * a10;\n  var b1 = a00 * a12 - a02 * a10;\n  var b2 = a01 * a12 - a02 * a11;\n  var b3 = a20 * a31 - a21 * a30;\n  var b4 = a20 * a32 - a22 * a30;\n  var b5 = a21 * a32 - a22 * a31;\n  var b6 = a00 * b5 - a01 * b4 + a02 * b3;\n  var b7 = a10 * b5 - a11 * b4 + a12 * b3;\n  var b8 = a20 * b2 - a21 * b1 + a22 * b0;\n  var b9 = a30 * b2 - a31 * b1 + a32 * b0;\n\n  // Calculate the determinant\n  return a13 * b6 - a03 * b7 + a33 * b8 - a23 * b9;\n}\n\n/**\n * Multiplies two mat4s\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\nexport function multiply(out, a, b) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2],\n    a03 = a[3];\n  var a10 = a[4],\n    a11 = a[5],\n    a12 = a[6],\n    a13 = a[7];\n  var a20 = a[8],\n    a21 = a[9],\n    a22 = a[10],\n    a23 = a[11];\n  var a30 = a[12],\n    a31 = a[13],\n    a32 = a[14],\n    a33 = a[15];\n\n  // Cache only the current line of the second matrix\n  var b0 = b[0],\n    b1 = b[1],\n    b2 = b[2],\n    b3 = b[3];\n  out[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[4];\n  b1 = b[5];\n  b2 = b[6];\n  b3 = b[7];\n  out[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[8];\n  b1 = b[9];\n  b2 = b[10];\n  b3 = b[11];\n  out[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[12];\n  b1 = b[13];\n  b2 = b[14];\n  b3 = b[15];\n  out[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  return out;\n}\n\n/**\n * Translate a mat4 by the given vector\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to translate\n * @param {ReadonlyVec3} v vector to translate by\n * @returns {mat4} out\n */\nexport function translate(out, a, v) {\n  var x = v[0],\n    y = v[1],\n    z = v[2];\n  var a00, a01, a02, a03;\n  var a10, a11, a12, a13;\n  var a20, a21, a22, a23;\n  if (a === out) {\n    out[12] = a[0] * x + a[4] * y + a[8] * z + a[12];\n    out[13] = a[1] * x + a[5] * y + a[9] * z + a[13];\n    out[14] = a[2] * x + a[6] * y + a[10] * z + a[14];\n    out[15] = a[3] * x + a[7] * y + a[11] * z + a[15];\n  } else {\n    a00 = a[0];\n    a01 = a[1];\n    a02 = a[2];\n    a03 = a[3];\n    a10 = a[4];\n    a11 = a[5];\n    a12 = a[6];\n    a13 = a[7];\n    a20 = a[8];\n    a21 = a[9];\n    a22 = a[10];\n    a23 = a[11];\n    out[0] = a00;\n    out[1] = a01;\n    out[2] = a02;\n    out[3] = a03;\n    out[4] = a10;\n    out[5] = a11;\n    out[6] = a12;\n    out[7] = a13;\n    out[8] = a20;\n    out[9] = a21;\n    out[10] = a22;\n    out[11] = a23;\n    out[12] = a00 * x + a10 * y + a20 * z + a[12];\n    out[13] = a01 * x + a11 * y + a21 * z + a[13];\n    out[14] = a02 * x + a12 * y + a22 * z + a[14];\n    out[15] = a03 * x + a13 * y + a23 * z + a[15];\n  }\n  return out;\n}\n\n/**\n * Scales the mat4 by the dimensions in the given vec3 not using vectorization\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to scale\n * @param {ReadonlyVec3} v the vec3 to scale the matrix by\n * @returns {mat4} out\n **/\nexport function scale(out, a, v) {\n  var x = v[0],\n    y = v[1],\n    z = v[2];\n  out[0] = a[0] * x;\n  out[1] = a[1] * x;\n  out[2] = a[2] * x;\n  out[3] = a[3] * x;\n  out[4] = a[4] * y;\n  out[5] = a[5] * y;\n  out[6] = a[6] * y;\n  out[7] = a[7] * y;\n  out[8] = a[8] * z;\n  out[9] = a[9] * z;\n  out[10] = a[10] * z;\n  out[11] = a[11] * z;\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n\n/**\n * Rotates a mat4 by the given angle around the given axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @param {ReadonlyVec3} axis the axis to rotate around\n * @returns {mat4} out\n */\nexport function rotate(out, a, rad, axis) {\n  var x = axis[0],\n    y = axis[1],\n    z = axis[2];\n  var len = Math.sqrt(x * x + y * y + z * z);\n  var s, c, t;\n  var a00, a01, a02, a03;\n  var a10, a11, a12, a13;\n  var a20, a21, a22, a23;\n  var b00, b01, b02;\n  var b10, b11, b12;\n  var b20, b21, b22;\n  if (len < glMatrix.EPSILON) {\n    return null;\n  }\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c;\n  a00 = a[0];\n  a01 = a[1];\n  a02 = a[2];\n  a03 = a[3];\n  a10 = a[4];\n  a11 = a[5];\n  a12 = a[6];\n  a13 = a[7];\n  a20 = a[8];\n  a21 = a[9];\n  a22 = a[10];\n  a23 = a[11];\n\n  // Construct the elements of the rotation matrix\n  b00 = x * x * t + c;\n  b01 = y * x * t + z * s;\n  b02 = z * x * t - y * s;\n  b10 = x * y * t - z * s;\n  b11 = y * y * t + c;\n  b12 = z * y * t + x * s;\n  b20 = x * z * t + y * s;\n  b21 = y * z * t - x * s;\n  b22 = z * z * t + c;\n\n  // Perform rotation-specific matrix multiplication\n  out[0] = a00 * b00 + a10 * b01 + a20 * b02;\n  out[1] = a01 * b00 + a11 * b01 + a21 * b02;\n  out[2] = a02 * b00 + a12 * b01 + a22 * b02;\n  out[3] = a03 * b00 + a13 * b01 + a23 * b02;\n  out[4] = a00 * b10 + a10 * b11 + a20 * b12;\n  out[5] = a01 * b10 + a11 * b11 + a21 * b12;\n  out[6] = a02 * b10 + a12 * b11 + a22 * b12;\n  out[7] = a03 * b10 + a13 * b11 + a23 * b12;\n  out[8] = a00 * b20 + a10 * b21 + a20 * b22;\n  out[9] = a01 * b20 + a11 * b21 + a21 * b22;\n  out[10] = a02 * b20 + a12 * b21 + a22 * b22;\n  out[11] = a03 * b20 + a13 * b21 + a23 * b22;\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged last row\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n  return out;\n}\n\n/**\n * Rotates a matrix by the given angle around the X axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function rotateX(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a10 = a[4];\n  var a11 = a[5];\n  var a12 = a[6];\n  var a13 = a[7];\n  var a20 = a[8];\n  var a21 = a[9];\n  var a22 = a[10];\n  var a23 = a[11];\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged rows\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    out[3] = a[3];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n\n  // Perform axis-specific matrix multiplication\n  out[4] = a10 * c + a20 * s;\n  out[5] = a11 * c + a21 * s;\n  out[6] = a12 * c + a22 * s;\n  out[7] = a13 * c + a23 * s;\n  out[8] = a20 * c - a10 * s;\n  out[9] = a21 * c - a11 * s;\n  out[10] = a22 * c - a12 * s;\n  out[11] = a23 * c - a13 * s;\n  return out;\n}\n\n/**\n * Rotates a matrix by the given angle around the Y axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function rotateY(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a00 = a[0];\n  var a01 = a[1];\n  var a02 = a[2];\n  var a03 = a[3];\n  var a20 = a[8];\n  var a21 = a[9];\n  var a22 = a[10];\n  var a23 = a[11];\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged rows\n    out[4] = a[4];\n    out[5] = a[5];\n    out[6] = a[6];\n    out[7] = a[7];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n\n  // Perform axis-specific matrix multiplication\n  out[0] = a00 * c - a20 * s;\n  out[1] = a01 * c - a21 * s;\n  out[2] = a02 * c - a22 * s;\n  out[3] = a03 * c - a23 * s;\n  out[8] = a00 * s + a20 * c;\n  out[9] = a01 * s + a21 * c;\n  out[10] = a02 * s + a22 * c;\n  out[11] = a03 * s + a23 * c;\n  return out;\n}\n\n/**\n * Rotates a matrix by the given angle around the Z axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function rotateZ(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a00 = a[0];\n  var a01 = a[1];\n  var a02 = a[2];\n  var a03 = a[3];\n  var a10 = a[4];\n  var a11 = a[5];\n  var a12 = a[6];\n  var a13 = a[7];\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged last row\n    out[8] = a[8];\n    out[9] = a[9];\n    out[10] = a[10];\n    out[11] = a[11];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n\n  // Perform axis-specific matrix multiplication\n  out[0] = a00 * c + a10 * s;\n  out[1] = a01 * c + a11 * s;\n  out[2] = a02 * c + a12 * s;\n  out[3] = a03 * c + a13 * s;\n  out[4] = a10 * c - a00 * s;\n  out[5] = a11 * c - a01 * s;\n  out[6] = a12 * c - a02 * s;\n  out[7] = a13 * c - a03 * s;\n  return out;\n}\n\n/**\n * Creates a matrix from a vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, dest, vec);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyVec3} v Translation vector\n * @returns {mat4} out\n */\nexport function fromTranslation(out, v) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from a vector scaling\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.scale(dest, dest, vec);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyVec3} v Scaling vector\n * @returns {mat4} out\n */\nexport function fromScaling(out, v) {\n  out[0] = v[0];\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = v[1];\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = v[2];\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from a given angle around a given axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotate(dest, dest, rad, axis);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @param {ReadonlyVec3} axis the axis to rotate around\n * @returns {mat4} out\n */\nexport function fromRotation(out, rad, axis) {\n  var x = axis[0],\n    y = axis[1],\n    z = axis[2];\n  var len = Math.sqrt(x * x + y * y + z * z);\n  var s, c, t;\n  if (len < glMatrix.EPSILON) {\n    return null;\n  }\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c;\n\n  // Perform rotation-specific matrix multiplication\n  out[0] = x * x * t + c;\n  out[1] = y * x * t + z * s;\n  out[2] = z * x * t - y * s;\n  out[3] = 0;\n  out[4] = x * y * t - z * s;\n  out[5] = y * y * t + c;\n  out[6] = z * y * t + x * s;\n  out[7] = 0;\n  out[8] = x * z * t + y * s;\n  out[9] = y * z * t - x * s;\n  out[10] = z * z * t + c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from the given angle around the X axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateX(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function fromXRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n\n  // Perform axis-specific matrix multiplication\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = c;\n  out[6] = s;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = -s;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from the given angle around the Y axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateY(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function fromYRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n\n  // Perform axis-specific matrix multiplication\n  out[0] = c;\n  out[1] = 0;\n  out[2] = -s;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = s;\n  out[9] = 0;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from the given angle around the Z axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateZ(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function fromZRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n\n  // Perform axis-specific matrix multiplication\n  out[0] = c;\n  out[1] = s;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = -s;\n  out[5] = c;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from a quaternion rotation and vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, dest, vec);\n *     let quatMat = mat4.create();\n *     mat4.fromQuat(quatMat, quat);\n *     mat4.multiply(dest, dest, quatMat);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @returns {mat4} out\n */\nexport function fromRotationTranslation(out, q, v) {\n  // Quaternion math\n  var x = q[0],\n    y = q[1],\n    z = q[2],\n    w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - (yy + zz);\n  out[1] = xy + wz;\n  out[2] = xz - wy;\n  out[3] = 0;\n  out[4] = xy - wz;\n  out[5] = 1 - (xx + zz);\n  out[6] = yz + wx;\n  out[7] = 0;\n  out[8] = xz + wy;\n  out[9] = yz - wx;\n  out[10] = 1 - (xx + yy);\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a new mat4 from a dual quat.\n *\n * @param {mat4} out Matrix\n * @param {ReadonlyQuat2} a Dual Quaternion\n * @returns {mat4} mat4 receiving operation result\n */\nexport function fromQuat2(out, a) {\n  var translation = new glMatrix.ARRAY_TYPE(3);\n  var bx = -a[0],\n    by = -a[1],\n    bz = -a[2],\n    bw = a[3],\n    ax = a[4],\n    ay = a[5],\n    az = a[6],\n    aw = a[7];\n  var magnitude = bx * bx + by * by + bz * bz + bw * bw;\n  //Only scale if it makes sense\n  if (magnitude > 0) {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2 / magnitude;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2 / magnitude;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2 / magnitude;\n  } else {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2;\n  }\n  fromRotationTranslation(out, a, translation);\n  return out;\n}\n\n/**\n * Returns the translation vector component of a transformation\n *  matrix. If a matrix is built with fromRotationTranslation,\n *  the returned vector will be the same as the translation vector\n *  originally supplied.\n * @param  {vec3} out Vector to receive translation component\n * @param  {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {vec3} out\n */\nexport function getTranslation(out, mat) {\n  out[0] = mat[12];\n  out[1] = mat[13];\n  out[2] = mat[14];\n  return out;\n}\n\n/**\n * Returns the scaling factor component of a transformation\n *  matrix. If a matrix is built with fromRotationTranslationScale\n *  with a normalized Quaternion parameter, the returned vector will be\n *  the same as the scaling vector\n *  originally supplied.\n * @param  {vec3} out Vector to receive scaling factor component\n * @param  {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {vec3} out\n */\nexport function getScaling(out, mat) {\n  var m11 = mat[0];\n  var m12 = mat[1];\n  var m13 = mat[2];\n  var m21 = mat[4];\n  var m22 = mat[5];\n  var m23 = mat[6];\n  var m31 = mat[8];\n  var m32 = mat[9];\n  var m33 = mat[10];\n  out[0] = Math.sqrt(m11 * m11 + m12 * m12 + m13 * m13);\n  out[1] = Math.sqrt(m21 * m21 + m22 * m22 + m23 * m23);\n  out[2] = Math.sqrt(m31 * m31 + m32 * m32 + m33 * m33);\n  return out;\n}\n\n/**\n * Returns a quaternion representing the rotational component\n *  of a transformation matrix. If a matrix is built with\n *  fromRotationTranslation, the returned quaternion will be the\n *  same as the quaternion originally supplied.\n * @param {quat} out Quaternion to receive the rotation component\n * @param {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {quat} out\n */\nexport function getRotation(out, mat) {\n  var scaling = new glMatrix.ARRAY_TYPE(3);\n  getScaling(scaling, mat);\n  var is1 = 1 / scaling[0];\n  var is2 = 1 / scaling[1];\n  var is3 = 1 / scaling[2];\n  var sm11 = mat[0] * is1;\n  var sm12 = mat[1] * is2;\n  var sm13 = mat[2] * is3;\n  var sm21 = mat[4] * is1;\n  var sm22 = mat[5] * is2;\n  var sm23 = mat[6] * is3;\n  var sm31 = mat[8] * is1;\n  var sm32 = mat[9] * is2;\n  var sm33 = mat[10] * is3;\n  var trace = sm11 + sm22 + sm33;\n  var S = 0;\n  if (trace > 0) {\n    S = Math.sqrt(trace + 1.0) * 2;\n    out[3] = 0.25 * S;\n    out[0] = (sm23 - sm32) / S;\n    out[1] = (sm31 - sm13) / S;\n    out[2] = (sm12 - sm21) / S;\n  } else if (sm11 > sm22 && sm11 > sm33) {\n    S = Math.sqrt(1.0 + sm11 - sm22 - sm33) * 2;\n    out[3] = (sm23 - sm32) / S;\n    out[0] = 0.25 * S;\n    out[1] = (sm12 + sm21) / S;\n    out[2] = (sm31 + sm13) / S;\n  } else if (sm22 > sm33) {\n    S = Math.sqrt(1.0 + sm22 - sm11 - sm33) * 2;\n    out[3] = (sm31 - sm13) / S;\n    out[0] = (sm12 + sm21) / S;\n    out[1] = 0.25 * S;\n    out[2] = (sm23 + sm32) / S;\n  } else {\n    S = Math.sqrt(1.0 + sm33 - sm11 - sm22) * 2;\n    out[3] = (sm12 - sm21) / S;\n    out[0] = (sm31 + sm13) / S;\n    out[1] = (sm23 + sm32) / S;\n    out[2] = 0.25 * S;\n  }\n  return out;\n}\n\n/**\n * Decomposes a transformation matrix into its rotation, translation\n * and scale components. Returns only the rotation component\n * @param  {quat} out_r Quaternion to receive the rotation component\n * @param  {vec3} out_t Vector to receive the translation vector\n * @param  {vec3} out_s Vector to receive the scaling factor\n * @param  {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @returns {quat} out_r\n */\nexport function decompose(out_r, out_t, out_s, mat) {\n  out_t[0] = mat[12];\n  out_t[1] = mat[13];\n  out_t[2] = mat[14];\n  var m11 = mat[0];\n  var m12 = mat[1];\n  var m13 = mat[2];\n  var m21 = mat[4];\n  var m22 = mat[5];\n  var m23 = mat[6];\n  var m31 = mat[8];\n  var m32 = mat[9];\n  var m33 = mat[10];\n  out_s[0] = Math.sqrt(m11 * m11 + m12 * m12 + m13 * m13);\n  out_s[1] = Math.sqrt(m21 * m21 + m22 * m22 + m23 * m23);\n  out_s[2] = Math.sqrt(m31 * m31 + m32 * m32 + m33 * m33);\n  var is1 = 1 / out_s[0];\n  var is2 = 1 / out_s[1];\n  var is3 = 1 / out_s[2];\n  var sm11 = m11 * is1;\n  var sm12 = m12 * is2;\n  var sm13 = m13 * is3;\n  var sm21 = m21 * is1;\n  var sm22 = m22 * is2;\n  var sm23 = m23 * is3;\n  var sm31 = m31 * is1;\n  var sm32 = m32 * is2;\n  var sm33 = m33 * is3;\n  var trace = sm11 + sm22 + sm33;\n  var S = 0;\n  if (trace > 0) {\n    S = Math.sqrt(trace + 1.0) * 2;\n    out_r[3] = 0.25 * S;\n    out_r[0] = (sm23 - sm32) / S;\n    out_r[1] = (sm31 - sm13) / S;\n    out_r[2] = (sm12 - sm21) / S;\n  } else if (sm11 > sm22 && sm11 > sm33) {\n    S = Math.sqrt(1.0 + sm11 - sm22 - sm33) * 2;\n    out_r[3] = (sm23 - sm32) / S;\n    out_r[0] = 0.25 * S;\n    out_r[1] = (sm12 + sm21) / S;\n    out_r[2] = (sm31 + sm13) / S;\n  } else if (sm22 > sm33) {\n    S = Math.sqrt(1.0 + sm22 - sm11 - sm33) * 2;\n    out_r[3] = (sm31 - sm13) / S;\n    out_r[0] = (sm12 + sm21) / S;\n    out_r[1] = 0.25 * S;\n    out_r[2] = (sm23 + sm32) / S;\n  } else {\n    S = Math.sqrt(1.0 + sm33 - sm11 - sm22) * 2;\n    out_r[3] = (sm12 - sm21) / S;\n    out_r[0] = (sm31 + sm13) / S;\n    out_r[1] = (sm23 + sm32) / S;\n    out_r[2] = 0.25 * S;\n  }\n  return out_r;\n}\n\n/**\n * Creates a matrix from a quaternion rotation, vector translation and vector scale\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, dest, vec);\n *     let quatMat = mat4.create();\n *     mat4.fromQuat(quatMat, quat);\n *     mat4.multiply(dest, dest, quatMat);\n *     mat4.scale(dest, dest, scale)\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @param {ReadonlyVec3} s Scaling vector\n * @returns {mat4} out\n */\nexport function fromRotationTranslationScale(out, q, v, s) {\n  // Quaternion math\n  var x = q[0],\n    y = q[1],\n    z = q[2],\n    w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  var sx = s[0];\n  var sy = s[1];\n  var sz = s[2];\n  out[0] = (1 - (yy + zz)) * sx;\n  out[1] = (xy + wz) * sx;\n  out[2] = (xz - wy) * sx;\n  out[3] = 0;\n  out[4] = (xy - wz) * sy;\n  out[5] = (1 - (xx + zz)) * sy;\n  out[6] = (yz + wx) * sy;\n  out[7] = 0;\n  out[8] = (xz + wy) * sz;\n  out[9] = (yz - wx) * sz;\n  out[10] = (1 - (xx + yy)) * sz;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from a quaternion rotation, vector translation and vector scale, rotating and scaling around the given origin\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, dest, vec);\n *     mat4.translate(dest, dest, origin);\n *     let quatMat = mat4.create();\n *     mat4.fromQuat(quatMat, quat);\n *     mat4.multiply(dest, dest, quatMat);\n *     mat4.scale(dest, dest, scale)\n *     mat4.translate(dest, dest, negativeOrigin);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @param {ReadonlyVec3} s Scaling vector\n * @param {ReadonlyVec3} o The origin vector around which to scale and rotate\n * @returns {mat4} out\n */\nexport function fromRotationTranslationScaleOrigin(out, q, v, s, o) {\n  // Quaternion math\n  var x = q[0],\n    y = q[1],\n    z = q[2],\n    w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  var sx = s[0];\n  var sy = s[1];\n  var sz = s[2];\n  var ox = o[0];\n  var oy = o[1];\n  var oz = o[2];\n  var out0 = (1 - (yy + zz)) * sx;\n  var out1 = (xy + wz) * sx;\n  var out2 = (xz - wy) * sx;\n  var out4 = (xy - wz) * sy;\n  var out5 = (1 - (xx + zz)) * sy;\n  var out6 = (yz + wx) * sy;\n  var out8 = (xz + wy) * sz;\n  var out9 = (yz - wx) * sz;\n  var out10 = (1 - (xx + yy)) * sz;\n  out[0] = out0;\n  out[1] = out1;\n  out[2] = out2;\n  out[3] = 0;\n  out[4] = out4;\n  out[5] = out5;\n  out[6] = out6;\n  out[7] = 0;\n  out[8] = out8;\n  out[9] = out9;\n  out[10] = out10;\n  out[11] = 0;\n  out[12] = v[0] + ox - (out0 * ox + out4 * oy + out8 * oz);\n  out[13] = v[1] + oy - (out1 * ox + out5 * oy + out9 * oz);\n  out[14] = v[2] + oz - (out2 * ox + out6 * oy + out10 * oz);\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Calculates a 4x4 matrix from the given quaternion\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyQuat} q Quaternion to create matrix from\n *\n * @returns {mat4} out\n */\nexport function fromQuat(out, q) {\n  var x = q[0],\n    y = q[1],\n    z = q[2],\n    w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var yx = y * x2;\n  var yy = y * y2;\n  var zx = z * x2;\n  var zy = z * y2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - yy - zz;\n  out[1] = yx + wz;\n  out[2] = zx - wy;\n  out[3] = 0;\n  out[4] = yx - wz;\n  out[5] = 1 - xx - zz;\n  out[6] = zy + wx;\n  out[7] = 0;\n  out[8] = zx + wy;\n  out[9] = zy - wx;\n  out[10] = 1 - xx - yy;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Generates a frustum matrix with the given bounds\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {Number} left Left bound of the frustum\n * @param {Number} right Right bound of the frustum\n * @param {Number} bottom Bottom bound of the frustum\n * @param {Number} top Top bound of the frustum\n * @param {Number} near Near bound of the frustum\n * @param {Number} far Far bound of the frustum\n * @returns {mat4} out\n */\nexport function frustum(out, left, right, bottom, top, near, far) {\n  var rl = 1 / (right - left);\n  var tb = 1 / (top - bottom);\n  var nf = 1 / (near - far);\n  out[0] = near * 2 * rl;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = near * 2 * tb;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = (right + left) * rl;\n  out[9] = (top + bottom) * tb;\n  out[10] = (far + near) * nf;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = far * near * 2 * nf;\n  out[15] = 0;\n  return out;\n}\n\n/**\n * Generates a perspective projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [-1, 1],\n * which matches WebGL/OpenGL's clip volume.\n * Passing null/undefined/no value for far will generate infinite projection matrix.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} fovy Vertical field of view in radians\n * @param {number} aspect Aspect ratio. typically viewport width/height\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum, can be null or Infinity\n * @returns {mat4} out\n */\nexport function perspectiveNO(out, fovy, aspect, near, far) {\n  var f = 1.0 / Math.tan(fovy / 2);\n  out[0] = f / aspect;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = f;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[15] = 0;\n  if (far != null && far !== Infinity) {\n    var nf = 1 / (near - far);\n    out[10] = (far + near) * nf;\n    out[14] = 2 * far * near * nf;\n  } else {\n    out[10] = -1;\n    out[14] = -2 * near;\n  }\n  return out;\n}\n\n/**\n * Alias for {@link mat4.perspectiveNO}\n * @function\n */\nexport var perspective = perspectiveNO;\n\n/**\n * Generates a perspective projection matrix suitable for WebGPU with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [0, 1],\n * which matches WebGPU/Vulkan/DirectX/Metal's clip volume.\n * Passing null/undefined/no value for far will generate infinite projection matrix.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} fovy Vertical field of view in radians\n * @param {number} aspect Aspect ratio. typically viewport width/height\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum, can be null or Infinity\n * @returns {mat4} out\n */\nexport function perspectiveZO(out, fovy, aspect, near, far) {\n  var f = 1.0 / Math.tan(fovy / 2);\n  out[0] = f / aspect;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = f;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[15] = 0;\n  if (far != null && far !== Infinity) {\n    var nf = 1 / (near - far);\n    out[10] = far * nf;\n    out[14] = far * near * nf;\n  } else {\n    out[10] = -1;\n    out[14] = -near;\n  }\n  return out;\n}\n\n/**\n * Generates a perspective projection matrix with the given field of view.\n * This is primarily useful for generating projection matrices to be used\n * with the still experiemental WebVR API.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {Object} fov Object containing the following values: upDegrees, downDegrees, leftDegrees, rightDegrees\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\nexport function perspectiveFromFieldOfView(out, fov, near, far) {\n  var upTan = Math.tan(fov.upDegrees * Math.PI / 180.0);\n  var downTan = Math.tan(fov.downDegrees * Math.PI / 180.0);\n  var leftTan = Math.tan(fov.leftDegrees * Math.PI / 180.0);\n  var rightTan = Math.tan(fov.rightDegrees * Math.PI / 180.0);\n  var xScale = 2.0 / (leftTan + rightTan);\n  var yScale = 2.0 / (upTan + downTan);\n  out[0] = xScale;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  out[3] = 0.0;\n  out[4] = 0.0;\n  out[5] = yScale;\n  out[6] = 0.0;\n  out[7] = 0.0;\n  out[8] = -((leftTan - rightTan) * xScale * 0.5);\n  out[9] = (upTan - downTan) * yScale * 0.5;\n  out[10] = far / (near - far);\n  out[11] = -1.0;\n  out[12] = 0.0;\n  out[13] = 0.0;\n  out[14] = far * near / (near - far);\n  out[15] = 0.0;\n  return out;\n}\n\n/**\n * Generates a orthogonal projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [-1, 1],\n * which matches WebGL/OpenGL's clip volume.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} left Left bound of the frustum\n * @param {number} right Right bound of the frustum\n * @param {number} bottom Bottom bound of the frustum\n * @param {number} top Top bound of the frustum\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\nexport function orthoNO(out, left, right, bottom, top, near, far) {\n  var lr = 1 / (left - right);\n  var bt = 1 / (bottom - top);\n  var nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 2 * nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = (far + near) * nf;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Alias for {@link mat4.orthoNO}\n * @function\n */\nexport var ortho = orthoNO;\n\n/**\n * Generates a orthogonal projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [0, 1],\n * which matches WebGPU/Vulkan/DirectX/Metal's clip volume.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} left Left bound of the frustum\n * @param {number} right Right bound of the frustum\n * @param {number} bottom Bottom bound of the frustum\n * @param {number} top Top bound of the frustum\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\nexport function orthoZO(out, left, right, bottom, top, near, far) {\n  var lr = 1 / (left - right);\n  var bt = 1 / (bottom - top);\n  var nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = near * nf;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Generates a look-at matrix with the given eye position, focal point, and up axis.\n * If you want a matrix that actually makes an object look at another object, you should use targetTo instead.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {ReadonlyVec3} eye Position of the viewer\n * @param {ReadonlyVec3} center Point the viewer is looking at\n * @param {ReadonlyVec3} up vec3 pointing up\n * @returns {mat4} out\n */\nexport function lookAt(out, eye, center, up) {\n  var x0, x1, x2, y0, y1, y2, z0, z1, z2, len;\n  var eyex = eye[0];\n  var eyey = eye[1];\n  var eyez = eye[2];\n  var upx = up[0];\n  var upy = up[1];\n  var upz = up[2];\n  var centerx = center[0];\n  var centery = center[1];\n  var centerz = center[2];\n  if (Math.abs(eyex - centerx) < glMatrix.EPSILON && Math.abs(eyey - centery) < glMatrix.EPSILON && Math.abs(eyez - centerz) < glMatrix.EPSILON) {\n    return identity(out);\n  }\n  z0 = eyex - centerx;\n  z1 = eyey - centery;\n  z2 = eyez - centerz;\n  len = 1 / Math.sqrt(z0 * z0 + z1 * z1 + z2 * z2);\n  z0 *= len;\n  z1 *= len;\n  z2 *= len;\n  x0 = upy * z2 - upz * z1;\n  x1 = upz * z0 - upx * z2;\n  x2 = upx * z1 - upy * z0;\n  len = Math.sqrt(x0 * x0 + x1 * x1 + x2 * x2);\n  if (!len) {\n    x0 = 0;\n    x1 = 0;\n    x2 = 0;\n  } else {\n    len = 1 / len;\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n  y0 = z1 * x2 - z2 * x1;\n  y1 = z2 * x0 - z0 * x2;\n  y2 = z0 * x1 - z1 * x0;\n  len = Math.sqrt(y0 * y0 + y1 * y1 + y2 * y2);\n  if (!len) {\n    y0 = 0;\n    y1 = 0;\n    y2 = 0;\n  } else {\n    len = 1 / len;\n    y0 *= len;\n    y1 *= len;\n    y2 *= len;\n  }\n  out[0] = x0;\n  out[1] = y0;\n  out[2] = z0;\n  out[3] = 0;\n  out[4] = x1;\n  out[5] = y1;\n  out[6] = z1;\n  out[7] = 0;\n  out[8] = x2;\n  out[9] = y2;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = -(x0 * eyex + x1 * eyey + x2 * eyez);\n  out[13] = -(y0 * eyex + y1 * eyey + y2 * eyez);\n  out[14] = -(z0 * eyex + z1 * eyey + z2 * eyez);\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Generates a matrix that makes something look at something else.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {ReadonlyVec3} eye Position of the viewer\n * @param {ReadonlyVec3} target Point the viewer is looking at\n * @param {ReadonlyVec3} up vec3 pointing up\n * @returns {mat4} out\n */\nexport function targetTo(out, eye, target, up) {\n  var eyex = eye[0],\n    eyey = eye[1],\n    eyez = eye[2],\n    upx = up[0],\n    upy = up[1],\n    upz = up[2];\n  var z0 = eyex - target[0],\n    z1 = eyey - target[1],\n    z2 = eyez - target[2];\n  var len = z0 * z0 + z1 * z1 + z2 * z2;\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    z0 *= len;\n    z1 *= len;\n    z2 *= len;\n  }\n  var x0 = upy * z2 - upz * z1,\n    x1 = upz * z0 - upx * z2,\n    x2 = upx * z1 - upy * z0;\n  len = x0 * x0 + x1 * x1 + x2 * x2;\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n  out[0] = x0;\n  out[1] = x1;\n  out[2] = x2;\n  out[3] = 0;\n  out[4] = z1 * x2 - z2 * x1;\n  out[5] = z2 * x0 - z0 * x2;\n  out[6] = z0 * x1 - z1 * x0;\n  out[7] = 0;\n  out[8] = z0;\n  out[9] = z1;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = eyex;\n  out[13] = eyey;\n  out[14] = eyez;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Returns a string representation of a mat4\n *\n * @param {ReadonlyMat4} a matrix to represent as a string\n * @returns {String} string representation of the matrix\n */\nexport function str(a) {\n  return \"mat4(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \", \" + a[4] + \", \" + a[5] + \", \" + a[6] + \", \" + a[7] + \", \" + a[8] + \", \" + a[9] + \", \" + a[10] + \", \" + a[11] + \", \" + a[12] + \", \" + a[13] + \", \" + a[14] + \", \" + a[15] + \")\";\n}\n\n/**\n * Returns Frobenius norm of a mat4\n *\n * @param {ReadonlyMat4} a the matrix to calculate Frobenius norm of\n * @returns {Number} Frobenius norm\n */\nexport function frob(a) {\n  return Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2] + a[3] * a[3] + a[4] * a[4] + a[5] * a[5] + a[6] * a[6] + a[7] * a[7] + a[8] * a[8] + a[9] * a[9] + a[10] * a[10] + a[11] * a[11] + a[12] * a[12] + a[13] * a[13] + a[14] * a[14] + a[15] * a[15]);\n}\n\n/**\n * Adds two mat4's\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  out[4] = a[4] + b[4];\n  out[5] = a[5] + b[5];\n  out[6] = a[6] + b[6];\n  out[7] = a[7] + b[7];\n  out[8] = a[8] + b[8];\n  out[9] = a[9] + b[9];\n  out[10] = a[10] + b[10];\n  out[11] = a[11] + b[11];\n  out[12] = a[12] + b[12];\n  out[13] = a[13] + b[13];\n  out[14] = a[14] + b[14];\n  out[15] = a[15] + b[15];\n  return out;\n}\n\n/**\n * Subtracts matrix b from matrix a\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  out[4] = a[4] - b[4];\n  out[5] = a[5] - b[5];\n  out[6] = a[6] - b[6];\n  out[7] = a[7] - b[7];\n  out[8] = a[8] - b[8];\n  out[9] = a[9] - b[9];\n  out[10] = a[10] - b[10];\n  out[11] = a[11] - b[11];\n  out[12] = a[12] - b[12];\n  out[13] = a[13] - b[13];\n  out[14] = a[14] - b[14];\n  out[15] = a[15] - b[15];\n  return out;\n}\n\n/**\n * Multiply each element of the matrix by a scalar.\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to scale\n * @param {Number} b amount to scale the matrix's elements by\n * @returns {mat4} out\n */\nexport function multiplyScalar(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  out[4] = a[4] * b;\n  out[5] = a[5] * b;\n  out[6] = a[6] * b;\n  out[7] = a[7] * b;\n  out[8] = a[8] * b;\n  out[9] = a[9] * b;\n  out[10] = a[10] * b;\n  out[11] = a[11] * b;\n  out[12] = a[12] * b;\n  out[13] = a[13] * b;\n  out[14] = a[14] * b;\n  out[15] = a[15] * b;\n  return out;\n}\n\n/**\n * Adds two mat4's after multiplying each element of the second operand by a scalar value.\n *\n * @param {mat4} out the receiving vector\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @param {Number} scale the amount to scale b's elements by before adding\n * @returns {mat4} out\n */\nexport function multiplyScalarAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  out[3] = a[3] + b[3] * scale;\n  out[4] = a[4] + b[4] * scale;\n  out[5] = a[5] + b[5] * scale;\n  out[6] = a[6] + b[6] * scale;\n  out[7] = a[7] + b[7] * scale;\n  out[8] = a[8] + b[8] * scale;\n  out[9] = a[9] + b[9] * scale;\n  out[10] = a[10] + b[10] * scale;\n  out[11] = a[11] + b[11] * scale;\n  out[12] = a[12] + b[12] * scale;\n  out[13] = a[13] + b[13] * scale;\n  out[14] = a[14] + b[14] * scale;\n  out[15] = a[15] + b[15] * scale;\n  return out;\n}\n\n/**\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyMat4} a The first matrix.\n * @param {ReadonlyMat4} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] && a[8] === b[8] && a[9] === b[9] && a[10] === b[10] && a[11] === b[11] && a[12] === b[12] && a[13] === b[13] && a[14] === b[14] && a[15] === b[15];\n}\n\n/**\n * Returns whether or not the matrices have approximately the same elements in the same position.\n *\n * @param {ReadonlyMat4} a The first matrix.\n * @param {ReadonlyMat4} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\nexport function equals(a, b) {\n  var a0 = a[0],\n    a1 = a[1],\n    a2 = a[2],\n    a3 = a[3];\n  var a4 = a[4],\n    a5 = a[5],\n    a6 = a[6],\n    a7 = a[7];\n  var a8 = a[8],\n    a9 = a[9],\n    a10 = a[10],\n    a11 = a[11];\n  var a12 = a[12],\n    a13 = a[13],\n    a14 = a[14],\n    a15 = a[15];\n  var b0 = b[0],\n    b1 = b[1],\n    b2 = b[2],\n    b3 = b[3];\n  var b4 = b[4],\n    b5 = b[5],\n    b6 = b[6],\n    b7 = b[7];\n  var b8 = b[8],\n    b9 = b[9],\n    b10 = b[10],\n    b11 = b[11];\n  var b12 = b[12],\n    b13 = b[13],\n    b14 = b[14],\n    b15 = b[15];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7)) && Math.abs(a8 - b8) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a8), Math.abs(b8)) && Math.abs(a9 - b9) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a9), Math.abs(b9)) && Math.abs(a10 - b10) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a10), Math.abs(b10)) && Math.abs(a11 - b11) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a11), Math.abs(b11)) && Math.abs(a12 - b12) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a12), Math.abs(b12)) && Math.abs(a13 - b13) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a13), Math.abs(b13)) && Math.abs(a14 - b14) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a14), Math.abs(b14)) && Math.abs(a15 - b15) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a15), Math.abs(b15));\n}\n\n/**\n * Alias for {@link mat4.multiply}\n * @function\n */\nexport var mul = multiply;\n\n/**\n * Alias for {@link mat4.subtract}\n * @function\n */\nexport var sub = subtract;", "import * as glMatrix from \"./common.js\";\nimport * as mat3 from \"./mat3.js\";\nimport * as vec3 from \"./vec3.js\";\nimport * as vec4 from \"./vec4.js\";\n\n/**\n * Quaternion in the format XYZW\n * @module quat\n */\n\n/**\n * Creates a new identity quat\n *\n * @returns {quat} a new quaternion\n */\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(4);\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n  }\n  out[3] = 1;\n  return out;\n}\n\n/**\n * Set a quat to the identity quaternion\n *\n * @param {quat} out the receiving quaternion\n * @returns {quat} out\n */\nexport function identity(out) {\n  out[0] = 0;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 1;\n  return out;\n}\n\n/**\n * Sets a quat from the given angle and rotation axis,\n * then returns it.\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyVec3} axis the axis around which to rotate\n * @param {Number} rad the angle in radians\n * @returns {quat} out\n **/\nexport function setAxisAngle(out, axis, rad) {\n  rad = rad * 0.5;\n  var s = Math.sin(rad);\n  out[0] = s * axis[0];\n  out[1] = s * axis[1];\n  out[2] = s * axis[2];\n  out[3] = Math.cos(rad);\n  return out;\n}\n\n/**\n * Gets the rotation axis and angle for a given\n *  quaternion. If a quaternion is created with\n *  setAxisAngle, this method will return the same\n *  values as providied in the original parameter list\n *  OR functionally equivalent values.\n * Example: The quaternion formed by axis [0, 0, 1] and\n *  angle -90 is the same as the quaternion formed by\n *  [0, 0, 1] and 270. This method favors the latter.\n * @param  {vec3} out_axis  Vector receiving the axis of rotation\n * @param  {ReadonlyQuat} q     Quaternion to be decomposed\n * @return {Number}     Angle, in radians, of the rotation\n */\nexport function getAxisAngle(out_axis, q) {\n  var rad = Math.acos(q[3]) * 2.0;\n  var s = Math.sin(rad / 2.0);\n  if (s > glMatrix.EPSILON) {\n    out_axis[0] = q[0] / s;\n    out_axis[1] = q[1] / s;\n    out_axis[2] = q[2] / s;\n  } else {\n    // If s is zero, return any axis (no rotation - axis does not matter)\n    out_axis[0] = 1;\n    out_axis[1] = 0;\n    out_axis[2] = 0;\n  }\n  return rad;\n}\n\n/**\n * Gets the angular distance between two unit quaternions\n *\n * @param  {ReadonlyQuat} a     Origin unit quaternion\n * @param  {ReadonlyQuat} b     Destination unit quaternion\n * @return {Number}     Angle, in radians, between the two quaternions\n */\nexport function getAngle(a, b) {\n  var dotproduct = dot(a, b);\n  return Math.acos(2 * dotproduct * dotproduct - 1);\n}\n\n/**\n * Multiplies two quat's\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a the first operand\n * @param {ReadonlyQuat} b the second operand\n * @returns {quat} out\n */\nexport function multiply(out, a, b) {\n  var ax = a[0],\n    ay = a[1],\n    az = a[2],\n    aw = a[3];\n  var bx = b[0],\n    by = b[1],\n    bz = b[2],\n    bw = b[3];\n  out[0] = ax * bw + aw * bx + ay * bz - az * by;\n  out[1] = ay * bw + aw * by + az * bx - ax * bz;\n  out[2] = az * bw + aw * bz + ax * by - ay * bx;\n  out[3] = aw * bw - ax * bx - ay * by - az * bz;\n  return out;\n}\n\n/**\n * Rotates a quaternion by the given angle about the X axis\n *\n * @param {quat} out quat receiving operation result\n * @param {ReadonlyQuat} a quat to rotate\n * @param {number} rad angle (in radians) to rotate\n * @returns {quat} out\n */\nexport function rotateX(out, a, rad) {\n  rad *= 0.5;\n  var ax = a[0],\n    ay = a[1],\n    az = a[2],\n    aw = a[3];\n  var bx = Math.sin(rad),\n    bw = Math.cos(rad);\n  out[0] = ax * bw + aw * bx;\n  out[1] = ay * bw + az * bx;\n  out[2] = az * bw - ay * bx;\n  out[3] = aw * bw - ax * bx;\n  return out;\n}\n\n/**\n * Rotates a quaternion by the given angle about the Y axis\n *\n * @param {quat} out quat receiving operation result\n * @param {ReadonlyQuat} a quat to rotate\n * @param {number} rad angle (in radians) to rotate\n * @returns {quat} out\n */\nexport function rotateY(out, a, rad) {\n  rad *= 0.5;\n  var ax = a[0],\n    ay = a[1],\n    az = a[2],\n    aw = a[3];\n  var by = Math.sin(rad),\n    bw = Math.cos(rad);\n  out[0] = ax * bw - az * by;\n  out[1] = ay * bw + aw * by;\n  out[2] = az * bw + ax * by;\n  out[3] = aw * bw - ay * by;\n  return out;\n}\n\n/**\n * Rotates a quaternion by the given angle about the Z axis\n *\n * @param {quat} out quat receiving operation result\n * @param {ReadonlyQuat} a quat to rotate\n * @param {number} rad angle (in radians) to rotate\n * @returns {quat} out\n */\nexport function rotateZ(out, a, rad) {\n  rad *= 0.5;\n  var ax = a[0],\n    ay = a[1],\n    az = a[2],\n    aw = a[3];\n  var bz = Math.sin(rad),\n    bw = Math.cos(rad);\n  out[0] = ax * bw + ay * bz;\n  out[1] = ay * bw - ax * bz;\n  out[2] = az * bw + aw * bz;\n  out[3] = aw * bw - az * bz;\n  return out;\n}\n\n/**\n * Calculates the W component of a quat from the X, Y, and Z components.\n * Assumes that quaternion is 1 unit in length.\n * Any existing W component will be ignored.\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a quat to calculate W component of\n * @returns {quat} out\n */\nexport function calculateW(out, a) {\n  var x = a[0],\n    y = a[1],\n    z = a[2];\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  out[3] = Math.sqrt(Math.abs(1.0 - x * x - y * y - z * z));\n  return out;\n}\n\n/**\n * Calculate the exponential of a unit quaternion.\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a quat to calculate the exponential of\n * @returns {quat} out\n */\nexport function exp(out, a) {\n  var x = a[0],\n    y = a[1],\n    z = a[2],\n    w = a[3];\n  var r = Math.sqrt(x * x + y * y + z * z);\n  var et = Math.exp(w);\n  var s = r > 0 ? et * Math.sin(r) / r : 0;\n  out[0] = x * s;\n  out[1] = y * s;\n  out[2] = z * s;\n  out[3] = et * Math.cos(r);\n  return out;\n}\n\n/**\n * Calculate the natural logarithm of a unit quaternion.\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a quat to calculate the exponential of\n * @returns {quat} out\n */\nexport function ln(out, a) {\n  var x = a[0],\n    y = a[1],\n    z = a[2],\n    w = a[3];\n  var r = Math.sqrt(x * x + y * y + z * z);\n  var t = r > 0 ? Math.atan2(r, w) / r : 0;\n  out[0] = x * t;\n  out[1] = y * t;\n  out[2] = z * t;\n  out[3] = 0.5 * Math.log(x * x + y * y + z * z + w * w);\n  return out;\n}\n\n/**\n * Calculate the scalar power of a unit quaternion.\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a quat to calculate the exponential of\n * @param {Number} b amount to scale the quaternion by\n * @returns {quat} out\n */\nexport function pow(out, a, b) {\n  ln(out, a);\n  scale(out, out, b);\n  exp(out, out);\n  return out;\n}\n\n/**\n * Performs a spherical linear interpolation between two quat\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a the first operand\n * @param {ReadonlyQuat} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {quat} out\n */\nexport function slerp(out, a, b, t) {\n  // benchmarks:\n  //    http://jsperf.com/quaternion-slerp-implementations\n  var ax = a[0],\n    ay = a[1],\n    az = a[2],\n    aw = a[3];\n  var bx = b[0],\n    by = b[1],\n    bz = b[2],\n    bw = b[3];\n  var omega, cosom, sinom, scale0, scale1;\n\n  // calc cosine\n  cosom = ax * bx + ay * by + az * bz + aw * bw;\n  // adjust signs (if necessary)\n  if (cosom < 0.0) {\n    cosom = -cosom;\n    bx = -bx;\n    by = -by;\n    bz = -bz;\n    bw = -bw;\n  }\n  // calculate coefficients\n  if (1.0 - cosom > glMatrix.EPSILON) {\n    // standard case (slerp)\n    omega = Math.acos(cosom);\n    sinom = Math.sin(omega);\n    scale0 = Math.sin((1.0 - t) * omega) / sinom;\n    scale1 = Math.sin(t * omega) / sinom;\n  } else {\n    // \"from\" and \"to\" quaternions are very close\n    //  ... so we can do a linear interpolation\n    scale0 = 1.0 - t;\n    scale1 = t;\n  }\n  // calculate final values\n  out[0] = scale0 * ax + scale1 * bx;\n  out[1] = scale0 * ay + scale1 * by;\n  out[2] = scale0 * az + scale1 * bz;\n  out[3] = scale0 * aw + scale1 * bw;\n  return out;\n}\n\n/**\n * Generates a random unit quaternion\n *\n * @param {quat} out the receiving quaternion\n * @returns {quat} out\n */\nexport function random(out) {\n  // Implementation of http://planning.cs.uiuc.edu/node198.html\n  // TODO: Calling random 3 times is probably not the fastest solution\n  var u1 = glMatrix.RANDOM();\n  var u2 = glMatrix.RANDOM();\n  var u3 = glMatrix.RANDOM();\n  var sqrt1MinusU1 = Math.sqrt(1 - u1);\n  var sqrtU1 = Math.sqrt(u1);\n  out[0] = sqrt1MinusU1 * Math.sin(2.0 * Math.PI * u2);\n  out[1] = sqrt1MinusU1 * Math.cos(2.0 * Math.PI * u2);\n  out[2] = sqrtU1 * Math.sin(2.0 * Math.PI * u3);\n  out[3] = sqrtU1 * Math.cos(2.0 * Math.PI * u3);\n  return out;\n}\n\n/**\n * Calculates the inverse of a quat\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a quat to calculate inverse of\n * @returns {quat} out\n */\nexport function invert(out, a) {\n  var a0 = a[0],\n    a1 = a[1],\n    a2 = a[2],\n    a3 = a[3];\n  var dot = a0 * a0 + a1 * a1 + a2 * a2 + a3 * a3;\n  var invDot = dot ? 1.0 / dot : 0;\n\n  // TODO: Would be faster to return [0,0,0,0] immediately if dot == 0\n\n  out[0] = -a0 * invDot;\n  out[1] = -a1 * invDot;\n  out[2] = -a2 * invDot;\n  out[3] = a3 * invDot;\n  return out;\n}\n\n/**\n * Calculates the conjugate of a quat\n * If the quaternion is normalized, this function is faster than quat.inverse and produces the same result.\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a quat to calculate conjugate of\n * @returns {quat} out\n */\nexport function conjugate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  out[2] = -a[2];\n  out[3] = a[3];\n  return out;\n}\n\n/**\n * Creates a quaternion from the given 3x3 rotation matrix.\n *\n * NOTE: The resultant quaternion is not normalized, so you should be sure\n * to renormalize the quaternion yourself where necessary.\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyMat3} m rotation matrix\n * @returns {quat} out\n * @function\n */\nexport function fromMat3(out, m) {\n  // Algorithm in Ken Shoemake's article in 1987 SIGGRAPH course notes\n  // article \"Quaternion Calculus and Fast Animation\".\n  var fTrace = m[0] + m[4] + m[8];\n  var fRoot;\n  if (fTrace > 0.0) {\n    // |w| > 1/2, may as well choose w > 1/2\n    fRoot = Math.sqrt(fTrace + 1.0); // 2w\n    out[3] = 0.5 * fRoot;\n    fRoot = 0.5 / fRoot; // 1/(4w)\n    out[0] = (m[5] - m[7]) * fRoot;\n    out[1] = (m[6] - m[2]) * fRoot;\n    out[2] = (m[1] - m[3]) * fRoot;\n  } else {\n    // |w| <= 1/2\n    var i = 0;\n    if (m[4] > m[0]) i = 1;\n    if (m[8] > m[i * 3 + i]) i = 2;\n    var j = (i + 1) % 3;\n    var k = (i + 2) % 3;\n    fRoot = Math.sqrt(m[i * 3 + i] - m[j * 3 + j] - m[k * 3 + k] + 1.0);\n    out[i] = 0.5 * fRoot;\n    fRoot = 0.5 / fRoot;\n    out[3] = (m[j * 3 + k] - m[k * 3 + j]) * fRoot;\n    out[j] = (m[j * 3 + i] + m[i * 3 + j]) * fRoot;\n    out[k] = (m[k * 3 + i] + m[i * 3 + k]) * fRoot;\n  }\n  return out;\n}\n\n/**\n * Creates a quaternion from the given euler angle x, y, z using the provided intrinsic order for the conversion.\n *\n * @param {quat} out the receiving quaternion\n * @param {Number} x Angle to rotate around X axis in degrees.\n * @param {Number} y Angle to rotate around Y axis in degrees.\n * @param {Number} z Angle to rotate around Z axis in degrees.\n * @param {'xyz'|'xzy'|'yxz'|'yzx'|'zxy'|'zyx'} order Intrinsic order for conversion, default is zyx.\n * @returns {quat} out\n * @function\n */\nexport function fromEuler(out, x, y, z) {\n  var order = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : glMatrix.ANGLE_ORDER;\n  var halfToRad = Math.PI / 360;\n  x *= halfToRad;\n  z *= halfToRad;\n  y *= halfToRad;\n  var sx = Math.sin(x);\n  var cx = Math.cos(x);\n  var sy = Math.sin(y);\n  var cy = Math.cos(y);\n  var sz = Math.sin(z);\n  var cz = Math.cos(z);\n  switch (order) {\n    case \"xyz\":\n      out[0] = sx * cy * cz + cx * sy * sz;\n      out[1] = cx * sy * cz - sx * cy * sz;\n      out[2] = cx * cy * sz + sx * sy * cz;\n      out[3] = cx * cy * cz - sx * sy * sz;\n      break;\n    case \"xzy\":\n      out[0] = sx * cy * cz - cx * sy * sz;\n      out[1] = cx * sy * cz - sx * cy * sz;\n      out[2] = cx * cy * sz + sx * sy * cz;\n      out[3] = cx * cy * cz + sx * sy * sz;\n      break;\n    case \"yxz\":\n      out[0] = sx * cy * cz + cx * sy * sz;\n      out[1] = cx * sy * cz - sx * cy * sz;\n      out[2] = cx * cy * sz - sx * sy * cz;\n      out[3] = cx * cy * cz + sx * sy * sz;\n      break;\n    case \"yzx\":\n      out[0] = sx * cy * cz + cx * sy * sz;\n      out[1] = cx * sy * cz + sx * cy * sz;\n      out[2] = cx * cy * sz - sx * sy * cz;\n      out[3] = cx * cy * cz - sx * sy * sz;\n      break;\n    case \"zxy\":\n      out[0] = sx * cy * cz - cx * sy * sz;\n      out[1] = cx * sy * cz + sx * cy * sz;\n      out[2] = cx * cy * sz + sx * sy * cz;\n      out[3] = cx * cy * cz - sx * sy * sz;\n      break;\n    case \"zyx\":\n      out[0] = sx * cy * cz - cx * sy * sz;\n      out[1] = cx * sy * cz + sx * cy * sz;\n      out[2] = cx * cy * sz - sx * sy * cz;\n      out[3] = cx * cy * cz + sx * sy * sz;\n      break;\n    default:\n      throw new Error('Unknown angle order ' + order);\n  }\n  return out;\n}\n\n/**\n * Returns a string representation of a quaternion\n *\n * @param {ReadonlyQuat} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\nexport function str(a) {\n  return \"quat(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \")\";\n}\n\n/**\n * Creates a new quat initialized with values from an existing quaternion\n *\n * @param {ReadonlyQuat} a quaternion to clone\n * @returns {quat} a new quaternion\n * @function\n */\nexport var clone = vec4.clone;\n\n/**\n * Creates a new quat initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @param {Number} w W component\n * @returns {quat} a new quaternion\n * @function\n */\nexport var fromValues = vec4.fromValues;\n\n/**\n * Copy the values from one quat to another\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a the source quaternion\n * @returns {quat} out\n * @function\n */\nexport var copy = vec4.copy;\n\n/**\n * Set the components of a quat to the given values\n *\n * @param {quat} out the receiving quaternion\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @param {Number} w W component\n * @returns {quat} out\n * @function\n */\nexport var set = vec4.set;\n\n/**\n * Adds two quat's\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a the first operand\n * @param {ReadonlyQuat} b the second operand\n * @returns {quat} out\n * @function\n */\nexport var add = vec4.add;\n\n/**\n * Alias for {@link quat.multiply}\n * @function\n */\nexport var mul = multiply;\n\n/**\n * Scales a quat by a scalar number\n *\n * @param {quat} out the receiving vector\n * @param {ReadonlyQuat} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {quat} out\n * @function\n */\nexport var scale = vec4.scale;\n\n/**\n * Calculates the dot product of two quat's\n *\n * @param {ReadonlyQuat} a the first operand\n * @param {ReadonlyQuat} b the second operand\n * @returns {Number} dot product of a and b\n * @function\n */\nexport var dot = vec4.dot;\n\n/**\n * Performs a linear interpolation between two quat's\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a the first operand\n * @param {ReadonlyQuat} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {quat} out\n * @function\n */\nexport var lerp = vec4.lerp;\n\n/**\n * Calculates the length of a quat\n *\n * @param {ReadonlyQuat} a vector to calculate length of\n * @returns {Number} length of a\n */\nexport var length = vec4.length;\n\n/**\n * Alias for {@link quat.length}\n * @function\n */\nexport var len = length;\n\n/**\n * Calculates the squared length of a quat\n *\n * @param {ReadonlyQuat} a vector to calculate squared length of\n * @returns {Number} squared length of a\n * @function\n */\nexport var squaredLength = vec4.squaredLength;\n\n/**\n * Alias for {@link quat.squaredLength}\n * @function\n */\nexport var sqrLen = squaredLength;\n\n/**\n * Normalize a quat\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a quaternion to normalize\n * @returns {quat} out\n * @function\n */\nexport var normalize = vec4.normalize;\n\n/**\n * Returns whether or not the quaternions have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyQuat} a The first quaternion.\n * @param {ReadonlyQuat} b The second quaternion.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\nexport var exactEquals = vec4.exactEquals;\n\n/**\n * Returns whether or not the quaternions point approximately to the same direction.\n *\n * Both quaternions are assumed to be unit length.\n *\n * @param {ReadonlyQuat} a The first unit quaternion.\n * @param {ReadonlyQuat} b The second unit quaternion.\n * @returns {Boolean} True if the quaternions are equal, false otherwise.\n */\nexport function equals(a, b) {\n  return Math.abs(vec4.dot(a, b)) >= 1 - glMatrix.EPSILON;\n}\n\n/**\n * Sets a quaternion to represent the shortest rotation from one\n * vector to another.\n *\n * Both vectors are assumed to be unit length.\n *\n * @param {quat} out the receiving quaternion.\n * @param {ReadonlyVec3} a the initial vector\n * @param {ReadonlyVec3} b the destination vector\n * @returns {quat} out\n */\nexport var rotationTo = function () {\n  var tmpvec3 = vec3.create();\n  var xUnitVec3 = vec3.fromValues(1, 0, 0);\n  var yUnitVec3 = vec3.fromValues(0, 1, 0);\n  return function (out, a, b) {\n    var dot = vec3.dot(a, b);\n    if (dot < -0.999999) {\n      vec3.cross(tmpvec3, xUnitVec3, a);\n      if (vec3.len(tmpvec3) < 0.000001) vec3.cross(tmpvec3, yUnitVec3, a);\n      vec3.normalize(tmpvec3, tmpvec3);\n      setAxisAngle(out, tmpvec3, Math.PI);\n      return out;\n    } else if (dot > 0.999999) {\n      out[0] = 0;\n      out[1] = 0;\n      out[2] = 0;\n      out[3] = 1;\n      return out;\n    } else {\n      vec3.cross(tmpvec3, a, b);\n      out[0] = tmpvec3[0];\n      out[1] = tmpvec3[1];\n      out[2] = tmpvec3[2];\n      out[3] = 1 + dot;\n      return normalize(out, out);\n    }\n  };\n}();\n\n/**\n * Performs a spherical linear interpolation with two control points\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a the first operand\n * @param {ReadonlyQuat} b the second operand\n * @param {ReadonlyQuat} c the third operand\n * @param {ReadonlyQuat} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {quat} out\n */\nexport var sqlerp = function () {\n  var temp1 = create();\n  var temp2 = create();\n  return function (out, a, b, c, d, t) {\n    slerp(temp1, a, d, t);\n    slerp(temp2, b, c, t);\n    slerp(out, temp1, temp2, 2 * t * (1 - t));\n    return out;\n  };\n}();\n\n/**\n * Sets the specified quaternion with values corresponding to the given\n * axes. Each axis is a vec3 and is expected to be unit length and\n * perpendicular to all other specified axes.\n *\n * @param {ReadonlyVec3} view  the vector representing the viewing direction\n * @param {ReadonlyVec3} right the vector representing the local \"right\" direction\n * @param {ReadonlyVec3} up    the vector representing the local \"up\" direction\n * @returns {quat} out\n */\nexport var setAxes = function () {\n  var matr = mat3.create();\n  return function (out, view, right, up) {\n    matr[0] = right[0];\n    matr[3] = right[1];\n    matr[6] = right[2];\n    matr[1] = up[0];\n    matr[4] = up[1];\n    matr[7] = up[2];\n    matr[2] = -view[0];\n    matr[5] = -view[1];\n    matr[8] = -view[2];\n    return normalize(out, fromMat3(out, matr));\n  };\n}();", "import * as glMatrix from \"./common.js\";\n\n/**\n * 3 Dimensional Vector\n * @module vec3\n */\n\n/**\n * Creates a new, empty vec3\n *\n * @returns {vec3} a new 3D vector\n */\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n  }\n  return out;\n}\n\n/**\n * Creates a new vec3 initialized with values from an existing vector\n *\n * @param {ReadonlyVec3} a vector to clone\n * @returns {vec3} a new 3D vector\n */\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n\n/**\n * Calculates the length of a vec3\n *\n * @param {ReadonlyVec3} a vector to calculate length of\n * @returns {Number} length of a\n */\nexport function length(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  return Math.sqrt(x * x + y * y + z * z);\n}\n\n/**\n * Creates a new vec3 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} a new 3D vector\n */\nexport function fromValues(x, y, z) {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n\n/**\n * Copy the values from one vec3 to another\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the source vector\n * @returns {vec3} out\n */\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n\n/**\n * Set the components of a vec3 to the given values\n *\n * @param {vec3} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} out\n */\nexport function set(out, x, y, z) {\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n\n/**\n * Adds two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  return out;\n}\n\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  return out;\n}\n\n/**\n * Multiplies two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  out[2] = a[2] * b[2];\n  return out;\n}\n\n/**\n * Divides two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  out[2] = a[2] / b[2];\n  return out;\n}\n\n/**\n * Math.ceil the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to ceil\n * @returns {vec3} out\n */\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  out[2] = Math.ceil(a[2]);\n  return out;\n}\n\n/**\n * Math.floor the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to floor\n * @returns {vec3} out\n */\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  out[2] = Math.floor(a[2]);\n  return out;\n}\n\n/**\n * Returns the minimum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  out[2] = Math.min(a[2], b[2]);\n  return out;\n}\n\n/**\n * Returns the maximum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  out[2] = Math.max(a[2], b[2]);\n  return out;\n}\n\n/**\n * symmetric round the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to round\n * @returns {vec3} out\n */\nexport function round(out, a) {\n  out[0] = glMatrix.round(a[0]);\n  out[1] = glMatrix.round(a[1]);\n  out[2] = glMatrix.round(a[2]);\n  return out;\n}\n\n/**\n * Scales a vec3 by a scalar number\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec3} out\n */\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  return out;\n}\n\n/**\n * Adds two vec3's after scaling the second operand by a scalar value\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec3} out\n */\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  return out;\n}\n\n/**\n * Calculates the euclidian distance between two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} distance between a and b\n */\nexport function distance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  return Math.sqrt(x * x + y * y + z * z);\n}\n\n/**\n * Calculates the squared euclidian distance between two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} squared distance between a and b\n */\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  return x * x + y * y + z * z;\n}\n\n/**\n * Calculates the squared length of a vec3\n *\n * @param {ReadonlyVec3} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\nexport function squaredLength(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  return x * x + y * y + z * z;\n}\n\n/**\n * Negates the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to negate\n * @returns {vec3} out\n */\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  out[2] = -a[2];\n  return out;\n}\n\n/**\n * Returns the inverse of the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to invert\n * @returns {vec3} out\n */\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  out[2] = 1.0 / a[2];\n  return out;\n}\n\n/**\n * Normalize a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to normalize\n * @returns {vec3} out\n */\nexport function normalize(out, a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var len = x * x + y * y + z * z;\n  if (len > 0) {\n    //TODO: evaluate use of glm_invsqrt here?\n    len = 1 / Math.sqrt(len);\n  }\n  out[0] = a[0] * len;\n  out[1] = a[1] * len;\n  out[2] = a[2] * len;\n  return out;\n}\n\n/**\n * Calculates the dot product of two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} dot product of a and b\n */\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n\n/**\n * Computes the cross product of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\nexport function cross(out, a, b) {\n  var ax = a[0],\n    ay = a[1],\n    az = a[2];\n  var bx = b[0],\n    by = b[1],\n    bz = b[2];\n  out[0] = ay * bz - az * by;\n  out[1] = az * bx - ax * bz;\n  out[2] = ax * by - ay * bx;\n  return out;\n}\n\n/**\n * Performs a linear interpolation between two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\nexport function lerp(out, a, b, t) {\n  var ax = a[0];\n  var ay = a[1];\n  var az = a[2];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  out[2] = az + t * (b[2] - az);\n  return out;\n}\n\n/**\n * Performs a spherical linear interpolation between two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\nexport function slerp(out, a, b, t) {\n  var angle = Math.acos(Math.min(Math.max(dot(a, b), -1), 1));\n  var sinTotal = Math.sin(angle);\n  var ratioA = Math.sin((1 - t) * angle) / sinTotal;\n  var ratioB = Math.sin(t * angle) / sinTotal;\n  out[0] = ratioA * a[0] + ratioB * b[0];\n  out[1] = ratioA * a[1] + ratioB * b[1];\n  out[2] = ratioA * a[2] + ratioB * b[2];\n  return out;\n}\n\n/**\n * Performs a hermite interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {ReadonlyVec3} c the third operand\n * @param {ReadonlyVec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\nexport function hermite(out, a, b, c, d, t) {\n  var factorTimes2 = t * t;\n  var factor1 = factorTimes2 * (2 * t - 3) + 1;\n  var factor2 = factorTimes2 * (t - 2) + t;\n  var factor3 = factorTimes2 * (t - 1);\n  var factor4 = factorTimes2 * (3 - 2 * t);\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n  return out;\n}\n\n/**\n * Performs a bezier interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {ReadonlyVec3} c the third operand\n * @param {ReadonlyVec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\nexport function bezier(out, a, b, c, d, t) {\n  var inverseFactor = 1 - t;\n  var inverseFactorTimesTwo = inverseFactor * inverseFactor;\n  var factorTimes2 = t * t;\n  var factor1 = inverseFactorTimesTwo * inverseFactor;\n  var factor2 = 3 * t * inverseFactorTimesTwo;\n  var factor3 = 3 * factorTimes2 * inverseFactor;\n  var factor4 = factorTimes2 * t;\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n  return out;\n}\n\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec3} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If omitted, a unit vector will be returned\n * @returns {vec3} out\n */\nexport function random(out, scale) {\n  scale = scale === undefined ? 1.0 : scale;\n  var r = glMatrix.RANDOM() * 2.0 * Math.PI;\n  var z = glMatrix.RANDOM() * 2.0 - 1.0;\n  var zScale = Math.sqrt(1.0 - z * z) * scale;\n  out[0] = Math.cos(r) * zScale;\n  out[1] = Math.sin(r) * zScale;\n  out[2] = z * scale;\n  return out;\n}\n\n/**\n * Transforms the vec3 with a mat4.\n * 4th vector component is implicitly '1'\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyMat4} m matrix to transform with\n * @returns {vec3} out\n */\nexport function transformMat4(out, a, m) {\n  var x = a[0],\n    y = a[1],\n    z = a[2];\n  var w = m[3] * x + m[7] * y + m[11] * z + m[15];\n  w = w || 1.0;\n  out[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w;\n  out[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w;\n  out[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w;\n  return out;\n}\n\n/**\n * Transforms the vec3 with a mat3.\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyMat3} m the 3x3 matrix to transform with\n * @returns {vec3} out\n */\nexport function transformMat3(out, a, m) {\n  var x = a[0],\n    y = a[1],\n    z = a[2];\n  out[0] = x * m[0] + y * m[3] + z * m[6];\n  out[1] = x * m[1] + y * m[4] + z * m[7];\n  out[2] = x * m[2] + y * m[5] + z * m[8];\n  return out;\n}\n\n/**\n * Transforms the vec3 with a quat\n * Can also be used for dual quaternions. (Multiply it with the real part)\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyQuat} q normalized quaternion to transform with\n * @returns {vec3} out\n */\nexport function transformQuat(out, a, q) {\n  // Fast Vector Rotation using Quaternions by Robert Eisele\n  // https://raw.org/proof/vector-rotation-using-quaternions/\n\n  var qx = q[0],\n    qy = q[1],\n    qz = q[2],\n    qw = q[3];\n  var vx = a[0],\n    vy = a[1],\n    vz = a[2];\n\n  // t = q x v\n  var tx = qy * vz - qz * vy;\n  var ty = qz * vx - qx * vz;\n  var tz = qx * vy - qy * vx;\n\n  // t = 2t\n  tx = tx + tx;\n  ty = ty + ty;\n  tz = tz + tz;\n\n  // v + w t + q x t\n  out[0] = vx + qw * tx + qy * tz - qz * ty;\n  out[1] = vy + qw * ty + qz * tx - qx * tz;\n  out[2] = vz + qw * tz + qx * ty - qy * tx;\n  return out;\n}\n\n/**\n * Rotate a 3D vector around the x-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\nexport function rotateX(out, a, b, rad) {\n  var p = [],\n    r = [];\n  //Translate point to the origin\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2];\n\n  //perform rotation\n  r[0] = p[0];\n  r[1] = p[1] * Math.cos(rad) - p[2] * Math.sin(rad);\n  r[2] = p[1] * Math.sin(rad) + p[2] * Math.cos(rad);\n\n  //translate to correct position\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n\n/**\n * Rotate a 3D vector around the y-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\nexport function rotateY(out, a, b, rad) {\n  var p = [],\n    r = [];\n  //Translate point to the origin\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2];\n\n  //perform rotation\n  r[0] = p[2] * Math.sin(rad) + p[0] * Math.cos(rad);\n  r[1] = p[1];\n  r[2] = p[2] * Math.cos(rad) - p[0] * Math.sin(rad);\n\n  //translate to correct position\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n\n/**\n * Rotate a 3D vector around the z-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\nexport function rotateZ(out, a, b, rad) {\n  var p = [],\n    r = [];\n  //Translate point to the origin\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2];\n\n  //perform rotation\n  r[0] = p[0] * Math.cos(rad) - p[1] * Math.sin(rad);\n  r[1] = p[0] * Math.sin(rad) + p[1] * Math.cos(rad);\n  r[2] = p[2];\n\n  //translate to correct position\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n\n/**\n * Get the angle between two 3D vectors\n * @param {ReadonlyVec3} a The first operand\n * @param {ReadonlyVec3} b The second operand\n * @returns {Number} The angle in radians\n */\nexport function angle(a, b) {\n  var ax = a[0],\n    ay = a[1],\n    az = a[2],\n    bx = b[0],\n    by = b[1],\n    bz = b[2],\n    mag = Math.sqrt((ax * ax + ay * ay + az * az) * (bx * bx + by * by + bz * bz)),\n    cosine = mag && dot(a, b) / mag;\n  return Math.acos(Math.min(Math.max(cosine, -1), 1));\n}\n\n/**\n * Set the components of a vec3 to zero\n *\n * @param {vec3} out the receiving vector\n * @returns {vec3} out\n */\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  return out;\n}\n\n/**\n * Returns a string representation of a vector\n *\n * @param {ReadonlyVec3} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\nexport function str(a) {\n  return \"vec3(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \")\";\n}\n\n/**\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyVec3} a The first vector.\n * @param {ReadonlyVec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\n}\n\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {ReadonlyVec3} a The first vector.\n * @param {ReadonlyVec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\nexport function equals(a, b) {\n  var a0 = a[0],\n    a1 = a[1],\n    a2 = a[2];\n  var b0 = b[0],\n    b1 = b[1],\n    b2 = b[2];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2));\n}\n\n/**\n * Alias for {@link vec3.subtract}\n * @function\n */\nexport var sub = subtract;\n\n/**\n * Alias for {@link vec3.multiply}\n * @function\n */\nexport var mul = multiply;\n\n/**\n * Alias for {@link vec3.divide}\n * @function\n */\nexport var div = divide;\n\n/**\n * Alias for {@link vec3.distance}\n * @function\n */\nexport var dist = distance;\n\n/**\n * Alias for {@link vec3.squaredDistance}\n * @function\n */\nexport var sqrDist = squaredDistance;\n\n/**\n * Alias for {@link vec3.length}\n * @function\n */\nexport var len = length;\n\n/**\n * Alias for {@link vec3.squaredLength}\n * @function\n */\nexport var sqrLen = squaredLength;\n\n/**\n * Perform some operation over an array of vec3s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec3. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec3s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n    if (!stride) {\n      stride = 3;\n    }\n    if (!offset) {\n      offset = 0;\n    }\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      vec[2] = a[i + 2];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n      a[i + 2] = vec[2];\n    }\n    return a;\n  };\n}();", "import * as glMatrix from \"./common.js\";\n\n/**\n * 4 Dimensional Vector\n * @module vec4\n */\n\n/**\n * Creates a new, empty vec4\n *\n * @returns {vec4} a new 4D vector\n */\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(4);\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n  }\n  return out;\n}\n\n/**\n * Creates a new vec4 initialized with values from an existing vector\n *\n * @param {ReadonlyVec4} a vector to clone\n * @returns {vec4} a new 4D vector\n */\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(4);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  return out;\n}\n\n/**\n * Creates a new vec4 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @param {Number} w W component\n * @returns {vec4} a new 4D vector\n */\nexport function fromValues(x, y, z, w) {\n  var out = new glMatrix.ARRAY_TYPE(4);\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  out[3] = w;\n  return out;\n}\n\n/**\n * Copy the values from one vec4 to another\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the source vector\n * @returns {vec4} out\n */\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  return out;\n}\n\n/**\n * Set the components of a vec4 to the given values\n *\n * @param {vec4} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @param {Number} w W component\n * @returns {vec4} out\n */\nexport function set(out, x, y, z, w) {\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  out[3] = w;\n  return out;\n}\n\n/**\n * Adds two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  return out;\n}\n\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  return out;\n}\n\n/**\n * Multiplies two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  out[2] = a[2] * b[2];\n  out[3] = a[3] * b[3];\n  return out;\n}\n\n/**\n * Divides two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  out[2] = a[2] / b[2];\n  out[3] = a[3] / b[3];\n  return out;\n}\n\n/**\n * Math.ceil the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to ceil\n * @returns {vec4} out\n */\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  out[2] = Math.ceil(a[2]);\n  out[3] = Math.ceil(a[3]);\n  return out;\n}\n\n/**\n * Math.floor the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to floor\n * @returns {vec4} out\n */\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  out[2] = Math.floor(a[2]);\n  out[3] = Math.floor(a[3]);\n  return out;\n}\n\n/**\n * Returns the minimum of two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  out[2] = Math.min(a[2], b[2]);\n  out[3] = Math.min(a[3], b[3]);\n  return out;\n}\n\n/**\n * Returns the maximum of two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  out[2] = Math.max(a[2], b[2]);\n  out[3] = Math.max(a[3], b[3]);\n  return out;\n}\n\n/**\n * symmetric round the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to round\n * @returns {vec4} out\n */\nexport function round(out, a) {\n  out[0] = glMatrix.round(a[0]);\n  out[1] = glMatrix.round(a[1]);\n  out[2] = glMatrix.round(a[2]);\n  out[3] = glMatrix.round(a[3]);\n  return out;\n}\n\n/**\n * Scales a vec4 by a scalar number\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec4} out\n */\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  return out;\n}\n\n/**\n * Adds two vec4's after scaling the second operand by a scalar value\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec4} out\n */\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  out[3] = a[3] + b[3] * scale;\n  return out;\n}\n\n/**\n * Calculates the euclidian distance between two vec4's\n *\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {Number} distance between a and b\n */\nexport function distance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  var w = b[3] - a[3];\n  return Math.sqrt(x * x + y * y + z * z + w * w);\n}\n\n/**\n * Calculates the squared euclidian distance between two vec4's\n *\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {Number} squared distance between a and b\n */\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  var w = b[3] - a[3];\n  return x * x + y * y + z * z + w * w;\n}\n\n/**\n * Calculates the length of a vec4\n *\n * @param {ReadonlyVec4} a vector to calculate length of\n * @returns {Number} length of a\n */\nexport function length(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var w = a[3];\n  return Math.sqrt(x * x + y * y + z * z + w * w);\n}\n\n/**\n * Calculates the squared length of a vec4\n *\n * @param {ReadonlyVec4} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\nexport function squaredLength(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var w = a[3];\n  return x * x + y * y + z * z + w * w;\n}\n\n/**\n * Negates the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to negate\n * @returns {vec4} out\n */\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  out[2] = -a[2];\n  out[3] = -a[3];\n  return out;\n}\n\n/**\n * Returns the inverse of the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to invert\n * @returns {vec4} out\n */\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  out[2] = 1.0 / a[2];\n  out[3] = 1.0 / a[3];\n  return out;\n}\n\n/**\n * Normalize a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to normalize\n * @returns {vec4} out\n */\nexport function normalize(out, a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var w = a[3];\n  var len = x * x + y * y + z * z + w * w;\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n  }\n  out[0] = x * len;\n  out[1] = y * len;\n  out[2] = z * len;\n  out[3] = w * len;\n  return out;\n}\n\n/**\n * Calculates the dot product of two vec4's\n *\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {Number} dot product of a and b\n */\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\n}\n\n/**\n * Returns the cross-product of three vectors in a 4-dimensional space\n *\n * @param {ReadonlyVec4} out the receiving vector\n * @param {ReadonlyVec4} u the first vector\n * @param {ReadonlyVec4} v the second vector\n * @param {ReadonlyVec4} w the third vector\n * @returns {vec4} result\n */\nexport function cross(out, u, v, w) {\n  var A = v[0] * w[1] - v[1] * w[0],\n    B = v[0] * w[2] - v[2] * w[0],\n    C = v[0] * w[3] - v[3] * w[0],\n    D = v[1] * w[2] - v[2] * w[1],\n    E = v[1] * w[3] - v[3] * w[1],\n    F = v[2] * w[3] - v[3] * w[2];\n  var G = u[0];\n  var H = u[1];\n  var I = u[2];\n  var J = u[3];\n  out[0] = H * F - I * E + J * D;\n  out[1] = -(G * F) + I * C - J * B;\n  out[2] = G * E - H * C + J * A;\n  out[3] = -(G * D) + H * B - I * A;\n  return out;\n}\n\n/**\n * Performs a linear interpolation between two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec4} out\n */\nexport function lerp(out, a, b, t) {\n  var ax = a[0];\n  var ay = a[1];\n  var az = a[2];\n  var aw = a[3];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  out[2] = az + t * (b[2] - az);\n  out[3] = aw + t * (b[3] - aw);\n  return out;\n}\n\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec4} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If omitted, a unit vector will be returned\n * @returns {vec4} out\n */\nexport function random(out, scale) {\n  scale = scale === undefined ? 1.0 : scale;\n\n  // Marsaglia, George. Choosing a Point from the Surface of a\n  // Sphere. Ann. Math. Statist. 43 (1972), no. 2, 645--646.\n  // http://projecteuclid.org/euclid.aoms/1177692644;\n  var v1, v2, v3, v4;\n  var s1, s2;\n  var rand;\n  rand = glMatrix.RANDOM();\n  v1 = rand * 2 - 1;\n  v2 = (4 * glMatrix.RANDOM() - 2) * Math.sqrt(rand * -rand + rand);\n  s1 = v1 * v1 + v2 * v2;\n  rand = glMatrix.RANDOM();\n  v3 = rand * 2 - 1;\n  v4 = (4 * glMatrix.RANDOM() - 2) * Math.sqrt(rand * -rand + rand);\n  s2 = v3 * v3 + v4 * v4;\n  var d = Math.sqrt((1 - s1) / s2);\n  out[0] = scale * v1;\n  out[1] = scale * v2;\n  out[2] = scale * v3 * d;\n  out[3] = scale * v4 * d;\n  return out;\n}\n\n/**\n * Transforms the vec4 with a mat4.\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the vector to transform\n * @param {ReadonlyMat4} m matrix to transform with\n * @returns {vec4} out\n */\nexport function transformMat4(out, a, m) {\n  var x = a[0],\n    y = a[1],\n    z = a[2],\n    w = a[3];\n  out[0] = m[0] * x + m[4] * y + m[8] * z + m[12] * w;\n  out[1] = m[1] * x + m[5] * y + m[9] * z + m[13] * w;\n  out[2] = m[2] * x + m[6] * y + m[10] * z + m[14] * w;\n  out[3] = m[3] * x + m[7] * y + m[11] * z + m[15] * w;\n  return out;\n}\n\n/**\n * Transforms the vec4 with a quat\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the vector to transform\n * @param {ReadonlyQuat} q normalized quaternion to transform with\n * @returns {vec4} out\n */\nexport function transformQuat(out, a, q) {\n  // Fast Vector Rotation using Quaternions by Robert Eisele\n  // https://raw.org/proof/vector-rotation-using-quaternions/\n\n  var qx = q[0],\n    qy = q[1],\n    qz = q[2],\n    qw = q[3];\n  var vx = a[0],\n    vy = a[1],\n    vz = a[2];\n\n  // t = q x v\n  var tx = qy * vz - qz * vy;\n  var ty = qz * vx - qx * vz;\n  var tz = qx * vy - qy * vx;\n\n  // t = 2t\n  tx = tx + tx;\n  ty = ty + ty;\n  tz = tz + tz;\n\n  // v + w t + q x t\n  out[0] = vx + qw * tx + qy * tz - qz * ty;\n  out[1] = vy + qw * ty + qz * tx - qx * tz;\n  out[2] = vz + qw * tz + qx * ty - qy * tx;\n  out[3] = a[3];\n  return out;\n}\n\n/**\n * Set the components of a vec4 to zero\n *\n * @param {vec4} out the receiving vector\n * @returns {vec4} out\n */\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  out[3] = 0.0;\n  return out;\n}\n\n/**\n * Returns a string representation of a vector\n *\n * @param {ReadonlyVec4} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\nexport function str(a) {\n  return \"vec4(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \")\";\n}\n\n/**\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyVec4} a The first vector.\n * @param {ReadonlyVec4} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\n}\n\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {ReadonlyVec4} a The first vector.\n * @param {ReadonlyVec4} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\nexport function equals(a, b) {\n  var a0 = a[0],\n    a1 = a[1],\n    a2 = a[2],\n    a3 = a[3];\n  var b0 = b[0],\n    b1 = b[1],\n    b2 = b[2],\n    b3 = b[3];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3));\n}\n\n/**\n * Alias for {@link vec4.subtract}\n * @function\n */\nexport var sub = subtract;\n\n/**\n * Alias for {@link vec4.multiply}\n * @function\n */\nexport var mul = multiply;\n\n/**\n * Alias for {@link vec4.divide}\n * @function\n */\nexport var div = divide;\n\n/**\n * Alias for {@link vec4.distance}\n * @function\n */\nexport var dist = distance;\n\n/**\n * Alias for {@link vec4.squaredDistance}\n * @function\n */\nexport var sqrDist = squaredDistance;\n\n/**\n * Alias for {@link vec4.length}\n * @function\n */\nexport var len = length;\n\n/**\n * Alias for {@link vec4.squaredLength}\n * @function\n */\nexport var sqrLen = squaredLength;\n\n/**\n * Perform some operation over an array of vec4s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec4. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec4s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n    if (!stride) {\n      stride = 4;\n    }\n    if (!offset) {\n      offset = 0;\n    }\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      vec[2] = a[i + 2];\n      vec[3] = a[i + 3];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n      a[i + 2] = vec[2];\n      a[i + 3] = vec[3];\n    }\n    return a;\n  };\n}();", "import * as glMatrix from \"./common.js\";\n\n/**\n * 2 Dimensional Vector\n * @module vec2\n */\n\n/**\n * Creates a new, empty vec2\n *\n * @returns {vec2} a new 2D vector\n */\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(2);\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n  }\n  return out;\n}\n\n/**\n * Creates a new vec2 initialized with values from an existing vector\n *\n * @param {ReadonlyVec2} a vector to clone\n * @returns {vec2} a new 2D vector\n */\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(2);\n  out[0] = a[0];\n  out[1] = a[1];\n  return out;\n}\n\n/**\n * Creates a new vec2 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @returns {vec2} a new 2D vector\n */\nexport function fromValues(x, y) {\n  var out = new glMatrix.ARRAY_TYPE(2);\n  out[0] = x;\n  out[1] = y;\n  return out;\n}\n\n/**\n * Copy the values from one vec2 to another\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the source vector\n * @returns {vec2} out\n */\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  return out;\n}\n\n/**\n * Set the components of a vec2 to the given values\n *\n * @param {vec2} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @returns {vec2} out\n */\nexport function set(out, x, y) {\n  out[0] = x;\n  out[1] = y;\n  return out;\n}\n\n/**\n * Adds two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  return out;\n}\n\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  return out;\n}\n\n/**\n * Multiplies two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  return out;\n}\n\n/**\n * Divides two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  return out;\n}\n\n/**\n * Math.ceil the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to ceil\n * @returns {vec2} out\n */\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  return out;\n}\n\n/**\n * Math.floor the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to floor\n * @returns {vec2} out\n */\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  return out;\n}\n\n/**\n * Returns the minimum of two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  return out;\n}\n\n/**\n * Returns the maximum of two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  return out;\n}\n\n/**\n * symmetric round the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to round\n * @returns {vec2} out\n */\nexport function round(out, a) {\n  out[0] = glMatrix.round(a[0]);\n  out[1] = glMatrix.round(a[1]);\n  return out;\n}\n\n/**\n * Scales a vec2 by a scalar number\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec2} out\n */\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  return out;\n}\n\n/**\n * Adds two vec2's after scaling the second operand by a scalar value\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec2} out\n */\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  return out;\n}\n\n/**\n * Calculates the euclidian distance between two vec2's\n *\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {Number} distance between a and b\n */\nexport function distance(a, b) {\n  var x = b[0] - a[0],\n    y = b[1] - a[1];\n  return Math.sqrt(x * x + y * y);\n}\n\n/**\n * Calculates the squared euclidian distance between two vec2's\n *\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {Number} squared distance between a and b\n */\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0],\n    y = b[1] - a[1];\n  return x * x + y * y;\n}\n\n/**\n * Calculates the length of a vec2\n *\n * @param {ReadonlyVec2} a vector to calculate length of\n * @returns {Number} length of a\n */\nexport function length(a) {\n  var x = a[0],\n    y = a[1];\n  return Math.sqrt(x * x + y * y);\n}\n\n/**\n * Calculates the squared length of a vec2\n *\n * @param {ReadonlyVec2} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\nexport function squaredLength(a) {\n  var x = a[0],\n    y = a[1];\n  return x * x + y * y;\n}\n\n/**\n * Negates the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to negate\n * @returns {vec2} out\n */\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  return out;\n}\n\n/**\n * Returns the inverse of the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to invert\n * @returns {vec2} out\n */\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  return out;\n}\n\n/**\n * Normalize a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to normalize\n * @returns {vec2} out\n */\nexport function normalize(out, a) {\n  var x = a[0],\n    y = a[1];\n  var len = x * x + y * y;\n  if (len > 0) {\n    //TODO: evaluate use of glm_invsqrt here?\n    len = 1 / Math.sqrt(len);\n  }\n  out[0] = a[0] * len;\n  out[1] = a[1] * len;\n  return out;\n}\n\n/**\n * Calculates the dot product of two vec2's\n *\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {Number} dot product of a and b\n */\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1];\n}\n\n/**\n * Computes the cross product of two vec2's\n * Note that the cross product must by definition produce a 3D vector\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec3} out\n */\nexport function cross(out, a, b) {\n  var z = a[0] * b[1] - a[1] * b[0];\n  out[0] = out[1] = 0;\n  out[2] = z;\n  return out;\n}\n\n/**\n * Performs a linear interpolation between two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec2} out\n */\nexport function lerp(out, a, b, t) {\n  var ax = a[0],\n    ay = a[1];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  return out;\n}\n\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec2} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If omitted, a unit vector will be returned\n * @returns {vec2} out\n */\nexport function random(out, scale) {\n  scale = scale === undefined ? 1.0 : scale;\n  var r = glMatrix.RANDOM() * 2.0 * Math.PI;\n  out[0] = Math.cos(r) * scale;\n  out[1] = Math.sin(r) * scale;\n  return out;\n}\n\n/**\n * Transforms the vec2 with a mat2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat2} m matrix to transform with\n * @returns {vec2} out\n */\nexport function transformMat2(out, a, m) {\n  var x = a[0],\n    y = a[1];\n  out[0] = m[0] * x + m[2] * y;\n  out[1] = m[1] * x + m[3] * y;\n  return out;\n}\n\n/**\n * Transforms the vec2 with a mat2d\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat2d} m matrix to transform with\n * @returns {vec2} out\n */\nexport function transformMat2d(out, a, m) {\n  var x = a[0],\n    y = a[1];\n  out[0] = m[0] * x + m[2] * y + m[4];\n  out[1] = m[1] * x + m[3] * y + m[5];\n  return out;\n}\n\n/**\n * Transforms the vec2 with a mat3\n * 3rd vector component is implicitly '1'\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat3} m matrix to transform with\n * @returns {vec2} out\n */\nexport function transformMat3(out, a, m) {\n  var x = a[0],\n    y = a[1];\n  out[0] = m[0] * x + m[3] * y + m[6];\n  out[1] = m[1] * x + m[4] * y + m[7];\n  return out;\n}\n\n/**\n * Transforms the vec2 with a mat4\n * 3rd vector component is implicitly '0'\n * 4th vector component is implicitly '1'\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat4} m matrix to transform with\n * @returns {vec2} out\n */\nexport function transformMat4(out, a, m) {\n  var x = a[0];\n  var y = a[1];\n  out[0] = m[0] * x + m[4] * y + m[12];\n  out[1] = m[1] * x + m[5] * y + m[13];\n  return out;\n}\n\n/**\n * Rotate a 2D vector\n * @param {vec2} out The receiving vec2\n * @param {ReadonlyVec2} a The vec2 point to rotate\n * @param {ReadonlyVec2} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec2} out\n */\nexport function rotate(out, a, b, rad) {\n  //Translate point to the origin\n  var p0 = a[0] - b[0],\n    p1 = a[1] - b[1],\n    sinC = Math.sin(rad),\n    cosC = Math.cos(rad);\n\n  //perform rotation and translate to correct position\n  out[0] = p0 * cosC - p1 * sinC + b[0];\n  out[1] = p0 * sinC + p1 * cosC + b[1];\n  return out;\n}\n\n/**\n * Get the smallest angle between two 2D vectors\n * @param {ReadonlyVec2} a The first operand\n * @param {ReadonlyVec2} b The second operand\n * @returns {Number} The angle in radians\n */\nexport function angle(a, b) {\n  var ax = a[0],\n    ay = a[1],\n    bx = b[0],\n    by = b[1];\n  return Math.abs(Math.atan2(ay * bx - ax * by, ax * bx + ay * by));\n}\n\n/**\n * Get the signed angle in the interval [-pi,pi] between two 2D vectors (positive if `a` is to the right of `b`)\n * \n * @param {ReadonlyVec2} a The first vector\n * @param {ReadonlyVec2} b The second vector\n * @returns {number} The signed angle in radians\n */\nexport function signedAngle(a, b) {\n  var ax = a[0],\n    ay = a[1],\n    bx = b[0],\n    by = b[1];\n  return Math.atan2(ax * by - ay * bx, ax * bx + ay * by);\n}\n\n/**\n * Set the components of a vec2 to zero\n *\n * @param {vec2} out the receiving vector\n * @returns {vec2} out\n */\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  return out;\n}\n\n/**\n * Returns a string representation of a vector\n *\n * @param {ReadonlyVec2} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\nexport function str(a) {\n  return \"vec2(\" + a[0] + \", \" + a[1] + \")\";\n}\n\n/**\n * Returns whether or not the vectors exactly have the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyVec2} a The first vector.\n * @param {ReadonlyVec2} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1];\n}\n\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {ReadonlyVec2} a The first vector.\n * @param {ReadonlyVec2} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\nexport function equals(a, b) {\n  var a0 = a[0],\n    a1 = a[1];\n  var b0 = b[0],\n    b1 = b[1];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1));\n}\n\n/**\n * Alias for {@link vec2.length}\n * @function\n */\nexport var len = length;\n\n/**\n * Alias for {@link vec2.subtract}\n * @function\n */\nexport var sub = subtract;\n\n/**\n * Alias for {@link vec2.multiply}\n * @function\n */\nexport var mul = multiply;\n\n/**\n * Alias for {@link vec2.divide}\n * @function\n */\nexport var div = divide;\n\n/**\n * Alias for {@link vec2.distance}\n * @function\n */\nexport var dist = distance;\n\n/**\n * Alias for {@link vec2.squaredDistance}\n * @function\n */\nexport var sqrDist = squaredDistance;\n\n/**\n * Alias for {@link vec2.squaredLength}\n * @function\n */\nexport var sqrLen = squaredLength;\n\n/**\n * Perform some operation over an array of vec2s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec2. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec2s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n    if (!stride) {\n      stride = 2;\n    }\n    if (!offset) {\n      offset = 0;\n    }\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n    }\n    return a;\n  };\n}();", "import { vec4 } from 'gl-matrix';\r\n\r\nconst tempQuat = new Float64Array( 16 );\r\nexport function smallestDifferenceQuaternion( output, a, b ) {\r\n\r\n\t// inverting all values yields the same rotation\r\n\tvec4.scale( tempQuat, b, - 1 );\r\n\r\n\t// return the quat that represents the smallest difference\r\n\tif ( vec4.squaredDistance( a, tempQuat ) < vec4.squaredDistance( a, b ) ) {\r\n\r\n\t\tvec4.subtract( output, a, tempQuat );\r\n\r\n\t} else {\r\n\r\n\t\tvec4.subtract( output, a, b );\r\n\r\n\t}\r\n\r\n}\r\n\r\nconst tempQuat2 = new Float64Array( 16 );\r\nexport function quaternionDistance( a, b ) {\r\n\r\n\tsmallestDifferenceQuaternion( tempQuat2, a, b );\r\n\treturn vec4.length( tempQuat2 );\r\n\r\n}\r\n\r\nexport function quaternionSquaredDistance( a, b ) {\r\n\r\n\tsmallestDifferenceQuaternion( tempQuat2, a, b );\r\n\treturn vec4.squaredLength( tempQuat2 );\r\n\r\n}\r\n", "const PI = Math.PI;\r\nconst PI2 = 2 * PI;\r\nconst HALF_PI = PI / 2;\r\nconst DEG2RAD = Math.PI / 180;\r\nconst RAD2DEG = 1 / DEG2RAD;\r\n\r\nexport { PI, PI2, HALF_PI, DEG2RAD, RAD2DEG };\r\n", "import { mat4, quat, vec3 } from 'gl-matrix';\r\nimport { quaternionSquaredDistance } from './utils/quaternion.js';\r\nimport { RAD2DEG } from './utils/constants.js';\r\n\r\nconst tempInverse = new Float32Array( 16 );\r\nconst tempMatrix = new Float32Array( 16 );\r\nconst tempQuat = new Float32Array( 4 );\r\nconst tempPos = new Float32Array( 3 );\r\nconst sharedTraversedChildren = new Set();\r\nconst sharedTraverseArray = [];\r\nlet traverseVariablesInUse = false;\r\n\r\nexport class Frame {\r\n\r\n\tconstructor() {\r\n\r\n\t\tthis.name = '';\r\n\r\n\t\tthis.quaternion = new Float32Array( [ 0, 0, 0, 1 ] );\r\n\t\tthis.position = new Float32Array( 3 );\r\n\r\n\t\tthis.matrix = new Float32Array( 16 );\r\n\t\tmat4.identity( this.matrix );\r\n\r\n\t\tthis.matrixWorld = new Float32Array( 16 );\r\n\t\tmat4.identity( this.matrixWorld );\r\n\r\n\t\tthis.matrixNeedsUpdate = false;\r\n\t\tthis.matrixWorldNeedsUpdate = false;\r\n\r\n\t\tthis.parent = null;\r\n\t\tthis.children = [];\r\n\r\n\t}\r\n\r\n\tsetPosition( ...args ) {\r\n\r\n\t\tconst position = this.position;\r\n\r\n\t\tif ( vec3.sqrDist( position, args ) > 1e-10 ) {\r\n\r\n\t\t\tposition[ 0 ] = args[ 0 ];\r\n\t\t\tposition[ 1 ] = args[ 1 ];\r\n\t\t\tposition[ 2 ] = args[ 2 ];\r\n\t\t\tthis.setMatrixNeedsUpdate();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tsetEuler( x, y, z ) {\r\n\r\n\t\tquat.fromEuler( tempQuat, x * RAD2DEG, y * RAD2DEG, z * RAD2DEG );\r\n\t\tthis.setQuaternion( ...tempQuat );\r\n\r\n\t}\r\n\r\n\tsetQuaternion( ...args ) {\r\n\r\n\t\tconst quaternion = this.quaternion;\r\n\t\tif ( quaternionSquaredDistance( quaternion, args ) > 1e-10 ) {\r\n\r\n\t\t\tquaternion[ 0 ] = args[ 0 ];\r\n\t\t\tquaternion[ 1 ] = args[ 1 ];\r\n\t\t\tquaternion[ 2 ] = args[ 2 ];\r\n\t\t\tquaternion[ 3 ] = args[ 3 ];\r\n\t\t\tthis.setMatrixNeedsUpdate();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tsetWorldPosition( x, y, z ) {\r\n\r\n\t\tconst parent = this.parent;\r\n\r\n\t\ttempPos[ 0 ] = x;\r\n\t\ttempPos[ 1 ] = y;\r\n\t\ttempPos[ 2 ] = z;\r\n\r\n\t\tif ( parent ) {\r\n\r\n\t\t\tparent.updateMatrixWorld();\r\n\t\t\tmat4.invert( tempInverse, parent.matrixWorld );\r\n\t\t\tvec3.transformMat4( tempPos, tempPos, tempInverse );\r\n\r\n\t\t}\r\n\r\n\t\tthis.setPosition( ...tempPos );\r\n\r\n\t}\r\n\r\n\tsetWorldEuler( x, y, z ) {\r\n\r\n\t\tquat.fromEuler( tempQuat, x * RAD2DEG, y * RAD2DEG, z * RAD2DEG );\r\n\t\tthis.setWorldQuaternion( ...tempQuat );\r\n\r\n\t}\r\n\r\n\tsetWorldQuaternion( x, y, z, w ) {\r\n\r\n\t\tconst parent = this;\r\n\r\n\t\ttempQuat[ 0 ] = x;\r\n\t\ttempQuat[ 1 ] = y;\r\n\t\ttempQuat[ 2 ] = z;\r\n\t\ttempQuat[ 3 ] = w;\r\n\r\n\t\tif ( parent ) {\r\n\r\n\t\t\tparent.updateMatrixWorld();\r\n\t\t\tmat4.invert( tempInverse, parent.matrixWorld );\r\n\t\t\tmat4.fromQuat( tempMatrix, tempQuat );\r\n\t\t\tmat4.multiply( tempMatrix, tempInverse, tempMatrix );\r\n\t\t\tmat4.getRotation( tempQuat, tempMatrix );\r\n\r\n\t\t}\r\n\r\n\t\tthis.setQuaternion( ...tempQuat );\r\n\r\n\t}\r\n\r\n\tgetWorldPosition( arr ) {\r\n\r\n\t\tthis.updateMatrixWorld();\r\n\t\tmat4.getTranslation( arr, this.matrixWorld );\r\n\r\n\t}\r\n\r\n\tgetWorldQuaternion( arr ) {\r\n\r\n\t\tthis.updateMatrixWorld();\r\n\t\tmat4.getRotation( arr, this.matrixWorld );\r\n\r\n\t}\r\n\r\n\ttraverseParents( cb ) {\r\n\r\n\t\t// Use the shared variables if they're not already in use to avoid\r\n\t\t// memory allocation\r\n\t\tlet traversedChildren;\r\n\t\tconst originalVariablesInUse = traverseVariablesInUse;\r\n\t\tif ( traverseVariablesInUse ) {\r\n\r\n\t\t\ttraversedChildren = new Set();\r\n\r\n\t\t} else {\r\n\r\n\t\t\ttraversedChildren = sharedTraversedChildren;\r\n\t\t\ttraversedChildren.clear();\r\n\r\n\t\t}\r\n\r\n\t\ttraverseVariablesInUse = true;\r\n\r\n\t\tlet curr = this.parent;\r\n\t\twhile ( curr ) {\r\n\r\n\t\t\tif ( traversedChildren.has( curr ) ) {\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tconst stop = cb( curr );\r\n\t\t\tif ( stop ) {\r\n\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t\ttraversedChildren.add( curr );\r\n\t\t\tcurr = curr.parent;\r\n\r\n\t\t}\r\n\r\n\t\ttraverseVariablesInUse = originalVariablesInUse;\r\n\t\ttraversedChildren.clear();\r\n\r\n\t}\r\n\r\n\ttraverse( cb ) {\r\n\r\n\t\t// Use the shared variables if they're not already in use to avoid\r\n\t\t// memory allocation\r\n\t\tconst originalVariablesInUse = traverseVariablesInUse;\r\n\t\tlet traversedChildren;\r\n\t\tlet stack;\r\n\t\tif ( traverseVariablesInUse ) {\r\n\r\n\t\t\ttraversedChildren = new Set();\r\n\t\t\tstack = [ this ];\r\n\r\n\t\t} else {\r\n\r\n\t\t\ttraversedChildren = sharedTraversedChildren;\r\n\t\t\ttraversedChildren.clear();\r\n\r\n\t\t\tstack = sharedTraverseArray;\r\n\t\t\tstack[ 0 ] = this;\r\n\r\n\t\t}\r\n\r\n\t\ttraverseVariablesInUse = true;\r\n\r\n\t\tlet i = 0;\r\n\t\tlet tot = 1;\r\n\t\twhile ( i < tot ) {\r\n\r\n\t\t\tconst curr = stack[ i ];\r\n\t\t\tconst stop = cb( curr );\r\n\t\t\tif ( ! stop ) {\r\n\r\n\t\t\t\tconst children = curr.children;\r\n\t\t\t\tfor ( let c = 0, l = children.length; c < l; c ++ ) {\r\n\r\n\t\t\t\t\tconst child = children[ c ];\r\n\t\t\t\t\tif ( traversedChildren.has( child ) ) {\r\n\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\ttraversedChildren.add( child );\r\n\t\t\t\t\t\tstack[ tot ] = child;\r\n\t\t\t\t\t\ttot ++;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\ti ++;\r\n\r\n\t\t}\r\n\r\n\t\ttraverseVariablesInUse = originalVariablesInUse;\r\n\t\ttraversedChildren.clear();\r\n\t\tstack.fill( null );\r\n\r\n\t}\r\n\r\n\tfind( cb ) {\r\n\r\n\t\tlet result = null;\r\n\t\tthis.traverse( c => {\r\n\r\n\t\t\tif ( result ) {\r\n\r\n\t\t\t\treturn true;\r\n\r\n\t\t\t} else if ( cb( c ) ) {\r\n\r\n\t\t\t\tresult = c;\r\n\t\t\t\treturn true;\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\t\treturn result;\r\n\r\n\t}\r\n\r\n\taddChild( child ) {\r\n\r\n\t\tif ( child.parent ) {\r\n\r\n\t\t\tthrow new Error( 'Frame: Added child must not already have a parent.' );\r\n\r\n\t\t}\r\n\r\n\t\tif ( child === this ) {\r\n\r\n\t\t\tthrow new Error( 'Frame: Frame cannot be added as a child to itself.' );\r\n\r\n\t\t}\r\n\r\n\t\tthis.traverseParents( p => {\r\n\r\n\t\t\tif ( p === child ) {\r\n\r\n\t\t\t\tthrow new Error( 'Frame: Added child is an ancestor of this Frame. Use Joint.makeClosure instead.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tchild.parent = this;\r\n\t\tthis.children.push( child );\r\n\r\n\t\tchild.setMatrixWorldNeedsUpdate();\r\n\r\n\t}\r\n\r\n\tremoveChild( child ) {\r\n\r\n\t\tif ( child.parent !== this ) {\r\n\r\n\t\t\tthrow new Error( 'Frame: Child to be removed is not a child of this Frame.' );\r\n\r\n\t\t}\r\n\r\n\t\tconst index = this.children.indexOf( child );\r\n\r\n\t\tthis.children.splice( index, 1 );\r\n\t\tchild.parent = null;\r\n\r\n\t\tchild.setMatrixWorldNeedsUpdate();\r\n\r\n\t}\r\n\r\n\tattachChild( child ) {\r\n\r\n\t\tthis.updateMatrixWorld();\r\n\t\tchild.updateMatrixWorld();\r\n\r\n\t\tthis.addChild( child );\r\n\r\n\t\tmat4.invert( tempInverse, this.matrixWorld );\r\n\t\tmat4.multiply( child.matrix, tempInverse, child.matrixWorld );\r\n\t\tmat4.getTranslation( child.position, child.matrix );\r\n\t\tmat4.getRotation( child.quaternion, child.matrix );\r\n\r\n\t}\r\n\r\n\tdetachChild( child ) {\r\n\r\n\t\tthis.updateMatrixWorld();\r\n\t\tchild.updateMatrixWorld();\r\n\r\n\t\tthis.removeChild( child );\r\n\r\n\t\tmat4.copy( child.matrix, child.matrixWorld );\r\n\t\tmat4.getTranslation( child.position, child.matrix );\r\n\t\tmat4.getRotation( child.quaternion, child.matrix );\r\n\r\n\t}\r\n\r\n\tcomputeMatrixWorld() {\r\n\r\n\t\tif ( this.parent ) {\r\n\r\n\t\t\tmat4.multiply( this.matrixWorld, this.parent.matrixWorld, this.matrix );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tmat4.copy( this.matrixWorld, this.matrix );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tsetMatrixNeedsUpdate() {\r\n\r\n\t\tif ( this.matrixNeedsUpdate === false ) {\r\n\r\n\t\t\tthis.matrixNeedsUpdate = true;\r\n\t\t\tthis.setMatrixWorldNeedsUpdate();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tsetMatrixWorldNeedsUpdate() {\r\n\r\n\t\tthis.traverse( c => {\r\n\r\n\t\t\tif ( c.matrixWorldNeedsUpdate ) {\r\n\r\n\t\t\t\treturn true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tc.matrixWorldNeedsUpdate = true;\r\n\t\t\treturn false;\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tupdateMatrix() {\r\n\r\n\t\tif ( this.matrixNeedsUpdate ) {\r\n\r\n\t\t\tmat4.fromRotationTranslation( this.matrix, this.quaternion, this.position );\r\n\t\t\tthis.matrixNeedsUpdate = false;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tupdateMatrixWorld( updateChildren = false ) {\r\n\r\n\t\tconst { parent } = this;\r\n\r\n\t\tif ( this.matrixWorldNeedsUpdate ) {\r\n\r\n\t\t\t// Climb the parent chain and update parent matrices\r\n\t\t\tif ( parent && parent.matrixWorldNeedsUpdate ) {\r\n\r\n\t\t\t\tparent.updateMatrixWorld( false );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Update this matrix\r\n\t\t\tthis.updateMatrix();\r\n\r\n\t\t\t// Update this matrix world and dirty children\r\n\t\t\tthis.computeMatrixWorld();\r\n\t\t\tthis.matrixWorldNeedsUpdate = false;\r\n\r\n\t\t}\r\n\r\n\t\t// Update child matrices\r\n\t\tif ( updateChildren ) {\r\n\r\n\t\t\tthis.traverse( c => {\r\n\r\n\t\t\t\tif ( this !== c ) {\r\n\r\n\t\t\t\t\tc.updateMatrixWorld( false );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n", "import { Frame } from './Frame.js';\r\n\r\nexport class Link extends Frame {\r\n\r\n\tconstructor() {\r\n\r\n\t\tsuper();\r\n\t\tthis.isLink = true;\r\n\t\tthis.closureJoints = [];\r\n\r\n\t}\r\n\r\n\taddChild( child ) {\r\n\r\n\t\tif ( ! child.isJoint ) {\r\n\r\n\t\t\tthrow new Error( 'Link: Added child must be a Joint.' );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tsuper.addChild( child );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n", "import { vec3 } from 'gl-matrix';\r\nimport { PI, PI2, HALF_PI } from './constants.js';\r\n\r\n// Clamp the given angle to ( - PI, PI ]\r\nfunction clampEulerValue( value ) {\r\n\r\n\tlet result = value % PI2;\r\n\tif ( result > PI ) {\r\n\r\n\t\tresult -= PI2;\r\n\r\n\t} else if ( result <= - PI ) {\r\n\r\n\t\tresult += PI2;\r\n\r\n\t}\r\n\r\n\treturn result;\r\n\r\n}\r\n\r\n// Convert `toAdjust` to be the equivalent rotation that is closest to target.\r\nfunction toSmallestEulerValueDistance( target, toAdjust ) {\r\n\r\n\tconst wholeRotation = Math.round( target / PI2 ) * PI2;\r\n\tconst clampedValue = clampEulerValue( toAdjust );\r\n\r\n\tlet result = wholeRotation + clampedValue;\r\n\tconst delta = result - target;\r\n\tif ( Math.abs( delta ) > PI ) {\r\n\r\n\t\tresult -= Math.sign( delta ) * PI2;\r\n\r\n\t}\r\n\r\n\treturn result;\r\n\r\n}\r\n\r\n// Convert the set of euler angles toAdjust to the smallest equivalent rotation\r\n// that is closest to target.\r\nfunction toSmallestEulerDistance( output, target, toAdjust ) {\r\n\r\n\toutput[ 0 ] = toSmallestEulerValueDistance( target[ 0 ], toAdjust[ 0 ] );\r\n\toutput[ 1 ] = toSmallestEulerValueDistance( target[ 1 ], toAdjust[ 1 ] );\r\n\toutput[ 2 ] = toSmallestEulerValueDistance( target[ 2 ], toAdjust[ 2 ] );\r\n\r\n}\r\n\r\n// Return the total diff between euler values\r\nfunction diffEulerDistance( a, b ) {\r\n\r\n\t// if `a` or `b` is a redundant twist representation then we convert them to the\r\n\t// closest twist variation\r\n\r\n\tlet result =\r\n\t\tMath.abs( a[ 0 ] - b[ 0 ] ) +\r\n\t\tMath.abs( a[ 1 ] - b[ 1 ] ) +\r\n\t\tMath.abs( a[ 2 ] - b[ 2 ] );\r\n\r\n\treturn result;\r\n\r\n}\r\n\r\n// Convert the given euler angles to an equivalent rotation\r\nfunction getRedundantEulerRepresentation( output, input ) {\r\n\r\n\toutput[ 0 ] = input[ 0 ] + PI;\r\n\toutput[ 1 ] = PI - input[ 1 ];\r\n\toutput[ 2 ] = input[ 2 ] + PI;\r\n\r\n}\r\n\r\nfunction isRedundantTwist( euler ) {\r\n\r\n\tconst pivotAngle = clampEulerValue( euler[ 1 ] );\r\n\tif ( Math.abs( Math.abs( pivotAngle ) - HALF_PI ) > 1e-7 ) {\r\n\r\n\t\treturn false;\r\n\r\n\t}\r\n\r\n\treturn true;\r\n\r\n}\r\n\r\n// If toAdjust has a redundant rotation axis then find the representation that's closest to\r\n// the target set of angles.\r\nfunction toSmallestRedundantTwistRepresentation( output, target, toAdjust ) {\r\n\r\n\tif ( ! isRedundantTwist( toAdjust ) ) {\r\n\r\n\t\treturn false;\r\n\r\n\t}\r\n\r\n\tconst pivotAngle = clampEulerValue( toAdjust[ 1 ] );\r\n\r\n\t// we have a redundant axis\r\n\tconst zRotationSign = - 1 * Math.sign( pivotAngle );\r\n\tconst combinedXRotation = toAdjust[ 0 ] + zRotationSign * toAdjust[ 2 ];\r\n\r\n\toutput[ 0 ] = target[ 0 ];\r\n\toutput[ 1 ] = toSmallestEulerValueDistance( target[ 1 ], toAdjust[ 1 ] );\r\n\toutput[ 2 ] = toSmallestEulerValueDistance( target[ 2 ], zRotationSign * ( combinedXRotation - target[ 0 ] ) );\r\n\r\n\ttoSmallestEulerDistance( output, target, output );\r\n\r\n\treturn true;\r\n\r\n}\r\n\r\n// Returns the closest euler representation\r\nconst tempEuler1 = new Float64Array( 3 );\r\nconst tempEuler2 = new Float64Array( 3 );\r\nfunction getClosestEulerRepresentation( output, target, input ) {\r\n\r\n\tlet score = Infinity;\r\n\tif ( isRedundantTwist( input ) ) {\r\n\r\n\t\ttoSmallestRedundantTwistRepresentation( tempEuler1, target, input );\r\n\r\n\t\t// TODO: is checking the redundant direction necessary here?\r\n\t\tgetRedundantEulerRepresentation( tempEuler2, input );\r\n\t\ttoSmallestRedundantTwistRepresentation( tempEuler2, target, tempEuler2 );\r\n\r\n\t\tconst d1 = diffEulerDistance( target, tempEuler1 );\r\n\t\tconst d2 = diffEulerDistance( target, tempEuler2 );\r\n\t\tif ( d1 < d2 ) {\r\n\r\n\t\t\tvec3.copy( output, tempEuler1 );\r\n\t\t\tscore = d1;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvec3.copy( output, tempEuler2 );\r\n\t\t\tscore = d2;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// There seems to be a chance that these representations are \"closer\" than the twist ones\r\n\t// in the twist case. Possibly due to numerical precision?\r\n\ttoSmallestEulerDistance( tempEuler1, target, input );\r\n\r\n\tgetRedundantEulerRepresentation( tempEuler2, input );\r\n\ttoSmallestEulerDistance( tempEuler2, target, tempEuler2 );\r\n\r\n\tconst d1 = diffEulerDistance( target, tempEuler1 );\r\n\tconst d2 = diffEulerDistance( target, tempEuler2 );\r\n\tif ( d1 < score || d2 < score ) {\r\n\r\n\t\tif ( d1 < d2 ) {\r\n\r\n\t\t\tvec3.copy( output, tempEuler1 );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvec3.copy( output, tempEuler2 );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport {\r\n\tclampEulerValue,\r\n\ttoSmallestEulerValueDistance,\r\n\ttoSmallestEulerDistance,\r\n\tdiffEulerDistance,\r\n\tgetRedundantEulerRepresentation,\r\n\ttoSmallestRedundantTwistRepresentation,\r\n\tgetClosestEulerRepresentation,\r\n\tisRedundantTwist,\r\n};\r\n\r\n", "// https://github.com/toji/gl-matrix/issues/329\r\nimport { mat4, vec3 } from 'gl-matrix';\r\nimport { RAD2DEG } from './constants.js';\r\nimport { smallestDifferenceQuaternion } from './quaternion.js';\r\n\r\nconst tempPos = new Float64Array( 3 );\r\nconst tempQuat = new Float64Array( 4 );\r\nconst tempPos2 = new Float64Array( 3 );\r\nconst tempQuat2 = new Float64Array( 4 );\r\n\r\n/**\r\n * Returns an euler angle representation of a quaternion\r\n * @param {vec3} out Euler angles, pitch-yaw-roll\r\n * @param {quat} mat Quaternion\r\n * @return {vec3} out\r\n */\r\nexport function getEuler( out, quat ) {\r\n\r\n\t// https://math.stackexchange.com/questions/2975109/how-to-convert-euler-angles-to-quaternions-and-get-the-same-euler-angles-back-fr\r\n\tconst [ x, y, z, w ] = quat;\r\n\r\n\tconst t0 = 2.0 * ( w * x + y * z );\r\n\tconst t1 = 1.0 - 2.0 * ( x * x + y * y );\r\n\tconst roll = Math.atan2( t0, t1 );\r\n\r\n\tlet t2 = 2.0 * ( w * y - z * x );\r\n\tt2 = t2 > 1.0 ? 1.0 : t2;\r\n\tt2 = t2 < - 1.0 ? - 1.0 : t2;\r\n\tconst pitch = Math.asin( t2 );\r\n\r\n\tconst t3 = 2.0 * ( w * z + x * y );\r\n\tconst t4 = 1.0 - 2.0 * ( y * y + z * z );\r\n\tconst yaw = Math.atan2( t3, t4 );\r\n\r\n\tout[ 0 ] = roll * RAD2DEG;\r\n\tout[ 1 ] = pitch * RAD2DEG;\r\n\tout[ 2 ] = yaw * RAD2DEG;\r\n\r\n\treturn out;\r\n\r\n}\r\n\r\nexport function getMatrixDifference( a, b, outPos, outQuat ) {\r\n\r\n\tmat4.getTranslation( tempPos, a );\r\n\tmat4.getRotation( tempQuat, a );\r\n\r\n\tmat4.getTranslation( tempPos2, b );\r\n\tmat4.getRotation( tempQuat2, b );\r\n\r\n\tvec3.subtract( outPos, tempPos, tempPos2 );\r\n\tsmallestDifferenceQuaternion( outQuat, tempQuat, tempQuat2 );\r\n\r\n\t// error of A - B\r\n\r\n}\r\n", "import { mat4, quat } from 'gl-matrix';\r\nimport { Frame } from './Frame.js';\r\nimport { getClosestEulerRepresentation, toSmallestEulerValueDistance } from './utils/euler.js';\r\nimport { getEuler, getMatrixDifference } from './utils/glmatrix.js';\r\nimport { RAD2DEG, DEG2RAD } from './utils/constants.js';\r\n\r\n// degrees of freedom axes\r\nexport const DOF = {\r\n\tX: 0,\r\n\tY: 1,\r\n\tZ: 2,\r\n\tEX: 3,\r\n\tEY: 4,\r\n\tEZ: 5,\r\n};\r\n\r\nexport const DOF_NAMES = Object.entries( DOF ).sort( ( a, b ) => a[ 1 ] - b[ 1 ] ).map( e => e[ 0 ] );\r\n\r\nconst tempInverse = new Float32Array( 16 );\r\nconst tempMatrix = new Float32Array( 16 );\r\nconst tempQuat = new Float32Array( 4 );\r\nconst tempEuler = new Float32Array( 3 );\r\nconst tempValueEuler = new Float32Array( 3 );\r\nconst quatEuler = new Float32Array( 3 );\r\nconst tempDoFValues = new Float32Array( 6 );\r\n\r\n// generate a matrix from a set of degrees of freedom\r\nfunction dofToMatrix( out, dof ) {\r\n\r\n\tquat.fromEuler( tempQuat, dof[ DOF.EX ] * RAD2DEG, dof[ DOF.EY ] * RAD2DEG, dof[ DOF.EZ ] * RAD2DEG );\r\n\tmat4.fromRotationTranslation( out, tempQuat, dof );\r\n\r\n}\r\n\r\nexport class Joint extends Frame {\r\n\r\n\tconstructor() {\r\n\r\n\t\tsuper();\r\n\t\tthis.isJoint = true;\r\n\r\n\t\tthis.child = null;\r\n\t\tthis.isClosure = false;\r\n\r\n\t\tthis.trackJointWrap = false;\r\n\t\tthis.rotationDoFCount = 0;\r\n\t\tthis.translationDoFCount = 0;\r\n\r\n\t\t// TODO: should we make DoF Flags a bit mask flag?\r\n\t\tthis.dof = [];\r\n\t\tthis.dofFlags = new Uint8Array( 6 );\r\n\t\tthis.dofValues = new Float32Array( 6 );\r\n\t\tthis.dofTarget = new Float32Array( 6 );\r\n\t\tthis.dofRestPose = new Float32Array( 6 );\r\n\r\n\t\tthis.minDoFLimit = new Float32Array( 6 ).fill( - Infinity );\r\n\t\tthis.maxDoFLimit = new Float32Array( 6 ).fill( Infinity );\r\n\r\n\t\tthis.targetSet = false;\r\n\t\tthis.restPoseSet = false;\r\n\r\n\t\tthis.matrixDoFNeedsUpdate = false;\r\n\t\tthis.matrixDoF = new Float32Array( 16 );\r\n\t\tmat4.identity( this.matrixDoF );\r\n\r\n\t\tthis.cachedIdentityDoFMatrixWorld = new Float32Array( 16 );\r\n\t\tmat4.identity( this.cachedIdentityDoFMatrixWorld );\r\n\r\n\t\t// TODO: Consider affording control over rotation order\r\n\t\t// TODO: Create pre built joint types\r\n\r\n\t}\r\n\r\n\t// private helpers\r\n\t_getQuaternion( target, outQuat ) {\r\n\r\n\t\tquat.fromEuler( outQuat, target[ DOF.EX ], target[ DOF.EY ], target[ DOF.EZ ] );\r\n\r\n\t}\r\n\r\n\t_getEuler( target, outEuler ) {\r\n\r\n\t\toutEuler[ 0 ] = target[ DOF.EX ];\r\n\t\toutEuler[ 1 ] = target[ DOF.EY ];\r\n\t\toutEuler[ 2 ] = target[ DOF.EZ ];\r\n\r\n\t}\r\n\r\n\t_getPosition( target, outPos ) {\r\n\r\n\t\toutPos[ 0 ] = target[ DOF.X ];\r\n\t\toutPos[ 1 ] = target[ DOF.Y ];\r\n\t\toutPos[ 2 ] = target[ DOF.Z ];\r\n\r\n\t}\r\n\r\n\t_setValue( target, dof, value ) {\r\n\r\n\t\tif ( target === this.minDoFLimit || target == this.maxDoFLimit ) {\r\n\r\n\t\t\tthrow new Error( 'Joint: Cannot set minDoFLimit or maxDoFLimit with _setValue.' );\r\n\r\n\t\t}\r\n\r\n\t\tif ( dof < 0 || dof > 6 || typeof dof !== 'number' ) {\r\n\r\n\t\t\tthrow new Error( 'Joint: Invalid DoF.' );\r\n\r\n\t\t}\r\n\r\n\t\tif ( ! this.dofFlags[ dof ] ) {\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\tconst minVal = this.minDoFLimit[ dof ];\r\n\t\tconst maxVal = this.maxDoFLimit[ dof ];\r\n\r\n\t\tif ( value < minVal ) {\r\n\r\n\t\t\tvalue = minVal;\r\n\r\n\t\t}\r\n\r\n\t\tif ( value > maxVal ) {\r\n\r\n\t\t\tvalue = maxVal;\r\n\r\n\t\t}\r\n\r\n\t\ttarget[ dof ] = value;\r\n\t\treturn value === maxVal || value === minVal;\r\n\r\n\t}\r\n\r\n\t_setValues( target, values ) {\r\n\r\n\t\tconst dof = this.dof;\r\n\t\tfor ( let i = 0, l = values.length; i < l; i ++ ) {\r\n\r\n\t\t\tthis._setValue( target, dof[ i ], values[ i ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// TODO: these functions are unused\r\n\t_setViaFullPosition( target, values ) {\r\n\r\n\t\tconst dofFlags = this.dofFlags;\r\n\t\tfor ( let i = 0; i < 3; i ++ ) {\r\n\r\n\t\t\ttarget[ i ] = dofFlags[ i ] * values[ i ];\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t_setViaFullEuler( target, values ) {\r\n\r\n\t\tconst dofFlags = this.dofFlags;\r\n\t\tfor ( let i = 3; i < 6; i ++ ) {\r\n\r\n\t\t\ttarget[ i ] = dofFlags[ i ] * values[ i - 3 ];\r\n\r\n\t\t}\r\n\r\n\t\tthis.tryMinimizeEulerAngles();\r\n\r\n\t}\r\n\r\n\t_setViaQuaternion( target, values ) {\r\n\r\n\t\tgetEuler( quatEuler, values );\r\n\t\tquatEuler[ 0 ] *= DEG2RAD;\r\n\t\tquatEuler[ 1 ] *= DEG2RAD;\r\n\t\tquatEuler[ 2 ] *= DEG2RAD;\r\n\r\n\t\tif ( this.trackJointWrap ) {\r\n\r\n\t\t\t// if we're tracking joint wrap then set this to be as close as possible to\r\n\t\t\t// the current dof settings.\r\n\t\t\t// TODO: How should restPose work here? Should it always be the shortest distance?\r\n\t\t\tconst dofValues = this.dofValues;\r\n\t\t\ttempEuler[ 0 ] = dofValues[ DOF.EX ];\r\n\t\t\ttempEuler[ 1 ] = dofValues[ DOF.EY ];\r\n\t\t\ttempEuler[ 2 ] = dofValues[ DOF.EZ ];\r\n\t\t\tgetClosestEulerRepresentation( quatEuler, tempEuler, quatEuler );\r\n\r\n\t\t}\r\n\r\n\t\tthis._setViaFullEuler( target, quatEuler );\r\n\r\n\t}\r\n\r\n\t// Set the degrees of freedom\r\n\tclearDoF() {\r\n\r\n\t\tthis.setDoF();\r\n\r\n\t}\r\n\r\n\tsetDoF( ...args ) {\r\n\r\n\t\targs.forEach( ( dof, i ) => {\r\n\r\n\t\t\tif ( dof < 0 || dof >= 6 ) {\r\n\r\n\t\t\t\tthrow new Error( 'Joint: Invalid degree of freedom enum ' + dof + '.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( args.includes( dof, i + 1 ) ) {\r\n\r\n\t\t\t\tthrow new Error( 'Joint: Duplicate degree of freedom ' + DOF_NAMES[ dof ] + 'specified.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( i !== 0 && args[ i - 1 ] > dof ) {\r\n\r\n\t\t\t\tthrow new Error( 'Joint: Joints degrees of freedom must be specified in position then rotation, XYZ order' );\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tthis.dof = args;\r\n\t\tthis.dofValues.fill( 0 );\r\n\t\tthis.dofTarget.fill( 0 );\r\n\t\tthis.dofRestPose.fill( 0 );\r\n\r\n\t\tthis.minDoFLimit.fill( - Infinity );\r\n\t\tthis.maxDoFLimit.fill( Infinity );\r\n\t\tthis.setMatrixDoFNeedsUpdate();\r\n\r\n\t\tfor ( let i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\tthis.dofFlags[ i ] = Number( args.includes( i ) );\r\n\r\n\t\t}\r\n\r\n\t\tthis.rotationDoFCount =\r\n\t\t\tthis.dofFlags[ DOF.EX ] +\r\n\t\t\tthis.dofFlags[ DOF.EY ] +\r\n\t\t\tthis.dofFlags[ DOF.EZ ];\r\n\t\tthis.translationDoFCount =\r\n\t\t\tthis.dofFlags[ DOF.X ] +\r\n\t\t\tthis.dofFlags[ DOF.Y ] +\r\n\t\t\tthis.dofFlags[ DOF.Z ];\r\n\r\n\t}\r\n\r\n\t// Get and set the values of the different degrees of freedom\r\n\tsetDoFValues( ...values ) {\r\n\r\n\t\tthis.setMatrixDoFNeedsUpdate();\r\n\t\tthis._setValues( this.dofValues, values );\r\n\r\n\t}\r\n\r\n\tsetDoFValue( dof, value ) {\r\n\r\n\t\tthis.setMatrixDoFNeedsUpdate();\r\n\t\treturn this._setValue( this.dofValues, dof, value );\r\n\r\n\t}\r\n\r\n\tgetDoFValue( dof ) {\r\n\r\n\t\treturn this.dofValues[ dof ];\r\n\r\n\t}\r\n\r\n\tgetDoFQuaternion( outQuat ) {\r\n\r\n\t\tthis._getQuaternion( this.dofValues, outQuat );\r\n\r\n\t}\r\n\r\n\tgetDoFEuler( outEuler ) {\r\n\r\n\t\tthis._getEuler( this.dofValues, outEuler );\r\n\r\n\t}\r\n\r\n\tgetDoFPosition( outPos ) {\r\n\r\n\t\tthis._getPosition( this.dofValues, outPos );\r\n\r\n\t}\r\n\r\n\t// Get and set the restPose values of the different degrees of freedom\r\n\tsetRestPoseValues( ...values ) {\r\n\r\n\t\tthis._setValues( this.dofRestPose, values );\r\n\r\n\t}\r\n\r\n\tsetRestPoseValue( dof, value ) {\r\n\r\n\t\treturn this._setValue( this.dofRestPose, dof, value );\r\n\r\n\t}\r\n\r\n\tgetRestPoseValue( dof ) {\r\n\r\n\t\treturn this.dofRestPose[ dof ];\r\n\r\n\t}\r\n\r\n\tgetRestPoseQuaternion( outQuat ) {\r\n\r\n\t\tthis._getQuaternion( this.dofRestPose, outQuat );\r\n\r\n\t}\r\n\r\n\tgetRestPoseEuler( outEuler ) {\r\n\r\n\t\tthis._getEuler( this.dofRestPose, outEuler );\r\n\r\n\t}\r\n\r\n\tgetRestPosePosition( outPos ) {\r\n\r\n\t\tthis._getPosition( this.dofRestPose, outPos );\r\n\r\n\t}\r\n\r\n\t// Get and set the restPose values of the different degrees of freedom\r\n\tsetTargetValues( ...values ) {\r\n\r\n\t\tthis._setValues( this.dofTarget, values );\r\n\r\n\t}\r\n\r\n\tsetTargetValue( dof, value ) {\r\n\r\n\t\tthis._setValue( this.dofTarget, dof, value );\r\n\r\n\t}\r\n\r\n\tgetTargetValue( dof ) {\r\n\r\n\t\treturn this.dofTarget[ dof ];\r\n\r\n\t}\r\n\r\n\tgetTargetQuaternion( outQuat ) {\r\n\r\n\t\tthis._getQuaternion( this.dofTarget, outQuat );\r\n\r\n\t}\r\n\r\n\tgetTargetEuler( outEuler ) {\r\n\r\n\t\tthis._getEuler( this.dofTarget, outEuler );\r\n\r\n\t}\r\n\r\n\tgetTargetPosition( outPos ) {\r\n\r\n\t\tthis._getPosition( this.dofTarget, outPos );\r\n\r\n\t}\r\n\r\n\t// Joint Limits\r\n\tsetMinLimits( ...values ) {\r\n\r\n\t\tconst { dof } = this;\r\n\t\tfor ( const i in values ) {\r\n\r\n\t\t\tconst d = dof[ i ];\r\n\t\t\tthis.setMinLimit( d, values[ i ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tsetMinLimit( dof, value ) {\r\n\r\n\t\tthis.minDoFLimit[ dof ] = value;\r\n\t\tthis.setDoFValue( dof, this.dofValues[ dof ] );\r\n\r\n\t}\r\n\r\n\tgetMinLimit( dof ) {\r\n\r\n\t\treturn this.minDoFLimit[ dof ];\r\n\r\n\t}\r\n\r\n\tsetMaxLimits( ...values ) {\r\n\r\n\t\tconst { dof } = this;\r\n\t\tfor ( const i in values ) {\r\n\r\n\t\t\tconst d = dof[ i ];\r\n\t\t\tthis.setMaxLimit( d, values[ i ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tsetMaxLimit( dof, value ) {\r\n\r\n\t\tthis.maxDoFLimit[ dof ] = value;\r\n\t\tthis.setDoFValue( dof, this.dofValues[ dof ] );\r\n\r\n\t}\r\n\r\n\tgetMaxLimit( dof ) {\r\n\r\n\t\treturn this.maxDoFLimit[ dof ];\r\n\r\n\t}\r\n\r\n\t// Returns the error between this joint and the next link if this is a closure.\r\n\t// TODO: remove this and put it in solver\r\n\tgetClosureError( outPos, outQuat ) {\r\n\r\n\t\tif ( ! this.isClosure ) {\r\n\r\n\t\t\tthrow new Error( 'Joint: Cannot get closure error on non closure Joint.' );\r\n\r\n\t\t}\r\n\r\n\t\tthis.updateMatrixWorld();\r\n\t\tthis.child.updateMatrixWorld();\r\n\r\n\t\t// error from this position to child\r\n\t\tgetMatrixDifference( this.matrixWorld, this.child.matrixWorld, outPos, outQuat );\r\n\r\n\t}\r\n\r\n\t// Update matrix overrides\r\n\t// TODO: it might be best if we skip this and try to characterize joint error with quats in\r\n\t// the error vector\r\n\ttryMinimizeEulerAngles() {\r\n\r\n\t\tconst {\r\n\t\t\ttrackJointWrap,\r\n\t\t\trotationDoFCount,\r\n\t\t\tdofRestPose,\r\n\t\t\tdofTarget,\r\n\t\t\tdofValues,\r\n\t\t} = this;\r\n\r\n\t\tif ( ! trackJointWrap ) {\r\n\r\n\t\t\tif ( rotationDoFCount < 3 ) {\r\n\r\n\t\t\t\tfor ( let i = DOF.EX; i <= DOF.EZ; i ++ ) {\r\n\r\n\t\t\t\t\tdofTarget[ i ] = toSmallestEulerValueDistance( dofValues[ i ], dofTarget[ i ] );\r\n\t\t\t\t\tdofRestPose[ i ] = toSmallestEulerValueDistance( dofValues[ i ], dofRestPose[ i ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\ttempValueEuler[ 0 ] = dofValues[ DOF.EX ];\r\n\t\t\t\ttempValueEuler[ 1 ] = dofValues[ DOF.EY ];\r\n\t\t\t\ttempValueEuler[ 2 ] = dofValues[ DOF.EZ ];\r\n\r\n\t\t\t\t// update target\r\n\t\t\t\ttempEuler[ 0 ] = dofTarget[ DOF.EX ];\r\n\t\t\t\ttempEuler[ 1 ] = dofTarget[ DOF.EY ];\r\n\t\t\t\ttempEuler[ 2 ] = dofTarget[ DOF.EZ ];\r\n\r\n\t\t\t\tgetClosestEulerRepresentation( tempEuler, tempValueEuler, tempEuler );\r\n\r\n\t\t\t\tdofTarget[ DOF.EX ] = tempEuler[ 0 ];\r\n\t\t\t\tdofTarget[ DOF.EY ] = tempEuler[ 1 ];\r\n\t\t\t\tdofTarget[ DOF.EZ ] = tempEuler[ 2 ];\r\n\r\n\t\t\t\t// update restPose\r\n\t\t\t\ttempEuler[ 0 ] = dofRestPose[ DOF.EX ];\r\n\t\t\t\ttempEuler[ 1 ] = dofRestPose[ DOF.EY ];\r\n\t\t\t\ttempEuler[ 2 ] = dofRestPose[ DOF.EZ ];\r\n\r\n\t\t\t\tgetClosestEulerRepresentation( tempEuler, tempValueEuler, tempEuler );\r\n\r\n\t\t\t\tdofRestPose[ DOF.EX ] = tempEuler[ 0 ];\r\n\t\t\t\tdofRestPose[ DOF.EY ] = tempEuler[ 1 ];\r\n\t\t\t\tdofRestPose[ DOF.EZ ] = tempEuler[ 2 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tgetDeltaWorldMatrix( dof, delta, outMatrix ) {\r\n\r\n\t\tconst {\r\n\t\t\tdofValues,\r\n\t\t\tminDoFLimit,\r\n\t\t\tmaxDoFLimit,\r\n\t\t\tcachedIdentityDoFMatrixWorld,\r\n\t\t} = this;\r\n\r\n\t\tthis.updateMatrixWorld();\r\n\r\n\t\t// copy out set of dof values\r\n\t\ttempDoFValues.set( dofValues );\r\n\r\n\t\t// get the state\r\n\t\tconst min = minDoFLimit[ dof ];\r\n\t\tconst max = maxDoFLimit[ dof ];\r\n\t\tconst currVal = tempDoFValues[ dof ];\r\n\r\n\t\t// check what our slack is\r\n\t\tconst minSlack = currVal - min;\r\n\t\tconst maxSlack = max - currVal;\r\n\r\n\t\t// If we're constrained by either limit then move in the other direction then\r\n\t\t// use the direction with the most slack.\r\n\t\tlet newVal = currVal + delta;\r\n\t\tconst isMaxConstrained = delta > 0 && newVal > max;\r\n\t\tconst isMinConstrained = delta < 0 && newVal < min;\r\n\t\tconst doInvert = ( isMaxConstrained && minSlack > maxSlack ) || ( isMinConstrained && maxSlack > minSlack );\r\n\t\tif ( doInvert ) {\r\n\r\n\t\t\tnewVal = currVal - delta;\r\n\r\n\t\t}\r\n\r\n\t\t// update our dof array and compute the matrix\r\n\t\ttempDoFValues[ dof ] = newVal;\r\n\r\n\t\tdofToMatrix( tempMatrix, tempDoFValues );\r\n\r\n\t\tmat4.multiply( outMatrix, cachedIdentityDoFMatrixWorld, tempMatrix );\r\n\r\n\t\treturn doInvert;\r\n\r\n\t}\r\n\r\n\t// matrix updates\r\n\tsetMatrixDoFNeedsUpdate() {\r\n\r\n\t\tif ( this.matrixDoFNeedsUpdate === false ) {\r\n\r\n\t\t\tthis.matrixDoFNeedsUpdate = true;\r\n\t\t\tthis.setMatrixWorldNeedsUpdate();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tupdateDoFMatrix() {\r\n\r\n\t\tif ( this.matrixDoFNeedsUpdate ) {\r\n\r\n\t\t\tdofToMatrix( this.matrixDoF, this.dofValues );\r\n\t\t\tthis.matrixDoFNeedsUpdate = false;\r\n\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tcomputeMatrixWorld() {\r\n\r\n\t\tconst {\r\n\t\t\tparent,\r\n\t\t\tmatrixWorld,\r\n\t\t\tmatrix,\r\n\t\t\tmatrixDoF,\r\n\t\t\tcachedIdentityDoFMatrixWorld\r\n\t\t} = this;\r\n\r\n\t\tthis.updateDoFMatrix();\r\n\r\n\t\tmat4.multiply( matrixWorld, matrix, matrixDoF );\r\n\t\tif ( parent ) {\r\n\r\n\t\t\tmat4.multiply( matrixWorld, parent.matrixWorld, matrixWorld );\r\n\t\t\tmat4.multiply( cachedIdentityDoFMatrixWorld, parent.matrixWorld, matrix );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tmat4.copy( cachedIdentityDoFMatrixWorld, matrix );\r\n\r\n\t\t}\r\n\r\n\r\n\r\n\t}\r\n\r\n\t// Add child overrides\r\n\tmakeClosure( child ) {\r\n\r\n\t\tif ( ! child.isLink || this.child || child.parent === this ) {\r\n\r\n\t\t\tthrow new Error( 'Joint: Given child cannot be used to make closure.' );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// don't store the closure child in the children array to avoid\r\n\t\t\t// implicit traversal.\r\n\t\t\tthis.child = child;\r\n\t\t\tthis.isClosure = true;\r\n\t\t\tchild.closureJoints.push( this );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\taddChild( child ) {\r\n\r\n\t\tif ( ! child.isLink || this.child || child.parent === this ) {\r\n\r\n\t\t\tthrow new Error( 'Joint: Given child cannot be added to Joint.' );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tsuper.addChild( child );\r\n\t\t\tthis.child = child;\r\n\t\t\tthis.isClosure = false;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tremoveChild( child ) {\r\n\r\n\t\tif ( this.isClosure ) {\r\n\r\n\t\t\tif ( this.child !== child ) {\r\n\r\n\t\t\t\tthrow new Error( 'Frame: Child to be removed is not a child of this Joint.' );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.child = null;\r\n\t\t\t\tthis.isClosure = false;\r\n\r\n\t\t\t\tconst index = child.closureJoints.indexOf( this );\r\n\t\t\t\tchild.closureJoints.splice( index, 1 );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tsuper.removeChild( child );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tattachChild( child ) {\r\n\r\n\t\tsuper.attachChild( child );\r\n\r\n\t\t// remove the dof rotation afterward\r\n\t\tmat4.invert( tempInverse, this.matrixDoF );\r\n\t\tmat4.multiply( child.matrix, tempInverse, child.matrix );\r\n\t\tmat4.getTranslation( child.position, child.matrix );\r\n\t\tmat4.getRotation( child.quaternion, child.matrix );\r\n\r\n\t}\r\n\r\n\tdetachChild( child ) {\r\n\r\n\t\tsuper.detachChild( child );\r\n\r\n\t\t// remove the dof rotation afterward\r\n\t\tmat4.invert( tempInverse, this.matrixDoF );\r\n\t\tmat4.multiply( child.matrix, tempInverse, child.matrix );\r\n\t\tmat4.getTranslation( child.position, child.matrix );\r\n\t\tmat4.getRotation( child.quaternion, child.matrix );\r\n\r\n\t}\r\n\r\n}\r\n", "import { Joint, DOF } from './Joint.js';\r\n\r\nexport class Goal extends Joint {\r\n\r\n\tconstructor( ...args ) {\r\n\r\n\t\tsuper( ...args );\r\n\t\tthis.isGoal = true;\r\n\t\tthis.setFreeDoF();\r\n\r\n\t}\r\n\r\n\tsetDoF( ...args ) {\r\n\r\n\t\t// We don't support rotation goals that only specify 1 or 2 free rotation axes.\r\n\t\tlet rotCount =\r\n\t\t\tNumber( args.includes( DOF.EX ) ) +\r\n\t\t\tNumber( args.includes( DOF.EY ) ) +\r\n\t\t\tNumber( args.includes( DOF.EZ ) );\r\n\r\n\t\tif ( rotCount !== 0 && rotCount !== 3 ) {\r\n\r\n\t\t\tthrow new Error( 'Goal: Only full 3 DoF or 0 DoF rotation goals are supported.' );\r\n\r\n\t\t}\r\n\r\n\t\tsuper.setDoF( ...args );\r\n\r\n\t}\r\n\r\n\tsetGoalDoF( ...args ) {\r\n\r\n\t\tthis.setDoF( ...args );\r\n\r\n\t}\r\n\r\n\tsetFreeDoF( ...args ) {\r\n\r\n\t\tconst freeDoF = [\r\n\t\t\tDOF.X, DOF.Y, DOF.Z,\r\n\t\t\tDOF.EX, DOF.EY, DOF.EZ,\r\n\t\t].filter( d => ! args.includes( d ) );\r\n\t\tthis.setDoF( ...freeDoF );\r\n\r\n\t}\r\n\r\n\taddChild() {\r\n\r\n\t\tthrow new Error( 'Goal: Cannot add children to Goal.' );\r\n\r\n\t}\r\n\r\n}\r\n", "import { vec3, vec4 } from 'gl-matrix';\r\nimport { DOF } from '../Joint.js';\r\n\r\nconst tempPos = new Float64Array( 3 );\r\nconst tempQuat = new Float64Array( 4 );\r\nconst tempEuler = new Float64Array( 3 );\r\nexport function accumulateClosureError(\r\n\tsolver,\r\n\tjoint,\r\n\tstartIndex,\r\n\terrorVector = null,\r\n\tresult = { isConverged: false, rowCount: 7, totalError: 0 }\r\n) {\r\n\r\n\tconst {\r\n\t\ttranslationConvergeThreshold,\r\n\t\trotationConvergeThreshold,\r\n\t\ttranslationErrorClamp,\r\n\t\trotationErrorClamp,\r\n\t\ttranslationFactor,\r\n\t\trotationFactor,\r\n\t} = solver;\r\n\r\n\tconst {\r\n\t\ttranslationDoFCount,\r\n\t\trotationDoFCount,\r\n\t\tdofFlags,\r\n\t\tdof,\r\n\t} = joint;\r\n\r\n\t// Get the error from child towards the closure target\r\n\tjoint.getClosureError( tempPos, tempQuat );\r\n\r\n\tlet rowCount = 7;\r\n\tif ( joint.isGoal ) {\r\n\r\n\t\ttempPos[ 0 ] *= dofFlags[ 0 ];\r\n\t\ttempPos[ 1 ] *= dofFlags[ 1 ];\r\n\t\ttempPos[ 2 ] *= dofFlags[ 2 ];\r\n\t\trowCount = translationDoFCount;\r\n\r\n\t\tif ( rotationDoFCount === 0 ) {\r\n\r\n\t\t\ttempQuat[ 0 ] = 0;\r\n\t\t\ttempQuat[ 1 ] = 0;\r\n\t\t\ttempQuat[ 2 ] = 0;\r\n\t\t\ttempQuat[ 3 ] = 0;\r\n\r\n\t\t} else {\r\n\r\n\t\t\trowCount += 4;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tlet isConverged = false;\r\n\tlet totalError = 0;\r\n\tconst posMag = vec3.length( tempPos );\r\n\tconst rotMag = vec4.length( tempQuat );\r\n\tif (\r\n\t\tposMag < translationConvergeThreshold &&\r\n\t\trotMag < rotationConvergeThreshold\r\n\t) {\r\n\r\n\t\tisConverged = true;\r\n\r\n\t}\r\n\r\n\ttotalError += posMag + rotMag;\r\n\r\n\tif ( errorVector ) {\r\n\r\n\t\tif ( posMag > translationErrorClamp ) {\r\n\r\n\t\t\tvec3.scale( tempPos, tempPos, translationErrorClamp / posMag );\r\n\r\n\t\t}\r\n\r\n\t\tvec4.scale( tempPos, tempPos, translationFactor );\r\n\r\n\t\tif ( rotMag > rotationErrorClamp ) {\r\n\r\n\t\t\tvec4.scale( tempQuat, tempQuat, rotationErrorClamp / rotMag );\r\n\r\n\t\t}\r\n\r\n\t\tvec4.scale( tempQuat, tempQuat, rotationFactor );\r\n\r\n\t\tif ( joint.isGoal ) {\r\n\r\n\t\t\tfor ( let i = 0; i < translationDoFCount; i ++ ) {\r\n\r\n\t\t\t\tconst d = dof[ i ];\r\n\t\t\t\terrorVector[ startIndex + i ][ 0 ] = tempPos[ d ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( joint.rotationDoFCount === 3 ) {\r\n\r\n\t\t\t\terrorVector[ startIndex + translationDoFCount + 0 ][ 0 ] = tempQuat[ 0 ];\r\n\t\t\t\terrorVector[ startIndex + translationDoFCount + 1 ][ 0 ] = tempQuat[ 1 ];\r\n\t\t\t\terrorVector[ startIndex + translationDoFCount + 2 ][ 0 ] = tempQuat[ 2 ];\r\n\t\t\t\terrorVector[ startIndex + translationDoFCount + 3 ][ 0 ] = tempQuat[ 3 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\terrorVector[ startIndex + 0 ][ 0 ] = tempPos[ 0 ];\r\n\t\t\terrorVector[ startIndex + 1 ][ 0 ] = tempPos[ 1 ];\r\n\t\t\terrorVector[ startIndex + 2 ][ 0 ] = tempPos[ 2 ];\r\n\r\n\t\t\terrorVector[ startIndex + 3 ][ 0 ] = tempQuat[ 0 ];\r\n\t\t\terrorVector[ startIndex + 4 ][ 0 ] = tempQuat[ 1 ];\r\n\t\t\terrorVector[ startIndex + 5 ][ 0 ] = tempQuat[ 2 ];\r\n\t\t\terrorVector[ startIndex + 6 ][ 0 ] = tempQuat[ 3 ];\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tresult.totalError = totalError;\r\n\tresult.isConverged = isConverged;\r\n\tresult.rowCount = rowCount;\r\n\treturn result;\r\n\r\n}\r\n\r\nexport function accumulateTargetError(\r\n\tsolver,\r\n\tjoint,\r\n\tstartIndex,\r\n\terrorVector = null,\r\n\tresult = { isConverged: false, rowCount: 7, totalError: 0 }\r\n) {\r\n\r\n\t// Find whether or not the target has converged or not\r\n\tconst {\r\n\t\ttranslationConvergeThreshold,\r\n\t\trotationConvergeThreshold,\r\n\t\tlockedJointDoFCount,\r\n\t\ttranslationErrorClamp,\r\n\t\trotationErrorClamp,\r\n\t\tlockedJointDoF,\r\n\t} = solver;\r\n\r\n\tconst {\r\n\t\tdofTarget,\r\n\t\tdofValues,\r\n\t\ttranslationDoFCount,\r\n\t\trotationDoFCount,\r\n\t\ttranslationFactor,\r\n\t\trotationFactor,\r\n\t\tdofList,\r\n\t} = joint;\r\n\r\n\t// get the position delta\r\n\tconst posDelta = vec3.distance( dofValues, dofTarget );\r\n\r\n\t// TODO: if three euler angles are being used we should set this to a quaternion to measure\r\n\t// error rather than euler angles. We should instead just always use quaternions for targets\r\n\t// for now.\r\n\t// Before running this solver we try to ensure the target and restPose are minimized\r\n\tlet rotDelta =\r\n\t\tdofTarget[ DOF.EX ] - dofValues[ DOF.EX ] +\r\n\t\tdofTarget[ DOF.EY ] - dofValues[ DOF.EY ] +\r\n\t\tdofTarget[ DOF.EZ ] - dofValues[ DOF.EZ ];\r\n\r\n\t// Get the row count\r\n\tconst lockedDoFCount = lockedJointDoFCount.get( joint ) || 0;\r\n\tresult.rowCount = translationDoFCount + rotationDoFCount - lockedDoFCount;\r\n\tresult.isConverged = posDelta < translationConvergeThreshold && rotDelta < rotationConvergeThreshold;\r\n\tresult.totalError = posDelta + rotDelta;\r\n\r\n\tif ( errorVector ) {\r\n\r\n\t\tconst lockedDoF = lockedJointDoF.get( joint );\r\n\t\tconst isLocked = lockedDoFCount !== 0;\r\n\r\n\t\tlet rowIndex = 0;\r\n\r\n\t\t// error from current state to target\r\n\t\ttempPos[ 0 ] = dofTarget[ 0 ] - dofValues[ 0 ];\r\n\t\ttempPos[ 1 ] = dofTarget[ 1 ] - dofValues[ 1 ];\r\n\t\ttempPos[ 2 ] = dofTarget[ 2 ] - dofValues[ 2 ];\r\n\r\n\t\t// clamp the position delta to the max error step\r\n\t\tconst posMag = vec3.length( tempPos );\r\n\t\tvec3.scale( tempPos, tempPos, translationFactor * translationErrorClamp / posMag );\r\n\t\tfor ( let i = 0, l = translationDoFCount; i < l; i ++ ) {\r\n\r\n\t\t\tconst dof = dofList[ i ];\r\n\r\n\t\t\t// skip this degree of freedom if it's locked\r\n\t\t\tif ( isLocked && lockedDoF[ dof ] ) {\r\n\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\t}\r\n\r\n\t\t\terrorVector[ startIndex + rowIndex ][ 0 ] = tempPos[ dof ];\r\n\t\t\trowIndex ++;\r\n\r\n\t\t}\r\n\r\n\t\t// get the euler differences\r\n\t\t// before running this solver we minimize the euler targets\r\n\t\ttempEuler[ 0 ] = joint.dofTarget[ 3 ] - joint.dofValues[ 3 ];\r\n\t\ttempEuler[ 1 ] = joint.dofTarget[ 4 ] - joint.dofValues[ 4 ];\r\n\t\ttempEuler[ 2 ] = joint.dofTarget[ 5 ] - joint.dofValues[ 5 ];\r\n\r\n\t\t// clamp the euler difference to the error step magnitude\r\n\t\tconst eulerMag = vec3.length( tempEuler );\r\n\t\tvec3.scale( tempEuler, tempEuler, rotationFactor * rotationErrorClamp / eulerMag );\r\n\t\tfor ( let i = translationDoFCount, l = translationDoFCount + rotationDoFCount; i < l; i ++ ) {\r\n\r\n\t\t\tconst dof = dofList[ i ];\r\n\r\n\t\t\t// skip this degree of freedom if it's locked\r\n\t\t\tif ( isLocked && lockedDoF[ dof ] ) {\r\n\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\t}\r\n\r\n\t\t\terrorVector[ startIndex + rowIndex ][ 0 ] = tempEuler[ dof ];\r\n\t\t\trowIndex ++;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n", "import linearSolve from 'linear-solve';\r\nimport { SVD } from 'svd-js';\r\n\r\nfunction transpose( outMatrix, a ) {\r\n\r\n\tconst tr = a.length;\r\n\tconst tc = a[ 0 ].length;\r\n\r\n\tfor ( let r = 0; r < tr; r ++ ) {\r\n\r\n\t\tfor ( let c = 0; c < tc; c ++ ) {\r\n\r\n\t\t\toutMatrix[ c ][ r ] = a[ r ][ c ];\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction identity( outMatrix ) {\r\n\r\n\tfor ( let r = 0, tr = outMatrix.length; r < tr; r ++ ) {\r\n\r\n\t\tfor ( let c = 0, tc = outMatrix.length; c < tc; c ++ ) {\r\n\r\n\t\t\toutMatrix[ r ][ c ] = r === c ? 1 : 0;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction scale( outMatrix, matrix, scalar ) {\r\n\r\n\tfor ( let r = 0, tr = outMatrix.length; r < tr; r ++ ) {\r\n\r\n\t\tfor ( let c = 0, tc = outMatrix.length; c < tc; c ++ ) {\r\n\r\n\t\t\toutMatrix[ r ][ c ] = matrix[ r ][ c ] * scalar;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction multiply( outMatrix, a, b ) {\r\n\r\n\tif ( a === outMatrix || b === outMatrix ) {\r\n\r\n\t\tthrow new Error( 'Matrix: Cannot multiply to a matrix in place.' );\r\n\r\n\t}\r\n\r\n\t// a is m x n\r\n\t// b is n x k\r\n\t// outMatrix is m x k\r\n\r\n\t// m = a rows\r\n\t// n = a cols or b rows\r\n\t// k = b cols\r\n\r\n\tconst m = a.length;\r\n\tconst n = b.length;\r\n\tconst k = b[ 0 ].length;\r\n\r\n\t// iterate over m\r\n\tfor ( let r = 0, tr = m; r < tr; r ++ ) {\r\n\r\n\t\t// iterate over k\r\n\t\tfor ( let c = 0, tc = k; c < tc; c ++ ) {\r\n\r\n\t\t\tlet sum = 0;\r\n\r\n\t\t\t// iterate over n\r\n\t\t\tfor ( let i = 0, ti = n; i < ti; i ++ ) {\r\n\r\n\t\t\t\tsum += a[ r ][ i ] * b[ i ][ c ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\toutMatrix[ r ][ c ] = sum;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction create( row, col ) {\r\n\r\n\tconst result = new Array( row );\r\n\tfor ( let i = 0; i < row; i ++ ) {\r\n\r\n\t\tresult[ i ] = new Float64Array( col );\r\n\r\n\t}\r\n\r\n\treturn result;\r\n\r\n}\r\n\r\nfunction copy( outMatrix, sourceMatrix ) {\r\n\r\n\tconst tr = sourceMatrix.length;\r\n\tconst tc = sourceMatrix[ 0 ].length;\r\n\tfor ( let r = 0; r < tr; r ++ ) {\r\n\r\n\t\tfor ( let c = 0; c < tc; c ++ ) {\r\n\r\n\t\t\toutMatrix[ r ][ c ] = sourceMatrix[ r ][ c ];\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction clone( matrix ) {\r\n\r\n\tconst rows = matrix.length;\r\n\tconst cols = matrix[ 0 ].length;\r\n\tconst resultMatrix = create( rows, cols );\r\n\tcopy( resultMatrix, matrix );\r\n\treturn resultMatrix;\r\n\r\n}\r\n\r\nfunction solve( outMatrix, matrix, vector ) {\r\n\r\n\tconst res = linearSolve.solve( matrix, vector );\r\n\tfor ( let i = 0, l = res.length; i < l; i ++ ) {\r\n\r\n\t\toutMatrix[ i ].set( res[ i ] );\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction svd( ru, rq, rv, matrix ) {\r\n\r\n\tconst { u, v, q } = SVD( matrix );\r\n\r\n\tconst urows = u.length;\r\n\tfor ( let r = 0; r < urows; r ++ ) {\r\n\r\n\t\tru[ r ].set( u[ r ] );\r\n\r\n\t}\r\n\r\n\tconst vrows = v.length;\r\n\tfor ( let r = 0; r < vrows; r ++ ) {\r\n\r\n\t\trv[ r ].set( v[ r ] );\r\n\r\n\t}\r\n\r\n\tconst qrows = q.length;\r\n\tfor ( let r = 0; r < qrows; r ++ ) {\r\n\r\n\t\tconst rqrow = rq[ r ];\r\n\t\tconst qval = q[ r ];\r\n\t\trqrow.fill( 0 );\r\n\t\trqrow[ r ] = qval;\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction invert( outMatrix, matrix ) {\r\n\r\n\tconst res = linearSolve.invert( matrix );\r\n\r\n\tconst tr = matrix[ 0 ].length;\r\n\tconst tc = matrix.length;\r\n\tfor ( let r = 0; r < tr; r ++ ) {\r\n\r\n\t\tfor ( let c = 0; c < tc; c ++ ) {\r\n\r\n\t\t\toutMatrix[ r ][ c ] = res[ r ][ c ];\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction add( outMatrix, a, b ) {\r\n\r\n\tconst tr = a.length;\r\n\tconst tc = a[ 0 ].length;\r\n\tfor ( let r = 0; r < tr; r ++ ) {\r\n\r\n\t\tfor ( let c = 0; c < tc; c ++ ) {\r\n\r\n\t\t\toutMatrix[ r ][ c ] = a[ r ][ c ] + b[ r ][ c ];\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction subtract( outMatrix, a, b ) {\r\n\r\n\tconst tr = a.length;\r\n\tconst tc = a[ 0 ].length;\r\n\tfor ( let r = 0; r < tr; r ++ ) {\r\n\r\n\t\tfor ( let c = 0; c < tc; c ++ ) {\r\n\r\n\t\t\toutMatrix[ r ][ c ] = a[ r ][ c ] - b[ r ][ c ];\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction magnitudeSquared( matrix ) {\r\n\r\n\tlet sum = 0;\r\n\tconst rows = matrix.length;\r\n\tconst cols = matrix[ 0 ].length;\r\n\tfor ( let r = 0; r < rows; r ++ ) {\r\n\r\n\t\tfor ( let c = 0; c < cols; c ++ ) {\r\n\r\n\t\t\tsum += matrix[ r ][ c ] ** 2;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn sum;\r\n\r\n}\r\n\r\nfunction magnitude( matrix ) {\r\n\r\n\treturn Math.sqrt( magnitudeSquared( matrix ) );\r\n\r\n}\r\n\r\nfunction toString( matrix, dec = 3 ) {\r\n\r\n\tconst rows = matrix.length;\r\n\tconst cols = matrix[ 0 ].length;\r\n\tlet str = '';\r\n\tfor ( let r = 0; r < rows; r ++ ) {\r\n\r\n\t\tfor ( let c = 0; c < cols; c ++ ) {\r\n\r\n\t\t\tstr += matrix[ r ][ c ].toFixed( dec ) + ', ';\r\n\r\n\t\t}\r\n\r\n\t\tstr += '\\n';\r\n\r\n\t}\r\n\r\n\treturn str;\r\n\r\n}\r\n\r\nfunction log( matrix, dec ) {\r\n\r\n\tconsole.log( toString( matrix, dec ) );\r\n\r\n}\r\n\r\nexport const mat = {\r\n\ttranspose,\r\n\tidentity,\r\n\tscale,\r\n\tmultiply,\r\n\tcreate,\r\n\tcopy,\r\n\tclone,\r\n\tsolve,\r\n\tsvd,\r\n\tinvert,\r\n\tadd,\r\n\tsubtract,\r\n\tmagnitudeSquared,\r\n\tmagnitude,\r\n\ttoString,\r\n\tlog,\r\n};\r\n", "/** SVD procedure as explained in \"Singular Value Decomposition and Least Squares Solutions. By G.H. Golub et al.\"\n *\n * This procedure computes the singular values and complete orthogonal decomposition of a real rectangular matrix A:\n *    A = U * diag(q) * V(t), U(t) * U = V(t) * V = I\n * where the arrays a, u, v, q represent A, U, V, q respectively. The actual parameters corresponding to a, u, v may\n * all be identical unless withu = withv = {true}. In this case, the actual parameters corresponding to u and v must\n * differ. m >= n is assumed (with m = a.length and n = a[0].length)\n *\n *  @param a {Array} Represents the matrix A to be decomposed\n *  @param [withu] {bool} {true} if U is desired {false} otherwise\n *  @param [withv] {bool} {true} if U is desired {false} otherwise\n *  @param [eps] {Number} A constant used in the test for convergence; should not be smaller than the machine precision\n *  @param [tol] {Number} A machine dependent constant which should be set equal to B/eps0 where B is the smallest\n *    positive number representable in the computer\n *\n *  @returns {Object} An object containing:\n *    q: A vector holding the singular values of A; they are non-negative but not necessarily ordered in\n *      decreasing sequence\n *    u: Represents the matrix U with orthonormalized columns (if withu is {true} otherwise u is used as\n *      a working storage)\n *    v: Represents the orthogonal matrix V (if withv is {true}, otherwise v is not used)\n *\n */\nvar SVD = function SVD(a, withu, withv, eps, tol) {\n  // Define default parameters\n  withu = withu !== undefined ? withu : true;\n  withv = withv !== undefined ? withv : true;\n  eps = eps || Math.pow(2, -52);\n  tol = 1e-64 / eps; // throw error if a is not defined\n\n  if (!a) {\n    throw new TypeError('Matrix a is not defined');\n  } // Householder's reduction to bidiagonal form\n\n\n  var n = a[0].length;\n  var m = a.length;\n\n  if (m < n) {\n    throw new TypeError('Invalid matrix: m < n');\n  }\n\n  var i, j, k, l, l1, c, f, g, h, s, x, y, z;\n  g = 0;\n  x = 0;\n  var e = [];\n  var u = [];\n  var v = [];\n  var mOrN = withu === 'f' ? m : n; // Initialize u\n\n  for (i = 0; i < m; i++) {\n    u[i] = new Array(mOrN).fill(0);\n  } // Initialize v\n\n\n  for (i = 0; i < n; i++) {\n    v[i] = new Array(n).fill(0);\n  } // Initialize q\n\n\n  var q = new Array(n).fill(0); // Copy array a in u\n\n  for (i = 0; i < m; i++) {\n    for (j = 0; j < n; j++) {\n      u[i][j] = a[i][j];\n    }\n  }\n\n  for (i = 0; i < n; i++) {\n    e[i] = g;\n    s = 0;\n    l = i + 1;\n\n    for (j = i; j < m; j++) {\n      s += Math.pow(u[j][i], 2);\n    }\n\n    if (s < tol) {\n      g = 0;\n    } else {\n      f = u[i][i];\n      g = f < 0 ? Math.sqrt(s) : -Math.sqrt(s);\n      h = f * g - s;\n      u[i][i] = f - g;\n\n      for (j = l; j < n; j++) {\n        s = 0;\n\n        for (k = i; k < m; k++) {\n          s += u[k][i] * u[k][j];\n        }\n\n        f = s / h;\n\n        for (k = i; k < m; k++) {\n          u[k][j] = u[k][j] + f * u[k][i];\n        }\n      }\n    }\n\n    q[i] = g;\n    s = 0;\n\n    for (j = l; j < n; j++) {\n      s += Math.pow(u[i][j], 2);\n    }\n\n    if (s < tol) {\n      g = 0;\n    } else {\n      f = u[i][i + 1];\n      g = f < 0 ? Math.sqrt(s) : -Math.sqrt(s);\n      h = f * g - s;\n      u[i][i + 1] = f - g;\n\n      for (j = l; j < n; j++) {\n        e[j] = u[i][j] / h;\n      }\n\n      for (j = l; j < m; j++) {\n        s = 0;\n\n        for (k = l; k < n; k++) {\n          s += u[j][k] * u[i][k];\n        }\n\n        for (k = l; k < n; k++) {\n          u[j][k] = u[j][k] + s * e[k];\n        }\n      }\n    }\n\n    y = Math.abs(q[i]) + Math.abs(e[i]);\n\n    if (y > x) {\n      x = y;\n    }\n  } // Accumulation of right-hand transformations\n\n\n  if (withv) {\n    for (i = n - 1; i >= 0; i--) {\n      if (g !== 0) {\n        h = u[i][i + 1] * g;\n\n        for (j = l; j < n; j++) {\n          v[j][i] = u[i][j] / h;\n        }\n\n        for (j = l; j < n; j++) {\n          s = 0;\n\n          for (k = l; k < n; k++) {\n            s += u[i][k] * v[k][j];\n          }\n\n          for (k = l; k < n; k++) {\n            v[k][j] = v[k][j] + s * v[k][i];\n          }\n        }\n      }\n\n      for (j = l; j < n; j++) {\n        v[i][j] = 0;\n        v[j][i] = 0;\n      }\n\n      v[i][i] = 1;\n      g = e[i];\n      l = i;\n    }\n  } // Accumulation of left-hand transformations\n\n\n  if (withu) {\n    if (withu === 'f') {\n      for (i = n; i < m; i++) {\n        for (j = n; j < m; j++) {\n          u[i][j] = 0;\n        }\n\n        u[i][i] = 1;\n      }\n    }\n\n    for (i = n - 1; i >= 0; i--) {\n      l = i + 1;\n      g = q[i];\n\n      for (j = l; j < mOrN; j++) {\n        u[i][j] = 0;\n      }\n\n      if (g !== 0) {\n        h = u[i][i] * g;\n\n        for (j = l; j < mOrN; j++) {\n          s = 0;\n\n          for (k = l; k < m; k++) {\n            s += u[k][i] * u[k][j];\n          }\n\n          f = s / h;\n\n          for (k = i; k < m; k++) {\n            u[k][j] = u[k][j] + f * u[k][i];\n          }\n        }\n\n        for (j = i; j < m; j++) {\n          u[j][i] = u[j][i] / g;\n        }\n      } else {\n        for (j = i; j < m; j++) {\n          u[j][i] = 0;\n        }\n      }\n\n      u[i][i] = u[i][i] + 1;\n    }\n  } // Diagonalization of the bidiagonal form\n\n\n  eps = eps * x;\n  var testConvergence;\n\n  for (k = n - 1; k >= 0; k--) {\n    for (var iteration = 0; iteration < 50; iteration++) {\n      // test-f-splitting\n      testConvergence = false;\n\n      for (l = k; l >= 0; l--) {\n        if (Math.abs(e[l]) <= eps) {\n          testConvergence = true;\n          break;\n        }\n\n        if (Math.abs(q[l - 1]) <= eps) {\n          break;\n        }\n      }\n\n      if (!testConvergence) {\n        // cancellation of e[l] if l>0\n        c = 0;\n        s = 1;\n        l1 = l - 1;\n\n        for (i = l; i < k + 1; i++) {\n          f = s * e[i];\n          e[i] = c * e[i];\n\n          if (Math.abs(f) <= eps) {\n            break; // goto test-f-convergence\n          }\n\n          g = q[i];\n          q[i] = Math.sqrt(f * f + g * g);\n          h = q[i];\n          c = g / h;\n          s = -f / h;\n\n          if (withu) {\n            for (j = 0; j < m; j++) {\n              y = u[j][l1];\n              z = u[j][i];\n              u[j][l1] = y * c + z * s;\n              u[j][i] = -y * s + z * c;\n            }\n          }\n        }\n      } // test f convergence\n\n\n      z = q[k];\n\n      if (l === k) {\n        // convergence\n        if (z < 0) {\n          // q[k] is made non-negative\n          q[k] = -z;\n\n          if (withv) {\n            for (j = 0; j < n; j++) {\n              v[j][k] = -v[j][k];\n            }\n          }\n        }\n\n        break; // break out of iteration loop and move on to next k value\n      } // Shift from bottom 2x2 minor\n\n\n      x = q[l];\n      y = q[k - 1];\n      g = e[k - 1];\n      h = e[k];\n      f = ((y - z) * (y + z) + (g - h) * (g + h)) / (2 * h * y);\n      g = Math.sqrt(f * f + 1);\n      f = ((x - z) * (x + z) + h * (y / (f < 0 ? f - g : f + g) - h)) / x; // Next QR transformation\n\n      c = 1;\n      s = 1;\n\n      for (i = l + 1; i < k + 1; i++) {\n        g = e[i];\n        y = q[i];\n        h = s * g;\n        g = c * g;\n        z = Math.sqrt(f * f + h * h);\n        e[i - 1] = z;\n        c = f / z;\n        s = h / z;\n        f = x * c + g * s;\n        g = -x * s + g * c;\n        h = y * s;\n        y = y * c;\n\n        if (withv) {\n          for (j = 0; j < n; j++) {\n            x = v[j][i - 1];\n            z = v[j][i];\n            v[j][i - 1] = x * c + z * s;\n            v[j][i] = -x * s + z * c;\n          }\n        }\n\n        z = Math.sqrt(f * f + h * h);\n        q[i - 1] = z;\n        c = f / z;\n        s = h / z;\n        f = c * g + s * y;\n        x = -s * g + c * y;\n\n        if (withu) {\n          for (j = 0; j < m; j++) {\n            y = u[j][i - 1];\n            z = u[j][i];\n            u[j][i - 1] = y * c + z * s;\n            u[j][i] = -y * s + z * c;\n          }\n        }\n      }\n\n      e[l] = 0;\n      e[k] = f;\n      q[k] = x;\n    }\n  } // Number below eps should be zero\n\n\n  for (i = 0; i < n; i++) {\n    if (q[i] < eps) q[i] = 0;\n  }\n\n  return {\n    u: u,\n    q: q,\n    v: v\n  };\n};\n\nexport default SVD;", "import { vec3, vec4, mat4 } from 'gl-matrix';\r\nimport { accumulateClosureError, accumulateTargetError } from './utils/solver.js';\r\nimport { mat } from './utils/matrix.js';\r\nimport { getMatrixDifference } from './utils/glmatrix.js';\r\n\r\n// temp reusable variables\r\nconst targetRelativeToJointMatrix = new Float64Array( 16 );\r\nconst targetDeltaWorldMatrix = new Float64Array( 16 );\r\nconst tempDeltaWorldMatrix = new Float64Array( 16 );\r\nconst tempInverseMatrixWorld = new Float64Array( 16 );\r\nconst tempQuat = new Float64Array( 4 );\r\nconst tempPos = new Float64Array( 3 );\r\nconst tempQuat2 = new Float64Array( 4 );\r\nconst tempPos2 = new Float64Array( 3 );\r\n\r\nconst targetJoints = [];\r\nconst freeJoints = [];\r\nconst errorResultInfo = {\r\n\trowCount: 0,\r\n\tisConverged: false,\r\n\ttotalError: 0,\r\n};\r\nconst dofResultInfo = {\r\n\terrorRows: 0,\r\n\tfreeDoF: 0,\r\n\ttotalError: 0,\r\n};\r\n\r\nexport const SOLVE_STATUS = {\r\n\r\n\tCONVERGED: 0,\r\n\tSTALLED: 1,\r\n\tDIVERGED: 2,\r\n\tTIMEOUT: 3,\r\n\r\n};\r\n\r\nexport const SOLVE_STATUS_NAMES = Object.entries( SOLVE_STATUS ).sort( ( a, b ) => a[ 1 ] - b[ 1 ] ).map( el => el[ 0 ] );\r\n\r\nexport class ChainSolver {\r\n\r\n\tconstructor( chain ) {\r\n\r\n\t\tthis.chain = Array.from( chain );\r\n\r\n\t\t// list of targets we're trying to minimize in the chain\r\n\t\tthis.targets = null;\r\n\r\n\t\t// map of joint -> closures that the given joint affects\r\n\t\tthis.affectedClosures = null;\r\n\r\n\t\t// map of joint -> closure children that the given joint affects\r\n\t\tthis.affectedConnectedClosures = null;\r\n\r\n\t\t// map of joint -> that stores the amount of DoF that are locked after\r\n\t\t// hitting a joint limit.\r\n\t\t// Undefined or 0 if none are locked\r\n\t\tthis.lockedJointDoFCount = null;\r\n\r\n\t\t// map of joint -> list of locked DoF\r\n\t\tthis.lockedJointDoF = null;\r\n\r\n\t\t// map of joint -> previous joint angles for resetting joint angles on\r\n\t\t// divergence check.\r\n\t\tthis.prevDoFValues = null;\r\n\r\n\t\t// options -- these are set by the containing Solver.\r\n\t\tthis.maxIterations = - 1;\r\n\r\n\t\tthis.matrixPool = null;\r\n\r\n\t\tthis.useSVD = false;\r\n\r\n\t\tthis.translationConvergeThreshold = - 1;\r\n\t\tthis.rotationConvergeThreshold = - 1;\r\n\r\n\t\tthis.translationFactor = - 1;\r\n\t\tthis.rotationFactor = - 1;\r\n\r\n\t\tthis.translationStep = - 1;\r\n\t\tthis.rotationStep = - 1;\r\n\r\n\t\tthis.translationErrorClamp = - 1;\r\n\t\tthis.rotationErrorClamp = - 1;\r\n\r\n\t\tthis.stallThreshold = - 1;\r\n\t\tthis.dampingFactor = - 1;\r\n\t\tthis.divergeThreshold = - 1;\r\n\t\tthis.restPoseFactor = - 1;\r\n\r\n\t\tthis.init();\r\n\r\n\t}\r\n\r\n\tinit() {\r\n\r\n\t\t// Find all joints with targets.\r\n\t\tconst chain = this.chain;\r\n\t\tconst targets = chain.filter( j => j.targetSet || j.isClosure );\r\n\r\n\t\tconst lockedJointDoF = new Map();\r\n\t\tconst lockedJointDoFCount = new Map();\r\n\t\tconst prevDoFValues = new Map();\r\n\r\n\t\tconst affectedClosures = new Map();\r\n\t\tconst affectedConnectedClosures = new Map();\r\n\t\tchain.forEach( j => {\r\n\r\n\t\t\t// Track which joints will have a direct affect on which targets move\r\n\t\t\t// for closure end effectors.\r\n\t\t\taffectedClosures.set( j, new Set() );\r\n\t\t\taffectedConnectedClosures.set( j, new Set() );\r\n\r\n\t\t\t// Initialize our array with all possible degrees of freedom\r\n\t\t\tlockedJointDoF.set( j, new Uint8Array( 6 ) );\r\n\t\t\tprevDoFValues.set( j, new Float64Array( 6 ) );\r\n\r\n\t\t} );\r\n\r\n\t\ttargets.forEach( target => {\r\n\r\n\t\t\tif ( target.isClosure ) {\r\n\r\n\t\t\t\tlet currJoint = target;\r\n\r\n\t\t\t\t// climb the joint tree and mark every joint as affecting this closure end.\r\n\t\t\t\twhile ( currJoint ) {\r\n\r\n\t\t\t\t\tif ( currJoint.isJoint ) {\r\n\r\n\t\t\t\t\t\taffectedClosures.get( currJoint ).add( target );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcurrJoint = currJoint.parent;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// and mark the joints up the other chain as effecting the other connector link.\r\n\t\t\t\tcurrJoint = target.child;\r\n\t\t\t\twhile ( currJoint ) {\r\n\r\n\t\t\t\t\tif ( currJoint.isJoint ) {\r\n\r\n\t\t\t\t\t\taffectedConnectedClosures.get( currJoint ).add( target );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcurrJoint = currJoint.parent;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tthis.targets = targets;\r\n\t\tthis.affectedClosures = affectedClosures;\r\n\t\tthis.affectedConnectedClosures = affectedConnectedClosures;\r\n\t\tthis.lockedJointDoF = lockedJointDoF;\r\n\t\tthis.lockedJointDoFCount = lockedJointDoFCount;\r\n\t\tthis.prevDoFValues = prevDoFValues;\r\n\r\n\t}\r\n\r\n\tsolve() {\r\n\r\n\t\tconst {\r\n\t\t\tdivergeThreshold,\r\n\t\t\tstallThreshold,\r\n\t\t\tchain,\r\n\t\t\trestPoseFactor,\r\n\t\t\tlockedJointDoFCount,\r\n\t\t\tprevDoFValues,\r\n\t\t\tuseSVD,\r\n\t\t\tmatrixPool,\r\n\t\t} = this;\r\n\r\n\t\tlet iterations = 0;\r\n\t\tlet prevErrorMagnitude = Infinity;\r\n\t\tlet status = - 1;\r\n\r\n\t\t// Clear out all the locked joints\r\n\t\tlockedJointDoFCount.clear();\r\n\r\n\t\t// TODO: instead of trying to use minimal euler angles we should try to represent joint\r\n\t\t// error as a quaternion in the quaternion vector.\r\n\t\tfor ( let i = 0, l = chain.length; i < l; i ++ ) {\r\n\r\n\t\t\tconst joint = chain[ i ];\r\n\t\t\tif ( joint.targetSet || joint.restPoseSet ) {\r\n\r\n\t\t\t\tjoint.tryMinimizeEulerAngles();\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tdo {\r\n\r\n\t\t\tmatrixPool.releaseAll();\r\n\r\n\t\t\t// Make sure our matrices are all up to date\r\n\t\t\tfor ( let i = 0, l = chain.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tconst joint = chain[ i ];\r\n\t\t\t\tjoint.updateMatrixWorld();\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// TODO: this only needs to be recomputed if a joint was locked so maybe lets check that? We also\r\n\t\t\t// lock joints inside this function so maybe we can forgo that?\r\n\t\t\ttargetJoints.length = 0;\r\n\t\t\tfreeJoints.length = 0;\r\n\t\t\tthis.countUnconvergedVariables( freeJoints, targetJoints, dofResultInfo );\r\n\t\t\tconst { freeDoF, errorRows, totalError } = dofResultInfo;\r\n\r\n\t\t\t// Check if we've converged\r\n\t\t\tif ( errorRows === 0 ) {\r\n\r\n\t\t\t\tstatus = SOLVE_STATUS.CONVERGED;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Check if we've diverged\r\n\t\t\tif ( totalError > prevErrorMagnitude + divergeThreshold ) {\r\n\r\n\t\t\t\tprevDoFValues.forEach( ( dofValues, joint ) => {\r\n\r\n\t\t\t\t\tjoint.dofValues.set( dofValues );\r\n\t\t\t\t\tjoint.setMatrixDoFNeedsUpdate();\r\n\r\n\t\t\t\t} );\r\n\r\n\r\n\t\t\t\tstatus = SOLVE_STATUS.DIVERGED;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tprevErrorMagnitude = totalError;\r\n\r\n\t\t\t// Check if we've hit max iterations\r\n\t\t\titerations ++;\r\n\t\t\tif ( iterations > this.maxIterations ) {\r\n\r\n\t\t\t\tstatus = SOLVE_STATUS.TIMEOUT;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// A * x = b\r\n\t\t\t// find x such that it yields b where is the clamped error we're trying to work towards\r\n\t\t\t// and A is the jacobian, and x is the delta joint angles.\r\n\r\n\t\t\tconst errorVector = matrixPool.get( errorRows, 1 );\r\n\t\t\tthis.fillErrorVector( targetJoints, errorVector );\r\n\r\n\t\t\tconst jacobian = matrixPool.get( errorRows, freeDoF );\r\n\t\t\tthis.fillJacobian( targetJoints, freeJoints, jacobian );\r\n\r\n\t\t\t// Solve for the pseudo inverse of the jacobian\r\n\t\t\tconst pseudoInverse = matrixPool.get( freeDoF, errorRows );\r\n\t\t\tlet failedSVD = false;\r\n\t\t\tif ( useSVD ) {\r\n\r\n\t\t\t\ttry {\r\n\r\n\t\t\t\t\tconst m = errorRows;\r\n\t\t\t\t\tconst n = freeDoF;\r\n\t\t\t\t\tconst k = Math.min( m, n );\r\n\r\n\t\t\t\t\tconst u = matrixPool.get( m, k ); // m x k\r\n\t\t\t\t\tconst q = matrixPool.get( k, k ); // k x k\r\n\t\t\t\t\tconst v = matrixPool.get( n, k ); // ( k x n )^T -> ( n x k )\r\n\r\n\t\t\t\t\tmat.svd( u, q, v, jacobian );\r\n\r\n\t\t\t\t\tconst uTranspose = matrixPool.get( k, m );\r\n\t\t\t\t\tconst qInverse = matrixPool.get( k, k );\r\n\t\t\t\t\tmat.transpose( uTranspose, u );\r\n\r\n\t\t\t\t\t// if the diagonal value is close to 0 when taking the inverse\r\n\t\t\t\t\t// then set it to zero.\r\n\t\t\t\t\tfor ( let i = 0, l = q.length; i < l; i ++ ) {\r\n\r\n\t\t\t\t\t\tconst val = q[ i ][ i ];\r\n\t\t\t\t\t\tlet inv;\r\n\t\t\t\t\t\tif ( Math.abs( val ) < 0.001 ) {\r\n\r\n\t\t\t\t\t\t\tinv = 0;\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tinv = 1 / val;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tqInverse[ i ][ i ] = inv;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// V * Qinv * Ut\r\n\t\t\t\t\tconst vqinv = matrixPool.get( n, k );\r\n\t\t\t\t\tmat.multiply( vqinv, v, qInverse );\r\n\t\t\t\t\tmat.multiply( pseudoInverse, vqinv, uTranspose );\r\n\r\n\t\t\t\t} catch ( err ) {\r\n\r\n\t\t\t\t\tfailedSVD = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( ! useSVD || failedSVD ) {\r\n\r\n\t\t\t\t// Use a transpose pseudo inverse approach: A^T * A * x = A^T * b with the damping term\r\n\t\t\t\t// J^T * J * x = J^T * e\r\n\t\t\t\t// x = J^T * ( J * J^T )^-1 * e\r\n\r\n\t\t\t\t// and with the adding damping\r\n\t\t\t\t// x = J^T * ( J * J^T + l^2 * I )^-1 * e\r\n\r\n\t\t\t\t// l^2 * I\r\n\t\t\t\tconst jacobianIdentityDamping = matrixPool.get( errorRows, errorRows );\r\n\t\t\t\tmat.identity( jacobianIdentityDamping );\r\n\t\t\t\tmat.scale( jacobianIdentityDamping, jacobianIdentityDamping, this.dampingFactor ** 2 );\r\n\r\n\t\t\t\t// J^T\r\n\t\t\t\tconst jacobianTranspose = matrixPool.get( freeDoF, errorRows );\r\n\t\t\t\tmat.transpose( jacobianTranspose, jacobian );\r\n\r\n\t\t\t\t// J * J^T\r\n\t\t\t\tconst jjt = matrixPool.get( errorRows, errorRows );\r\n\t\t\t\tmat.multiply( jjt, jacobian, jacobianTranspose );\r\n\r\n\t\t\t\t// J * J^T + l^2 * I\r\n\t\t\t\tconst jjti = matrixPool.get( errorRows, errorRows );\r\n\t\t\t\tmat.add( jjti, jjt, jacobianIdentityDamping );\r\n\r\n\t\t\t\t// ( J * J^T + l^2 * I )^-1\r\n\t\t\t\tconst jjtii = matrixPool.get( errorRows, errorRows );\r\n\t\t\t\tmat.invert( jjtii, jjti );\r\n\r\n\t\t\t\t// J^T * ( J * J^T + l^2 * I )^-1\r\n\t\t\t\tmat.multiply( pseudoInverse, jacobianTranspose, jjtii );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// x = deltaTheta = J^T * ( J * J^T + l^2 * I )^-1 * e\r\n\t\t\tconst deltaTheta = matrixPool.get( freeDoF, 1 );\r\n\t\t\tmat.multiply( deltaTheta, pseudoInverse, errorVector );\r\n\r\n\t\t\tif ( restPoseFactor !== 0 ) {\r\n\r\n\t\t\t\t// Nullspace Projection\r\n\t\t\t\t// I - J^-1 * J is the orthogonal null space of J where J^-1 is the pseudoinverse\r\n\t\t\t\t// Multiplied by the rest position of each dof\r\n\t\t\t\t// ( I - J^-1 * J ) * restPose\r\n\t\t\t\tconst restPose = matrixPool.get( freeDoF, 1 );\r\n\t\t\t\tconst restPoseResult = matrixPool.get( freeDoF, 1 );\r\n\t\t\t\tlet colIndex = 0;\r\n\t\t\t\tfor ( let i = 0, l = freeJoints.length; i < l; i ++ ) {\r\n\r\n\t\t\t\t\tconst joint = freeJoints[ i ];\r\n\t\t\t\t\tconst lockedDoFCount = this.lockedJointDoFCount.get( joint ) || 0;\r\n\t\t\t\t\tconst isLocked = lockedDoFCount !== 0;\r\n\t\t\t\t\tconst lockedDoF = this.lockedJointDoF.get( joint );\r\n\r\n\t\t\t\t\tconst colCount = joint.rotationDoFCount + joint.translationDoFCount - lockedDoFCount;\r\n\t\t\t\t\tif ( joint.restPoseSet ) {\r\n\r\n\t\t\t\t\t\tconst dofList = joint.dof;\r\n\t\t\t\t\t\tconst dofValues = joint.dofValues;\r\n\t\t\t\t\t\tconst dofRestPose = joint.dofRestPose;\r\n\t\t\t\t\t\tfor ( let d = 0; d < colCount; d ++ ) {\r\n\r\n\t\t\t\t\t\t\tconst dof = dofList[ d ];\r\n\r\n\t\t\t\t\t\t\tif ( isLocked && lockedDoF[ dof ] ) continue;\r\n\r\n\t\t\t\t\t\t\trestPose[ colIndex ][ 0 ] = dofRestPose[ dof ] - dofValues[ dof ];\r\n\t\t\t\t\t\t\tcolIndex ++;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tfor ( let d = 0; d < colCount; d ++ ) {\r\n\r\n\t\t\t\t\t\t\trestPose[ colIndex ][ 0 ] = 0;\r\n\t\t\t\t\t\t\tcolIndex ++;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// J^-1 * J\r\n\t\t\t\tconst jij = matrixPool.get( freeDoF, freeDoF );\r\n\t\t\t\tmat.multiply( jij, pseudoInverse, jacobian );\r\n\r\n\t\t\t\t// ( I - J^-1 * J )\r\n\t\t\t\tconst ident = matrixPool.get( freeDoF, freeDoF );\r\n\t\t\t\tmat.identity( ident );\r\n\r\n\t\t\t\tconst nullSpaceProjection = matrixPool.get( freeDoF, freeDoF );\r\n\t\t\t\tmat.subtract( nullSpaceProjection, ident, jij );\r\n\r\n\t\t\t\t// ( I - J^-1 * J ) * restPose\r\n\t\t\t\tmat.multiply( restPoseResult, nullSpaceProjection, restPose );\r\n\r\n\t\t\t\tfor ( let r = 0; r < freeDoF; r ++ ) {\r\n\r\n\t\t\t\t\tconst val = restPoseResult[ r ][ 0 ];\r\n\t\t\t\t\tdeltaTheta[ r ][ 0 ] += val * restPoseFactor;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Check if our joints have not moved and returned stalled\r\n\t\t\tif ( stallThreshold > 0 ) {\r\n\r\n\t\t\t\tlet stalled = true;\r\n\t\t\t\tfor ( let i = 0, l = deltaTheta.length; i < l; i ++ ) {\r\n\r\n\t\t\t\t\tconst delta = deltaTheta[ i ][ 0 ];\r\n\t\t\t\t\tif ( Math.abs( delta ) > stallThreshold ) {\r\n\r\n\t\t\t\t\t\tstalled = false;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( stalled ) {\r\n\r\n\t\t\t\t\tstatus = SOLVE_STATUS.STALLED;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Prep for a divergence check\r\n\t\t\tprevDoFValues.forEach( ( dofValues, joint ) => {\r\n\r\n\t\t\t\tdofValues.set( joint.dofValues );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\t// apply the latest joint angles and lock and joints that have\r\n\t\t\t// hit their joint limits.\r\n\t\t\tthis.applyJointAngles( freeJoints, deltaTheta );\r\n\r\n\t\t\t// there's still error and we're under the max iterations\r\n\r\n\t\t} while ( true );\r\n\r\n\t\ttargetJoints.length = 0;\r\n\t\tfreeJoints.length = 0;\r\n\t\treturn status;\r\n\r\n\t}\r\n\r\n\t// Apply the delta values from the solve to the free joints in the list\r\n\tapplyJointAngles( freeJoints, deltaTheta ) {\r\n\r\n\t\tconst {\r\n\t\t\tlockedJointDoF,\r\n\t\t\tlockedJointDoFCount,\r\n\t\t} = this;\r\n\r\n\t\tlet lockedJoint = false;\r\n\t\tlet dti = 0;\r\n\t\tfor ( let i = 0, l = freeJoints.length; i < l; i ++ ) {\r\n\r\n\t\t\t// Apply the delta to every free joint\r\n\t\t\tconst joint = freeJoints[ i ];\r\n\t\t\tconst dofList = joint.dof;\r\n\t\t\tconst lockedDoF = lockedJointDoF.get( joint );\r\n\t\t\tconst isLocked = lockedJointDoFCount.has( joint );\r\n\r\n\t\t\tfor ( let d = 0, l = dofList.length; d < l; d ++ ) {\r\n\r\n\t\t\t\tconst dof = dofList[ d ];\r\n\t\t\t\tif ( isLocked && lockedDoF[ dof ] ) {\r\n\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst value = joint.getDoFValue( dof );\r\n\t\t\t\tconst hitLimit = joint.setDoFValue( dof, value + deltaTheta[ dti ][ 0 ] );\r\n\r\n\t\t\t\t// lock the joint if we hit a limit\r\n\t\t\t\tif ( hitLimit ) {\r\n\r\n\t\t\t\t\tif ( ! lockedJointDoFCount.has( joint ) ) {\r\n\r\n\t\t\t\t\t\tlockedJointDoFCount.set( joint, 0 );\r\n\t\t\t\t\t\tlockedDoF.fill( 0 );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst lockedCount = lockedJointDoFCount.get( joint );\r\n\t\t\t\t\tlockedJointDoFCount.set( joint, lockedCount + 1 );\r\n\t\t\t\t\tlockedDoF[ dof ] = 1;\r\n\t\t\t\t\tlockedJoint = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdti ++;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( dti !== deltaTheta.length ) {\r\n\r\n\t\t\tthrow new Error();\r\n\r\n\t\t}\r\n\r\n\t\treturn lockedJoint;\r\n\r\n\t}\r\n\r\n\t// generate the jacobian\r\n\t// The jacobian has one column for each free degree of freedom and a row for every\r\n\t// target degree of freedom we have. The entries are generated by adjusting every\r\n\t// DoF by some epsilon and storing how much it affected the target error.\r\n\tfillJacobian( targetJoints, freeJoints, outJacobian ) {\r\n\r\n\t\tconst {\r\n\t\t\ttranslationStep,\r\n\t\t\trotationStep,\r\n\t\t\tlockedJointDoF,\r\n\t\t\tlockedJointDoFCount,\r\n\t\t\ttranslationFactor,\r\n\t\t\trotationFactor,\r\n\t\t} = this;\r\n\r\n\t\t// TODO: abstract this\r\n\t\tconst affectedClosures = this.affectedClosures;\r\n\t\tconst affectedConnectedClosures = this.affectedConnectedClosures;\r\n\r\n\t\tlet colIndex = 0;\r\n\t\tfor ( let c = 0, tc = freeJoints.length; c < tc; c ++ ) {\r\n\r\n\t\t\t// TODO: If this is a goal we should skip adding it to the jacabian columns\r\n\t\t\tconst freeJoint = freeJoints[ c ];\r\n\t\t\tconst relevantClosures = affectedClosures.get( freeJoint );\r\n\t\t\tconst relevantConnectedClosures = affectedConnectedClosures.get( freeJoint );\r\n\t\t\tconst dofList = freeJoint.dof;\r\n\t\t\tconst colCount = freeJoint.translationDoFCount + freeJoint.rotationDoFCount;\r\n\r\n\t\t\tconst isLocked = lockedJointDoFCount.has( freeJoint );\r\n\t\t\tconst lockedDoF = lockedJointDoF.get( freeJoint );\r\n\r\n\t\t\t// get the world inverse of the free joint\r\n\t\t\tmat4.invert( tempInverseMatrixWorld, freeJoint.matrixWorld );\r\n\r\n\t\t\t// iterate over every degree of freedom in the joint\r\n\t\t\tfor ( let co = 0; co < colCount; co ++ ) {\r\n\r\n\t\t\t\tconst dof = dofList[ co ];\r\n\r\n\t\t\t\t// skip this joint if it's locked\r\n\t\t\t\tif ( isLocked && lockedDoF[ dof ] ) {\r\n\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet rowIndex = 0;\r\n\r\n\t\t\t\t// generate the adjusted matrix based on the epsilon for the joint.\r\n\t\t\t\tlet delta = dof < 3 ? translationStep : rotationStep;\r\n\t\t\t\tif ( freeJoint.getDeltaWorldMatrix( dof, delta, tempDeltaWorldMatrix ) ) {\r\n\r\n\t\t\t\t\tdelta *= - 1;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Iterate over every target\r\n\t\t\t\tfor ( let r = 0, tr = targetJoints.length; r < tr; r ++ ) {\r\n\r\n\t\t\t\t\tconst targetJoint = targetJoints[ r ];\r\n\r\n\t\t\t\t\t// if it's a closure target\r\n\t\t\t\t\tif ( targetJoint.isClosure ) {\r\n\r\n\t\t\t\t\t\tif ( relevantClosures.has( targetJoint ) || relevantConnectedClosures.has( targetJoint ) ) {\r\n\r\n\t\t\t\t\t\t\t// TODO: If this is a Goal it only add 1 or 2 fields if only two axes are set. Quat is only\r\n\t\t\t\t\t\t\t// needed if 3 eulers are used.\r\n\t\t\t\t\t\t\t// TODO: these could be cached per target joint get the current error within the closure joint\r\n\r\n\t\t\t\t\t\t\t// Get the error from child towards the closure target\r\n\t\t\t\t\t\t\ttargetJoint.getClosureError( tempPos, tempQuat );\r\n\t\t\t\t\t\t\tif ( relevantConnectedClosures.has( targetJoint ) ) {\r\n\r\n\t\t\t\t\t\t\t\t// If this is affecting a link connected to a closure joint then adjust that child link by\r\n\t\t\t\t\t\t\t\t// the delta rotation.\r\n\t\t\t\t\t\t\t\tmat4.multiply( targetRelativeToJointMatrix, tempInverseMatrixWorld, targetJoint.child.matrixWorld );\r\n\t\t\t\t\t\t\t\tmat4.multiply( targetDeltaWorldMatrix, tempDeltaWorldMatrix, targetRelativeToJointMatrix );\r\n\r\n\t\t\t\t\t\t\t\t// Get the new error\r\n\t\t\t\t\t\t\t\tgetMatrixDifference( targetJoint.matrixWorld, targetDeltaWorldMatrix, tempPos2, tempQuat2 );\r\n\r\n\t\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t\t// If this is directly affecting a closure joint then adjust that child link by the delta\r\n\t\t\t\t\t\t\t\t// rotation.\r\n\t\t\t\t\t\t\t\tmat4.multiply( targetRelativeToJointMatrix, tempInverseMatrixWorld, targetJoint.matrixWorld );\r\n\t\t\t\t\t\t\t\tmat4.multiply( targetDeltaWorldMatrix, tempDeltaWorldMatrix, targetRelativeToJointMatrix );\r\n\r\n\t\t\t\t\t\t\t\t// Get the new error\r\n\t\t\t\t\t\t\t\tgetMatrixDifference( targetDeltaWorldMatrix, targetJoint.child.matrixWorld, tempPos2, tempQuat2 );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Get the amount that the rotation and translation error changed due to the\r\n\t\t\t\t\t\t\t// small DoF adjustment to serve as the derivative.\r\n\t\t\t\t\t\t\tvec3.subtract( tempPos, tempPos, tempPos2 );\r\n\t\t\t\t\t\t\tvec3.scale( tempPos, tempPos, translationFactor / delta );\r\n\r\n\t\t\t\t\t\t\tvec4.subtract( tempQuat, tempQuat, tempQuat2 );\r\n\t\t\t\t\t\t\tvec4.scale( tempQuat, tempQuat, rotationFactor / delta );\r\n\r\n\t\t\t\t\t\t\tif ( targetJoint.isGoal ) {\r\n\r\n\t\t\t\t\t\t\t\tconst { translationDoFCount, rotationDoFCount, dof } = targetJoint;\r\n\t\t\t\t\t\t\t\tfor ( let i = 0; i < translationDoFCount; i ++ ) {\r\n\r\n\t\t\t\t\t\t\t\t\tconst d = dof[ i ];\r\n\t\t\t\t\t\t\t\t\toutJacobian[ rowIndex + i ][ colIndex ] = tempPos[ d ];\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif ( rotationDoFCount === 3 ) {\r\n\r\n\t\t\t\t\t\t\t\t\toutJacobian[ rowIndex + translationDoFCount + 0 ][ colIndex ] = tempQuat[ 0 ];\r\n\t\t\t\t\t\t\t\t\toutJacobian[ rowIndex + translationDoFCount + 1 ][ colIndex ] = tempQuat[ 1 ];\r\n\t\t\t\t\t\t\t\t\toutJacobian[ rowIndex + translationDoFCount + 2 ][ colIndex ] = tempQuat[ 2 ];\r\n\t\t\t\t\t\t\t\t\toutJacobian[ rowIndex + translationDoFCount + 3 ][ colIndex ] = tempQuat[ 3 ];\r\n\t\t\t\t\t\t\t\t\trowIndex += 4;\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\trowIndex += translationDoFCount;\r\n\r\n\t\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t\t// set translation\r\n\t\t\t\t\t\t\t\toutJacobian[ rowIndex + 0 ][ colIndex ] = tempPos[ 0 ];\r\n\t\t\t\t\t\t\t\toutJacobian[ rowIndex + 1 ][ colIndex ] = tempPos[ 1 ];\r\n\t\t\t\t\t\t\t\toutJacobian[ rowIndex + 2 ][ colIndex ] = tempPos[ 2 ];\r\n\r\n\t\t\t\t\t\t\t\t// set rotation\r\n\t\t\t\t\t\t\t\toutJacobian[ rowIndex + 3 ][ colIndex ] = tempQuat[ 0 ];\r\n\t\t\t\t\t\t\t\toutJacobian[ rowIndex + 4 ][ colIndex ] = tempQuat[ 1 ];\r\n\t\t\t\t\t\t\t\toutJacobian[ rowIndex + 5 ][ colIndex ] = tempQuat[ 2 ];\r\n\t\t\t\t\t\t\t\toutJacobian[ rowIndex + 6 ][ colIndex ] = tempQuat[ 3 ];\r\n\t\t\t\t\t\t\t\trowIndex += 7;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t// if the target isn't relevant then there's no delta\r\n\t\t\t\t\t\t\tlet totalRows = 7;\r\n\t\t\t\t\t\t\tif ( targetJoint.isGoal ) {\r\n\r\n\t\t\t\t\t\t\t\ttotalRows = targetJoint.translationDoFCount;\r\n\t\t\t\t\t\t\t\tif ( targetJoint.rotationDoFCount === 3 ) {\r\n\r\n\t\t\t\t\t\t\t\t\ttotalRows += 4;\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tfor ( let i = 0; i < totalRows; i ++ ) {\r\n\r\n\t\t\t\t\t\t\t\toutJacobian[ rowIndex + i ][ colIndex ] = 0;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\trowIndex += totalRows;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if this joint has a target set and update the jacobian rows if it does\r\n\t\t\t\t\tif ( targetJoint.targetSet ) {\r\n\r\n\t\t\t\t\t\tconst rowCount = targetJoint.translationDoFCount + targetJoint.rotationDoFCount;\r\n\r\n\t\t\t\t\t\tif ( freeJoint === targetJoint ) {\r\n\r\n\t\t\t\t\t\t\t// if we're just dealing with a target dof joint then there can't be any influence\r\n\t\t\t\t\t\t\t// but otherwise the only joint that can have an effect on this error is the joint\r\n\t\t\t\t\t\t\t// itself.\r\n\t\t\t\t\t\t\t// TODO: Having noted that is this really necessary? Is there any way that this doesn't just\r\n\t\t\t\t\t\t\t// jump to the solution and lock? How can we afford some slack? With a low weight? Does that\r\n\t\t\t\t\t\t\t// get applied here?\r\n\t\t\t\t\t\t\t// TODO: If this joint happens to have three euler joints we need to use a quat here. Otherwise we\r\n\t\t\t\t\t\t\t// use the euler angles.\r\n\t\t\t\t\t\t\tfor ( let i = 0; i < rowCount; i ++ ) {\r\n\r\n\t\t\t\t\t\t\t\toutJacobian[ rowIndex + colIndex ][ colIndex ] = - 1;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tfor ( let i = 0; i < rowCount; i ++ ) {\r\n\r\n\t\t\t\t\t\t\t\toutJacobian[ rowIndex + i ][ colIndex ] = 0;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\trowIndex += rowCount;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcolIndex ++;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( colIndex !== outJacobian[ 0 ].length ) {\r\n\r\n\t\t\tthrow new Error();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Fill in the error vector\r\n\tfillErrorVector( targetJoints, errorVector ) {\r\n\r\n\t\tlet rowIndex = 0;\r\n\t\tfor ( let i = 0, l = targetJoints.length; i < l; i ++ ) {\r\n\r\n\t\t\tconst joint = targetJoints[ i ];\r\n\t\t\tif ( joint.isClosure ) {\r\n\r\n\t\t\t\taccumulateClosureError( this, joint, rowIndex, errorVector, errorResultInfo );\r\n\t\t\t\trowIndex += errorResultInfo.rowCount;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( joint.targetSet ) {\r\n\r\n\t\t\t\taccumulateTargetError( this, joint, rowIndex, errorVector, errorResultInfo );\r\n\t\t\t\trowIndex += errorResultInfo.rowCount;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Count the unconverged targets in the chain and store them in targetJoints and store\r\n\t// any freeJoints in\r\n\tcountUnconvergedVariables( freeJoints, targetJoints, dofResultInfo ) {\r\n\r\n\t\tconst { lockedJointDoFCount } = this;\r\n\r\n\t\tconst chain = this.chain;\r\n\t\tlet totalError = 0;\r\n\t\tlet errorRows = 0;\r\n\t\tlet unconvergedRows = 0;\r\n\t\tlet freeDoF = 0;\r\n\t\tfor ( let i = 0, l = chain.length; i < l; i ++ ) {\r\n\r\n\t\t\tlet addToTargetList = false;\r\n\t\t\tconst joint = chain[ i ];\r\n\t\t\tconst lockedDoF = lockedJointDoFCount.get( joint ) || 0;\r\n\r\n\t\t\t// TODO: Should we check every variable against the convergence threshold or is\r\n\t\t\t// it better to check the magnitude?\r\n\r\n\t\t\t// TODO: We may be able to speed this up by using the square distance and length\r\n\t\t\t// to compare error.\r\n\r\n\t\t\t// TODO: If this is a goal we shouldnt add to the free dof because they won't be added\r\n\t\t\t// to the jacobian\r\n\r\n\t\t\t// If this is a closure joint then we need to make sure we're solving\r\n\t\t\t// for the other child end to meet this joint so this error is important.\r\n\t\t\tif ( joint.isClosure ) {\r\n\r\n\t\t\t\taccumulateClosureError( this, joint, errorRows, null, errorResultInfo );\r\n\t\t\t\tif ( ! errorResultInfo.isConverged ) {\r\n\r\n\t\t\t\t\tunconvergedRows += errorResultInfo.rowCount;\r\n\t\t\t\t\ttotalError += errorResultInfo.totalError;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\taddToTargetList = true;\r\n\t\t\t\terrorRows += errorResultInfo.rowCount;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Check out far the joint is from the target dof value.\r\n\t\t\tconst dofList = joint.dof;\r\n\t\t\tif ( joint.targetSet ) {\r\n\r\n\t\t\t\taccumulateTargetError( this, joint, errorRows, null, errorResultInfo );\r\n\t\t\t\tif ( ! errorResultInfo.isConverged ) {\r\n\r\n\t\t\t\t\tunconvergedRows += errorResultInfo.rowCount;\r\n\t\t\t\t\ttotalError += errorResultInfo.totalError;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\taddToTargetList = true;\r\n\t\t\t\terrorRows += errorResultInfo.rowCount;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( ! joint.isGoal && dofList.length > 0 ) {\r\n\r\n\t\t\t\tfreeDoF += dofList.length - lockedDoF;\r\n\t\t\t\tfreeJoints.push( joint );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( addToTargetList ) {\r\n\r\n\t\t\t\ttargetJoints.push( joint );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// if it turns out that everything is converged.\r\n\t\tif ( unconvergedRows === 0 ) {\r\n\r\n\t\t\terrorRows = 0;\r\n\r\n\t\t}\r\n\r\n\t\tdofResultInfo.errorRows = errorRows;\r\n\t\tdofResultInfo.freeDoF = freeDoF;\r\n\t\tdofResultInfo.totalError = totalError;\r\n\r\n\t}\r\n\r\n}\r\n", "export function findRoots( frames ) {\r\n\r\n\tconst potentialRoots = frames.map( f => {\r\n\r\n\t\tlet lastParent = f;\r\n\t\tf.traverseParents( p => {\r\n\r\n\t\t\tlastParent = p;\r\n\r\n\t\t} );\r\n\t\treturn lastParent;\r\n\r\n\t} );\r\n\tconst roots = [];\r\n\tconst set = new Set();\r\n\r\n\tfor ( let i = 0; i < potentialRoots.length; i ++ ) {\r\n\r\n\t\tconst frame = potentialRoots[ i ];\r\n\r\n\t\t// If this frame has already been traversed then we know it's in\r\n\t\t// a root already.\r\n\t\tif ( set.has( frame ) ) {\r\n\r\n\t\t\tcontinue;\r\n\r\n\t\t}\r\n\r\n\t\troots.push( frame );\r\n\t\tframe.traverse( c => {\r\n\r\n\t\t\tif ( set.has( c ) ) {\r\n\r\n\t\t\t\treturn true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tset.add( c );\r\n\r\n\t\t\t// If we come across a joint or link with closures traverse them\r\n\t\t\t// as far as possible to add them to the roots if they haven't been\r\n\t\t\t// added already.\r\n\t\t\tlet closureConnections;\r\n\t\t\tif ( c.isLink ) {\r\n\r\n\t\t\t\tclosureConnections = c.closureJoints;\r\n\r\n\t\t\t} else if ( c.isJoint && c.isClosure ) {\r\n\r\n\t\t\t\tclosureConnections = [ c.child ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( closureConnections ) {\r\n\r\n\t\t\t\tclosureConnections.forEach( cl => {\r\n\r\n\t\t\t\t\tlet lastParent = cl;\r\n\t\t\t\t\tcl.traverseParents( p => {\r\n\r\n\t\t\t\t\t\tlastParent = p;\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t\tif ( ! set.has( lastParent ) ) {\r\n\r\n\t\t\t\t\t\tpotentialRoots.push( lastParent );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\treturn roots;\r\n\r\n}\r\n", "import { mat } from './utils/matrix.js';\r\n\r\nclass FixedMatrixPool {\r\n\r\n\tconstructor( row, col ) {\r\n\r\n\t\tconst matrices = [];\r\n\t\tlet index = 0;\r\n\r\n\t\tthis.get = function () {\r\n\r\n\t\t\tlet matrix = matrices[ index ];\r\n\t\t\tif ( ! matrix ) {\r\n\r\n\t\t\t\tmatrices[ index ] = matrix = mat.create( row, col );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tindex ++;\r\n\t\t\treturn matrix;\r\n\r\n\t\t};\r\n\r\n\t\tthis.releaseAll = function () {\r\n\r\n\t\t\tindex = 0;\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport class MatrixPool {\r\n\r\n\tconstructor() {\r\n\r\n\t\tconst pools = {};\r\n\t\tconst poolArray = [];\r\n\t\tthis.get = function ( row, col ) {\r\n\r\n\t\t\tlet colPools = pools[ row ];\r\n\t\t\tif ( ! colPools ) {\r\n\r\n\t\t\t\tcolPools = pools[ row ] = {};\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlet pool = colPools[ col ];\r\n\t\t\tif ( ! pool ) {\r\n\r\n\t\t\t\tpool = colPools[ col ] = new FixedMatrixPool( row, col );\r\n\t\t\t\tpoolArray.push( pool );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn pool.get();\r\n\r\n\t\t};\r\n\r\n\t\tthis.releaseAll = function () {\r\n\r\n\t\t\tfor ( let i = 0, l = poolArray.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tpoolArray[ i ].releaseAll();\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n}\r\n", "import { ChainSolver } from './ChainSolver.js';\r\nimport { findRoots } from './utils/findRoots.js';\r\nimport { MatrixPool } from './MatrixPool.js';\r\n\r\nexport class Solver {\r\n\r\n\tconstructor( roots = [] ) {\r\n\r\n\t\tthis.matrixPool = new MatrixPool();\r\n\r\n\t\tthis.useSVD = false;\r\n\r\n\t\tthis.maxIterations = 5;\r\n\t\tthis.stallThreshold = 1e-4;\r\n\t\tthis.dampingFactor = 0.001;\r\n\t\tthis.divergeThreshold = 0.01;\r\n\t\tthis.restPoseFactor = 0.01;\r\n\r\n\t\tthis.translationConvergeThreshold = 1e-3;\r\n\t\tthis.rotationConvergeThreshold = 1e-5;\r\n\r\n\t\tthis.translationFactor = 1;\r\n\t\tthis.rotationFactor = 1;\r\n\r\n\t\tthis.translationStep = 1e-3;\r\n\t\tthis.rotationStep = 1e-3;\r\n\r\n\t\tthis.translationErrorClamp = 0.1;\r\n\t\tthis.rotationErrorClamp = 0.1;\r\n\r\n\t\tthis.roots = Array.isArray( roots ) ? [ ...roots ] : [ roots ];\r\n\t\tthis.solvers = null;\r\n\r\n\t\tthis.updateStructure();\r\n\r\n\t}\r\n\r\n\t// needs to be called whenever tree structure is updated\r\n\tupdateStructure() {\r\n\r\n\t\tconst roots = findRoots( this.roots );\r\n\t\tconst chains = [];\r\n\t\tconst traversal = new Set();\r\n\t\tconst allChainJoints = new Set();\r\n\t\tconst traverseChains = frame => {\r\n\r\n\t\t\t// If we found a joint then add it to the traversal list\r\n\t\t\tif ( frame.isJoint ) {\r\n\r\n\t\t\t\tconst joint = frame;\r\n\t\t\t\ttraversal.add( joint );\r\n\r\n\t\t\t\t// If we found a closure joint\r\n\t\t\t\tif ( joint.isClosure ) {\r\n\r\n\t\t\t\t\t// Traverse back up the tree until we find a common ancestor\r\n\t\t\t\t\t// and create a new chain\r\n\t\t\t\t\tconst chainSet = new Set();\r\n\t\t\t\t\tlet curr = joint.child;\r\n\t\t\t\t\twhile ( curr ) {\r\n\r\n\t\t\t\t\t\tif ( curr.isJoint ) {\r\n\r\n\t\t\t\t\t\t\tif ( traversal.has( curr ) ) {\r\n\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t\tchainSet.add( curr );\r\n\t\t\t\t\t\t\t\tallChainJoints.add( curr );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tcurr = curr.parent;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttraversal.forEach( c => {\r\n\r\n\t\t\t\t\t\tchainSet.add( c );\r\n\t\t\t\t\t\tallChainJoints.add( c );\r\n\r\n\t\t\t\t\t} );\r\n\t\t\t\t\tchains.push( chainSet );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Continue traversing\r\n\t\t\tconst children = frame.children;\r\n\t\t\tfor ( let i = 0, l = children.length; i < l; i ++ ) {\r\n\r\n\t\t\t\ttraverseChains( children[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Remove the joint from our traversal set\r\n\t\t\ttraversal.delete( frame );\r\n\r\n\t\t};\r\n\r\n\t\t// find all chains in the roots\r\n\t\troots.forEach( traverseChains );\r\n\r\n\t\t// Merge interdependent chains\r\n\t\tconst independentChains = [];\r\n\t\twhile ( chains.length ) {\r\n\r\n\t\t\tconst currChain = chains.pop();\r\n\t\t\tindependentChains.push( currChain );\r\n\t\t\tfor ( let i = 0; i < chains.length; i ++ ) {\r\n\r\n\t\t\t\t// see if this chain is dependent on the current chain\r\n\t\t\t\t// and if so merge the chains.\r\n\t\t\t\tconst otherChain = chains[ i ];\r\n\r\n\t\t\t\tlet dependent = false;\r\n\t\t\t\totherChain.forEach( c => {\r\n\r\n\t\t\t\t\tdependent = dependent || currChain.has( c );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t\tif ( dependent ) {\r\n\r\n\t\t\t\t\totherChain.forEach( c => currChain.add( c ) );\r\n\t\t\t\t\tchains.splice( i, 1 );\r\n\t\t\t\t\ti --;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// Find any joints that aren't considered part of a solve chain so we\r\n\t\t// can just update them using forward kinematics.\r\n\t\tconst nonChainJoints = new Set();\r\n\t\troots.forEach( root => root.traverse( c => {\r\n\r\n\t\t\tif ( c.isJoint && c.dof.length > 0 && ! allChainJoints.has( c ) ) {\r\n\r\n\t\t\t\tnonChainJoints.add( c );\r\n\r\n\t\t\t}\r\n\r\n\t\t} ) );\r\n\r\n\t\t// Create the solvers for the chains\r\n\t\tthis.solvers = independentChains.map( c => new ChainSolver( c ) );\r\n\t\tthis.nonChainJoints = nonChainJoints;\r\n\r\n\t}\r\n\r\n\tsolve() {\r\n\r\n\t\tconst { solvers, nonChainJoints } = this;\r\n\r\n\t\t// update any non chain joints\r\n\t\tnonChainJoints.forEach( joint => {\r\n\r\n\t\t\tif ( joint.targetSet ) {\r\n\r\n\t\t\t\tjoint.dofValues.set( joint.dofTarget );\r\n\t\t\t\tjoint.setMatrixDoFNeedsUpdate();\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tconst results = [];\r\n\t\tfor ( let i = 0, l = solvers.length; i < l; i ++ ) {\r\n\r\n\t\t\tconst s = solvers[ i ];\r\n\t\t\ts.matrixPool = this.matrixPool;\r\n\r\n\t\t\ts.useSVD = this.useSVD;\r\n\r\n\t\t\ts.maxIterations = this.maxIterations;\r\n\t\t\ts.stallThreshold = this.stallThreshold;\r\n\t\t\ts.dampingFactor = this.dampingFactor;\r\n\t\t\ts.divergeThreshold = this.divergeThreshold;\r\n\t\t\ts.restPoseFactor = this.restPoseFactor;\r\n\r\n\t\t\ts.translationConvergeThreshold = this.translationConvergeThreshold;\r\n\t\t\ts.rotationConvergeThreshold = this.rotationConvergeThreshold;\r\n\r\n\t\t\ts.translationFactor = this.translationFactor;\r\n\t\t\ts.rotationFactor = this.rotationFactor;\r\n\r\n\t\t\ts.translationStep = this.translationStep;\r\n\t\t\ts.rotationStep = this.rotationStep;\r\n\r\n\t\t\ts.translationErrorClamp = this.translationErrorClamp;\r\n\t\t\ts.rotationErrorClamp = this.rotationErrorClamp;\r\n\r\n\t\t\tconst result = s.solve();\r\n\t\t\tresults.push( result );\r\n\r\n\t\t}\r\n\r\n\t\treturn results;\r\n\r\n\t}\r\n\r\n}\r\n", "import { Joint } from '../core/Joint.js';\r\nimport { Link } from '../core/Link.js';\r\nimport { Goal } from '../core/Goal.js';\r\n\r\n// Takes a list of interconnected frames and serializes them into a non cyclic json representation\r\nexport function serialize( frames ) {\r\n\r\n\tconst map = new Map();\r\n\tconst info = [];\r\n\r\n\t// Create the initial frame list along with a joint -> index map\r\n\tfor ( let i = 0, l = frames.length; i < l; i ++ ) {\r\n\r\n\t\tconst frame = frames[ i ];\r\n\r\n\t\tconst {\r\n\t\t\tname,\r\n\t\t\tdof,\r\n\t\t\tdofValues,\r\n\t\t\tdofTarget,\r\n\t\t\tdofRestPose,\r\n\t\t\tminDoFLimit,\r\n\t\t\tmaxDoFLimit,\r\n\t\t\ttargetSet,\r\n\t\t\trestPoseSet,\r\n\t\t\tposition,\r\n\t\t\tquaternion,\r\n\t\t\tisClosure,\r\n\t\t} = frame;\r\n\r\n\t\tlet type = 'Link';\r\n\t\tif ( frame.isGoal ) {\r\n\r\n\t\t\ttype = 'Goal';\r\n\r\n\t\t} else if ( frame.isJoint ) {\r\n\r\n\t\t\ttype = 'Joint';\r\n\r\n\t\t}\r\n\r\n\t\tconst res = {\r\n\t\t\tdof: dof ? dof.slice() : null,\r\n\t\t\tdofValues: dofValues ? dofValues.slice() : null,\r\n\t\t\tdofTarget: dofTarget ? dofTarget.slice() : null,\r\n\t\t\tdofRestPose: dofRestPose ? dofRestPose.slice() : null,\r\n\t\t\tminDoFLimit: minDoFLimit ? minDoFLimit.slice() : null,\r\n\t\t\tmaxDoFLimit: maxDoFLimit ? maxDoFLimit.slice() : null,\r\n\t\t\ttargetSet,\r\n\t\t\trestPoseSet,\r\n\t\t\tisClosure,\r\n\r\n\t\t\tname,\r\n\t\t\tposition: position.slice(),\r\n\t\t\tquaternion: quaternion.slice(),\r\n\t\t\tchildren: null,\r\n\t\t\tclosureJoints: null,\r\n\t\t\tchild: null,\r\n\t\t\ttype,\r\n\t\t};\r\n\r\n\t\tinfo.push( res );\r\n\t\tmap.set( frame, i );\r\n\r\n\t}\r\n\r\n\t// Create the child and parent index references.\r\n\tfor ( let i = 0, l = frames.length; i < l; i ++ ) {\r\n\r\n\t\tconst inf = info[ i ];\r\n\t\tconst frame = frames[ i ];\r\n\t\tinf.children = frame.children.map( c => map.get( c ) );\r\n\t\tif ( frame.isLink ) {\r\n\r\n\t\t\tinf.closureJoints = frame.closureJoints.map( c => map.get( c ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( frame.isJoint && frame.child ) {\r\n\r\n\t\t\tinf.child = map.get( frame.child );\r\n\r\n\t\t}\r\n\r\n\t\tif ( frame.parent ) {\r\n\r\n\t\t\tinf.parent = map.get( frame.parent );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tinf.parent = null;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn info;\r\n\r\n}\r\n\r\n// Deserialize the serialized representation of the graph\r\nexport function deserialize( data ) {\r\n\r\n\t// Create joints / links for every serialized version\r\n\tconst frames =\r\n\t\tdata.map( d => {\r\n\r\n\t\t\tconst {\r\n\t\t\t\ttype,\r\n\t\t\t\tname,\r\n\t\t\t\tposition,\r\n\t\t\t\tquaternion,\r\n\r\n\t\t\t\tdof,\r\n\t\t\t\tdofValues,\r\n\t\t\t\tdofTarget,\r\n\t\t\t\tdofRestPose,\r\n\t\t\t\tminDoFLimit,\r\n\t\t\t\tmaxDoFLimit,\r\n\t\t\t\ttargetSet,\r\n\t\t\t\trestPoseSet,\r\n\t\t\t\tisClosure,\r\n\t\t\t} = d;\r\n\r\n\t\t\tlet frame;\r\n\t\t\tswitch ( type ) {\r\n\r\n\t\t\t\tcase 'Goal':\r\n\t\t\t\tcase 'Joint':\r\n\t\t\t\t\tframe = type === 'Goal' ? new Goal() : new Joint();\r\n\r\n\t\t\t\t\tframe.setDoF( ...dof );\r\n\t\t\t\t\tframe.dofValues.set( dofValues );\r\n\t\t\t\t\tframe.dofTarget.set( dofTarget );\r\n\t\t\t\t\tframe.dofRestPose.set( dofRestPose );\r\n\t\t\t\t\tframe.minDoFLimit.set( minDoFLimit );\r\n\t\t\t\t\tframe.maxDoFLimit.set( maxDoFLimit );\r\n\r\n\t\t\t\t\tframe.targetSet = targetSet;\r\n\t\t\t\t\tframe.restPoseSet = restPoseSet;\r\n\t\t\t\t\tframe.isClosure = isClosure;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Link':\r\n\t\t\t\t\tframe = new Link();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tframe.name = name;\r\n\t\t\tframe.position.set( position );\r\n\t\t\tframe.quaternion.set( quaternion );\r\n\t\t\treturn frame;\r\n\r\n\t\t} );\r\n\r\n\t// set the parent and child from the maps\r\n\tfor ( let i = 0; i < frames.length; i ++ ) {\r\n\r\n\t\tconst frame = frames[ i ];\r\n\t\tconst info = data[ i ];\r\n\r\n\t\tframe.parent = frames[ info.parent ] || null;\r\n\t\tframe.children.push( ...info.children.map( i => frames[ i ] ) );\r\n\t\tframe.setMatrixNeedsUpdate();\r\n\r\n\t\tif ( frame.isLink ) {\r\n\r\n\t\t\tframe.closureJoints.push( ...info.closureJoints.map( i => frames[ i ] ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( frame.isJoint ) {\r\n\r\n\t\t\tframe.child = info.child !== null ? frames[ info.child ] : null;\r\n\t\t\tframe.setMatrixDoFNeedsUpdate();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn frames;\r\n\r\n}\r\n", "export const JOINT_STRIDE = 304;\r\n\r\nexport const LINK_STRIDE = 56;\r\n\r\nexport function generateSharedBuffer( frames, useSharedArrayBuffer = true ) {\r\n\r\n\t// dofValues \t6 * 4\r\n\t// dofTarget \t6 * 4\r\n\t// dofRestPose \t6 * 4\r\n\t// minDoFLimit \t6 * 4\r\n\t// maxDoFLimit \t6 * 4\r\n\t// position \t3 * 4\r\n\t// quaternion \t4 * 4\r\n\t// targetSet \t1\r\n\t// restPoseSet \t1\r\n\t// --\r\n\t// total  \t\t150 bytes per joint\r\n\t// 4 byte aligned: 152\r\n\r\n\tlet arrayBuffer;\r\n\tif ( useSharedArrayBuffer ) {\r\n\r\n\t\tarrayBuffer = new SharedArrayBuffer( JOINT_STRIDE * frames.length );\r\n\r\n\t} else {\r\n\r\n\t\tarrayBuffer = new ArrayBuffer( JOINT_STRIDE * frames.length );\r\n\r\n\t}\r\n\r\n\tconst float64 = new Float32Array( arrayBuffer );\r\n\tconst byte8 = new Uint8Array( arrayBuffer );\r\n\tapplyToBuffer( frames, float64, byte8 );\r\n\treturn arrayBuffer;\r\n\r\n}\r\n\r\nexport function applyToBuffer( frames, floatBuffer, byteBuffer, copyDoFValues = true, copyJointSettings = true ) {\r\n\r\n\tfor ( let i = 0, l = frames.length; i < l; i ++ ) {\r\n\r\n\t\tcopyFrameToBuffer( frames[ i ], floatBuffer, byteBuffer, i * JOINT_STRIDE, copyDoFValues, copyJointSettings );\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport function applyFromBuffer( frames, floatBuffer, byteBuffer, copyDoFValues = true, copyJointSettings = true ) {\r\n\r\n\tfor ( let i = 0, l = frames.length; i < l; i ++ ) {\r\n\r\n\t\tcopyBufferToFrame( frames[ i ], floatBuffer, byteBuffer, JOINT_STRIDE * i, copyDoFValues, copyJointSettings );\r\n\r\n\t}\r\n\r\n}\r\n\r\n// Copy data from the frame to the given buffer starting at the given byte offset. Joints take JOINT_STRIDE\r\n// bytes while links take LINK_STRIDE bytes.\r\nexport function copyFrameToBuffer(\r\n\tframe,\r\n\tfloatBuffer,\r\n\tbyteBuffer,\r\n\tbyteOffset,\r\n\tcopyDoFValues = true,\r\n\tcopyJointSettings = true,\r\n) {\r\n\r\n\tconst floatOffset = byteOffset / 4;\r\n\tif ( copyJointSettings ) {\r\n\r\n\t\tconst {\r\n\t\t\tposition,\r\n\t\t\tquaternion,\r\n\t\t} = frame;\r\n\t\tfor ( let i = 0; i < 3; i ++ ) {\r\n\r\n\t\t\tfloatBuffer[ floatOffset + 0 + i ] = position[ i ];\r\n\r\n\t\t}\r\n\r\n\t\tfor ( let i = 0; i < 4; i ++ ) {\r\n\r\n\t\t\tfloatBuffer[ floatOffset + 3 + i ] = quaternion[ i ];\r\n\r\n\t\t}\r\n\r\n\t\tif ( frame.isJoint ) {\r\n\r\n\t\t\tconst {\r\n\t\t\t\tdofTarget,\r\n\t\t\t\tdofRestPose,\r\n\t\t\t\tminDoFLimit,\r\n\t\t\t\tmaxDoFLimit,\r\n\t\t\t\ttargetSet,\r\n\t\t\t\trestPoseSet,\r\n\t\t\t} = frame;\r\n\r\n\t\t\tfor ( let i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\t\tfloatBuffer[ floatOffset + 7 + 0 * 6 + i ] = dofTarget[ i ];\r\n\t\t\t\tfloatBuffer[ floatOffset + 7 + 1 * 6 + i ] = dofRestPose[ i ];\r\n\t\t\t\tfloatBuffer[ floatOffset + 7 + 2 * 6 + i ] = minDoFLimit[ i ];\r\n\t\t\t\tfloatBuffer[ floatOffset + 7 + 3 * 6 + i ] = maxDoFLimit[ i ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tbyteBuffer[ byteOffset + 148 ] = Number( targetSet );\r\n\t\t\tbyteBuffer[ byteOffset + 149 ] = Number( restPoseSet );\r\n\r\n\t\t}\r\n\r\n\r\n\t}\r\n\r\n\tif ( copyDoFValues && frame.isJoint ) {\r\n\r\n\t\tconst { dofValues } = frame;\r\n\r\n\t\tfor ( let i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\tfloatBuffer[ floatOffset + 7 + 4 * 6 + i ] = dofValues[ i ];\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\n// Copy data from the given buffer to the given frame starting at the given byte offset.\r\nexport function copyBufferToFrame(\r\n\tjoint,\r\n\tfloatBuffer,\r\n\tbyteBuffer,\r\n\tbyteOffset,\r\n\tcopyDoFValues = true,\r\n\tcopyJointSettings = true,\r\n) {\r\n\r\n\tconst floatOffset = byteOffset / 4;\r\n\r\n\tif ( copyJointSettings ) {\r\n\r\n\t\tjoint.setPosition(\r\n\t\t\tfloatBuffer[ floatOffset + 0 ],\r\n\t\t\tfloatBuffer[ floatOffset + 1 ],\r\n\t\t\tfloatBuffer[ floatOffset + 2 ],\r\n\t\t);\r\n\t\tjoint.setQuaternion(\r\n\t\t\tfloatBuffer[ floatOffset + 3 + 0 ],\r\n\t\t\tfloatBuffer[ floatOffset + 3 + 1 ],\r\n\t\t\tfloatBuffer[ floatOffset + 3 + 2 ],\r\n\t\t\tfloatBuffer[ floatOffset + 3 + 3 ],\r\n\t\t);\r\n\r\n\t\tif ( joint.isJoint ) {\r\n\r\n\t\t\tconst {\r\n\t\t\t\tdofTarget,\r\n\t\t\t\tdofRestPose,\r\n\t\t\t\tminDoFLimit,\r\n\t\t\t\tmaxDoFLimit,\r\n\t\t\t} = joint;\r\n\r\n\t\t\tfor ( let i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\t\tdofTarget[ i ] = floatBuffer[ floatOffset + 7 + 0 * 6 + i ];\r\n\t\t\t\tdofRestPose[ i ] = floatBuffer[ floatOffset + 7 + 1 * 6 + i ];\r\n\t\t\t\tminDoFLimit[ i ] = floatBuffer[ floatOffset + 7 + 2 * 6 + i ];\r\n\t\t\t\tmaxDoFLimit[ i ] = floatBuffer[ floatOffset + 7 + 3 * 6 + i ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tjoint.targetSet = Boolean( byteBuffer[ byteOffset + 148 ] );\r\n\t\t\tjoint.restPoseSet = Boolean( byteBuffer[ byteOffset + 149 ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tif ( copyDoFValues && joint.isJoint ) {\r\n\r\n\t\tconst { dofValues } = joint;\r\n\t\tlet changed = false;\r\n\t\tfor ( let i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\tconst v = floatBuffer[ floatOffset + 7 + 4 * 6 + i ];\r\n\t\t\tif ( v !== dofValues[ i ] ) {\r\n\r\n\t\t\t\tdofValues[ i ] = v;\r\n\t\t\t\tchanged = true;\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t}\r\n\r\n\t\t// only update dof matrix if it changed\r\n\t\tif ( changed ) {\r\n\r\n\t\t\tjoint.setMatrixDoFNeedsUpdate();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n", "import { SOLVE_STATUS } from '../core/ChainSolver.js';\r\nimport { serialize } from './serialize.js';\r\nimport {\r\n\tgenerateSharedBuffer,\r\n\tapplyToBuffer,\r\n\tcopyFrameToBuffer,\r\n\tcopyBufferToFrame,\r\n\tJOINT_STRIDE,\r\n} from './utils.js';\r\nimport { findRoots } from '../core/utils/findRoots.js';\r\n\r\nconst useSharedArrayBuffers = ( typeof SharedArrayBuffer ) !== 'undefined';\r\n\r\nexport class WorkerSolver {\r\n\r\n\tconstructor( roots = [] ) {\r\n\r\n\t\tthis.roots = Array.isArray( roots ) ? [ ...roots ] : [ roots ];\r\n\t\tthis.status = [];\r\n\t\tthis.running = false;\r\n\r\n\t\tthis.frames = null;\r\n\t\tthis.buffer = null;\r\n\t\tthis.floatBuffer = null;\r\n\t\tthis.byteBuffer = null;\r\n\t\tthis.jointsToUpdate = null;\r\n\t\tthis.jointsToIndexMap = null;\r\n\t\tthis.scheduledStateUpdate = false;\r\n\r\n\t\tconst worker = new Worker( new URL( './workerSolver.worker.js', import.meta.url ), { type: 'module' } );\r\n\t\tlet scheduled = false;\r\n\t\tworker.onmessage = ( { data: e } ) => {\r\n\r\n\t\t\tif ( e.type === 'updateSolve' ) {\r\n\r\n\t\t\t\t// If the solve is completed then schedule a copy onto our joints to avoid\r\n\t\t\t\t// copying multiple times per frame.\r\n\t\t\t\tif ( ! scheduled ) {\r\n\r\n\t\t\t\t\tscheduled = true;\r\n\t\t\t\t\tPromise.resolve().then( () => {\r\n\r\n\t\t\t\t\t\t// Only copy the DoF values of the joints that are to move.\r\n\t\t\t\t\t\tlet byteBuffer, floatBuffer;\r\n\t\t\t\t\t\tif ( useSharedArrayBuffers ) {\r\n\r\n\t\t\t\t\t\t\tbyteBuffer = this.byteBuffer;\r\n\t\t\t\t\t\t\tfloatBuffer = this.floatBuffer;\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tbyteBuffer = new Uint8Array( e.data.buffer );\r\n\t\t\t\t\t\t\tfloatBuffer = new Float32Array( e.data.buffer );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tconst { jointsToIndexMap, jointsToUpdate } = this;\r\n\t\t\t\t\t\tfor ( let i = 0, l = jointsToUpdate.length; i < l; i ++ ) {\r\n\r\n\t\t\t\t\t\t\tconst joint = jointsToUpdate[ i ];\r\n\t\t\t\t\t\t\tconst index = jointsToIndexMap.get( joint );\r\n\r\n\t\t\t\t\t\t\tcopyBufferToFrame( joint, floatBuffer, byteBuffer, index * JOINT_STRIDE, true, false );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tscheduled = false;\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst status = e.data.status;\r\n\t\t\t\tthis.status = status;\r\n\t\t\t\tif ( status !== SOLVE_STATUS.TIMEOUT ) {\r\n\r\n\t\t\t\t\tthis.running = false;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\tthis.worker = worker;\r\n\t\tthis.updateStructure();\r\n\r\n\t}\r\n\r\n\t// Update the structure of the graph in the worker. Must be called every time the graph structure\r\n\t// changes or a degree of freedom changes. Or if the main thread must change the DoF values.\r\n\tupdateStructure() {\r\n\r\n\t\t// TODO: do we need to track versions of the structure now if we use\r\n\t\t// normal array buffers so we don't respond to an outdated update event?\r\n\r\n\t\tconst { worker } = this;\r\n\r\n\t\tconst roots = findRoots( this.roots );\r\n\r\n\t\t// Get all frames in the graph\r\n\t\tconst framesSet = new Set();\r\n\t\troots.forEach( root => root.traverse( c => {\r\n\r\n\t\t\tframesSet.add( c );\r\n\r\n\t\t} ) );\r\n\r\n\t\t// Seralize the frames and generate a buffer\r\n\t\tconst frames = Array.from( framesSet );\r\n\t\tconst serialized = serialize( frames );\r\n\r\n\t\tconst buffer = generateSharedBuffer( frames, useSharedArrayBuffers );\r\n\t\tconst floatBuffer = new Float32Array( buffer );\r\n\t\tconst byteBuffer = new Uint8Array( buffer );\r\n\r\n\t\t// Filter all the frames down to joints that should be updated from\r\n\t\t// the worker.\r\n\t\tconst jointsToUpdate = [];\r\n\t\tconst jointsToIndexMap = new Map();\r\n\t\tfor ( let i = 0, l = frames.length; i < l; i ++ ) {\r\n\r\n\t\t\tconst frame = frames[ i ];\r\n\t\t\tif ( frame.isJoint && frame.dof.length > 0 ) {\r\n\r\n\t\t\t\tjointsToUpdate.push( frame );\r\n\t\t\t\tjointsToIndexMap.set( frame, i );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( useSharedArrayBuffers ) {\r\n\r\n\t\t\tthis.buffer = buffer;\r\n\t\t\tthis.floatBuffer = floatBuffer;\r\n\t\t\tthis.byteBuffer = byteBuffer;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.buffer = buffer.slice();\r\n\t\t\tthis.floatBuffer = new Float32Array( this.buffer );\r\n\t\t\tthis.byteBuffer = new Uint8Array( this.buffer );\r\n\r\n\t\t}\r\n\r\n\t\tthis.frames = frames;\r\n\t\tthis.jointsToUpdate = jointsToUpdate;\r\n\t\tthis.jointsToIndexMap = jointsToIndexMap;\r\n\r\n\t\tif ( useSharedArrayBuffers ) {\r\n\r\n\t\t\tworker.postMessage( {\r\n\t\t\t\ttype: 'updateStructure',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tserialized,\r\n\t\t\t\t\tbuffer,\r\n\t\t\t\t},\r\n\t\t\t} );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tworker.postMessage( {\r\n\t\t\t\ttype: 'updateStructure',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tserialized,\r\n\t\t\t\t\tbuffer,\r\n\t\t\t\t},\r\n\t\t\t}, [ buffer ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Update the solver settings via a settings object.\r\n\tupdateSolverSettings( settings ) {\r\n\r\n\t\tthis.worker.postMessage( {\r\n\t\t\ttype: 'updateSolverSettings',\r\n\t\t\tdata: settings,\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t// Copy the non DoF values over to shared buffer for use in the worker\r\n\tupdateFrameState( ...updateJoints ) {\r\n\r\n\t\tconst { frames, floatBuffer, byteBuffer } = this;\r\n\t\tif ( updateJoints.length === 0 ) {\r\n\r\n\t\t\tapplyToBuffer( frames, floatBuffer, byteBuffer, false, true );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tfor ( let i = 0, l = updateJoints.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tconst frame = updateJoints[ i ];\r\n\t\t\t\tconst index = frames.indexOf( frame );\r\n\r\n\t\t\t\tcopyFrameToBuffer( frame, floatBuffer, byteBuffer, JOINT_STRIDE * index, false, true );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( ! useSharedArrayBuffers && ! this.scheduledStateUpdate ) {\r\n\r\n\t\t\tthis.scheduledStateUpdate = true;\r\n\t\t\tPromise.resolve().then( () => {\r\n\r\n\t\t\t\tthis.scheduledStateUpdate = false;\r\n\t\t\t\tconst buffer = this.buffer.slice();\r\n\t\t\t\tthis.worker.postMessage( {\r\n\t\t\t\t\ttype: 'updateFrameState',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tbuffer,\r\n\t\t\t\t\t},\r\n\t\t\t\t}, [ buffer ] );\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Start the solve loop if it's not running\r\n\tsolve() {\r\n\r\n\t\tthis.worker.postMessage( {\r\n\t\t\ttype: 'startSolve',\r\n\t\t} );\r\n\t\tthis.running = true;\r\n\r\n\t}\r\n\r\n\t// Stop the solve loop\r\n\tstop() {\r\n\r\n\t\tthis.worker.postMessage( {\r\n\t\t\ttype: 'stopSolve',\r\n\t\t} );\r\n\t\tthis.running = false;\r\n\r\n\t}\r\n\r\n\t// Stop and dispose the worker\r\n\tdispose() {\r\n\r\n\t\tthis.stop();\r\n\t\tthis.worker.terminate();\r\n\t\tthis.worker = null;\r\n\r\n\t}\r\n\r\n}\r\n", "import {\n\tBox3,\n\tFloat32BufferAttribute,\n\tInstancedBufferGeometry,\n\tInstancedInterleavedBuffer,\n\tInterleavedBufferAttribute,\n\tSphere,\n\tVector3,\n\tWireframeGeometry\n} from 'three';\n\nconst _box = new Box3();\nconst _vector = new Vector3();\n\nclass LineSegmentsGeometry extends InstancedBufferGeometry {\n\n\tconstructor() {\n\n\t\tsuper();\n\n\t\tthis.isLineSegmentsGeometry = true;\n\n\t\tthis.type = 'LineSegmentsGeometry';\n\n\t\tconst positions = [ - 1, 2, 0, 1, 2, 0, - 1, 1, 0, 1, 1, 0, - 1, 0, 0, 1, 0, 0, - 1, - 1, 0, 1, - 1, 0 ];\n\t\tconst uvs = [ - 1, 2, 1, 2, - 1, 1, 1, 1, - 1, - 1, 1, - 1, - 1, - 2, 1, - 2 ];\n\t\tconst index = [ 0, 2, 1, 2, 3, 1, 2, 4, 3, 4, 5, 3, 4, 6, 5, 6, 7, 5 ];\n\n\t\tthis.setIndex( index );\n\t\tthis.setAttribute( 'position', new Float32BufferAttribute( positions, 3 ) );\n\t\tthis.setAttribute( 'uv', new Float32BufferAttribute( uvs, 2 ) );\n\n\t}\n\n\tapplyMatrix4( matrix ) {\n\n\t\tconst start = this.attributes.instanceStart;\n\t\tconst end = this.attributes.instanceEnd;\n\n\t\tif ( start !== undefined ) {\n\n\t\t\tstart.applyMatrix4( matrix );\n\n\t\t\tend.applyMatrix4( matrix );\n\n\t\t\tstart.needsUpdate = true;\n\n\t\t}\n\n\t\tif ( this.boundingBox !== null ) {\n\n\t\t\tthis.computeBoundingBox();\n\n\t\t}\n\n\t\tif ( this.boundingSphere !== null ) {\n\n\t\t\tthis.computeBoundingSphere();\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\tsetPositions( array ) {\n\n\t\tlet lineSegments;\n\n\t\tif ( array instanceof Float32Array ) {\n\n\t\t\tlineSegments = array;\n\n\t\t} else if ( Array.isArray( array ) ) {\n\n\t\t\tlineSegments = new Float32Array( array );\n\n\t\t}\n\n\t\tconst instanceBuffer = new InstancedInterleavedBuffer( lineSegments, 6, 1 ); // xyz, xyz\n\n\t\tthis.setAttribute( 'instanceStart', new InterleavedBufferAttribute( instanceBuffer, 3, 0 ) ); // xyz\n\t\tthis.setAttribute( 'instanceEnd', new InterleavedBufferAttribute( instanceBuffer, 3, 3 ) ); // xyz\n\n\t\t//\n\n\t\tthis.computeBoundingBox();\n\t\tthis.computeBoundingSphere();\n\n\t\treturn this;\n\n\t}\n\n\tsetColors( array ) {\n\n\t\tlet colors;\n\n\t\tif ( array instanceof Float32Array ) {\n\n\t\t\tcolors = array;\n\n\t\t} else if ( Array.isArray( array ) ) {\n\n\t\t\tcolors = new Float32Array( array );\n\n\t\t}\n\n\t\tconst instanceColorBuffer = new InstancedInterleavedBuffer( colors, 6, 1 ); // rgb, rgb\n\n\t\tthis.setAttribute( 'instanceColorStart', new InterleavedBufferAttribute( instanceColorBuffer, 3, 0 ) ); // rgb\n\t\tthis.setAttribute( 'instanceColorEnd', new InterleavedBufferAttribute( instanceColorBuffer, 3, 3 ) ); // rgb\n\n\t\treturn this;\n\n\t}\n\n\tfromWireframeGeometry( geometry ) {\n\n\t\tthis.setPositions( geometry.attributes.position.array );\n\n\t\treturn this;\n\n\t}\n\n\tfromEdgesGeometry( geometry ) {\n\n\t\tthis.setPositions( geometry.attributes.position.array );\n\n\t\treturn this;\n\n\t}\n\n\tfromMesh( mesh ) {\n\n\t\tthis.fromWireframeGeometry( new WireframeGeometry( mesh.geometry ) );\n\n\t\t// set colors, maybe\n\n\t\treturn this;\n\n\t}\n\n\tfromLineSegments( lineSegments ) {\n\n\t\tconst geometry = lineSegments.geometry;\n\n\t\tthis.setPositions( geometry.attributes.position.array ); // assumes non-indexed\n\n\t\t// set colors, maybe\n\n\t\treturn this;\n\n\t}\n\n\tcomputeBoundingBox() {\n\n\t\tif ( this.boundingBox === null ) {\n\n\t\t\tthis.boundingBox = new Box3();\n\n\t\t}\n\n\t\tconst start = this.attributes.instanceStart;\n\t\tconst end = this.attributes.instanceEnd;\n\n\t\tif ( start !== undefined && end !== undefined ) {\n\n\t\t\tthis.boundingBox.setFromBufferAttribute( start );\n\n\t\t\t_box.setFromBufferAttribute( end );\n\n\t\t\tthis.boundingBox.union( _box );\n\n\t\t}\n\n\t}\n\n\tcomputeBoundingSphere() {\n\n\t\tif ( this.boundingSphere === null ) {\n\n\t\t\tthis.boundingSphere = new Sphere();\n\n\t\t}\n\n\t\tif ( this.boundingBox === null ) {\n\n\t\t\tthis.computeBoundingBox();\n\n\t\t}\n\n\t\tconst start = this.attributes.instanceStart;\n\t\tconst end = this.attributes.instanceEnd;\n\n\t\tif ( start !== undefined && end !== undefined ) {\n\n\t\t\tconst center = this.boundingSphere.center;\n\n\t\t\tthis.boundingBox.getCenter( center );\n\n\t\t\tlet maxRadiusSq = 0;\n\n\t\t\tfor ( let i = 0, il = start.count; i < il; i ++ ) {\n\n\t\t\t\t_vector.fromBufferAttribute( start, i );\n\t\t\t\tmaxRadiusSq = Math.max( maxRadiusSq, center.distanceToSquared( _vector ) );\n\n\t\t\t\t_vector.fromBufferAttribute( end, i );\n\t\t\t\tmaxRadiusSq = Math.max( maxRadiusSq, center.distanceToSquared( _vector ) );\n\n\t\t\t}\n\n\t\t\tthis.boundingSphere.radius = Math.sqrt( maxRadiusSq );\n\n\t\t\tif ( isNaN( this.boundingSphere.radius ) ) {\n\n\t\t\t\tconsole.error( 'THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.', this );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\ttoJSON() {\n\n\t\t// todo\n\n\t}\n\n\tapplyMatrix( matrix ) {\n\n\t\tconsole.warn( 'THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4().' );\n\n\t\treturn this.applyMatrix4( matrix );\n\n\t}\n\n}\n\nexport { LineSegmentsGeometry };\n", "/**\n * parameters = {\n *  color: <hex>,\n *  linewidth: <float>,\n *  dashed: <boolean>,\n *  dashScale: <float>,\n *  dashSize: <float>,\n *  dashOffset: <float>,\n *  gapSize: <float>,\n *  resolution: <Vector2>, // to be set by renderer\n * }\n */\n\nimport {\n\tShaderLib,\n\tShaderMaterial,\n\tUniformsLib,\n\tUniformsUtils,\n\tVector2\n} from 'three';\n\n\nUniformsLib.line = {\n\n\tworldUnits: { value: 1 },\n\tlinewidth: { value: 1 },\n\tresolution: { value: new Vector2( 1, 1 ) },\n\tdashOffset: { value: 0 },\n\tdashScale: { value: 1 },\n\tdashSize: { value: 1 },\n\tgapSize: { value: 1 } // todo FIX - maybe change to totalSize\n\n};\n\nShaderLib[ 'line' ] = {\n\n\tuniforms: UniformsUtils.merge( [\n\t\tUniformsLib.common,\n\t\tUniformsLib.fog,\n\t\tUniformsLib.line\n\t] ),\n\n\tvertexShader:\n\t/* glsl */`\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\t#ifdef WORLD_UNITS\n\n\t\t\tvarying vec4 worldPos;\n\t\t\tvarying vec3 worldStart;\n\t\t\tvarying vec3 worldEnd;\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t#endif\n\n\t\t#else\n\n\t\t\tvarying vec2 vUv;\n\n\t\t#endif\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\t\t\t\tvUv = uv;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\tworldStart = start.xyz;\n\t\t\t\tworldEnd = end.xyz;\n\n\t\t\t#else\n\n\t\t\t\tvUv = uv;\n\n\t\t\t#endif\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec3 ndcStart = clipStart.xyz / clipStart.w;\n\t\t\tvec3 ndcEnd = clipEnd.xyz / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd.xy - ndcStart.xy;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t// get the offset direction as perpendicular to the view vector\n\t\t\t\tvec3 worldDir = normalize( end.xyz - start.xyz );\n\t\t\t\tvec3 offset;\n\t\t\t\tif ( position.y < 0.5 ) {\n\n\t\t\t\t\toffset = normalize( cross( start.xyz, worldDir ) );\n\n\t\t\t\t} else {\n\n\t\t\t\t\toffset = normalize( cross( end.xyz, worldDir ) );\n\n\t\t\t\t}\n\n\t\t\t\t// sign flip\n\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\tfloat forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );\n\n\t\t\t\t// don't extend the line if we're rendering dashes because we\n\t\t\t\t// won't be rendering the endcaps\n\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t// extend the line bounds to encompass  endcaps\n\t\t\t\t\tstart.xyz += - worldDir * linewidth * 0.5;\n\t\t\t\t\tend.xyz += worldDir * linewidth * 0.5;\n\n\t\t\t\t\t// shift the position of the quad so it hugs the forward edge of the line\n\t\t\t\t\toffset.xy -= dir * forwardOffset;\n\t\t\t\t\toffset.z += 0.5;\n\n\t\t\t\t#endif\n\n\t\t\t\t// endcaps\n\t\t\t\tif ( position.y > 1.0 || position.y < 0.0 ) {\n\n\t\t\t\t\toffset.xy += dir * 2.0 * forwardOffset;\n\n\t\t\t\t}\n\n\t\t\t\t// adjust for linewidth\n\t\t\t\toffset *= linewidth * 0.5;\n\n\t\t\t\t// set the world position\n\t\t\t\tworldPos = ( position.y < 0.5 ) ? start : end;\n\t\t\t\tworldPos.xyz += offset;\n\n\t\t\t\t// project the worldpos\n\t\t\t\tvec4 clip = projectionMatrix * worldPos;\n\n\t\t\t\t// shift the depth of the projected points so the line\n\t\t\t\t// segments overlap neatly\n\t\t\t\tvec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\n\t\t\t\tclip.z = clipPose.z * clip.w;\n\n\t\t\t#else\n\n\t\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\t\t\t\t// undo aspect ratio adjustment\n\t\t\t\tdir.x /= aspect;\n\t\t\t\toffset.x /= aspect;\n\n\t\t\t\t// sign flip\n\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t// endcaps\n\t\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\t\toffset += - dir;\n\n\t\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\t\toffset += dir;\n\n\t\t\t\t}\n\n\t\t\t\t// adjust for linewidth\n\t\t\t\toffset *= linewidth;\n\n\t\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\t\toffset /= resolution.y;\n\n\t\t\t\t// select end\n\t\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t\t// back to clip space\n\t\t\t\toffset *= clip.w;\n\n\t\t\t\tclip.xy += offset;\n\n\t\t\t#endif\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t`,\n\n\tfragmentShader:\n\t/* glsl */`\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\t\tuniform float linewidth;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashOffset;\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#ifdef WORLD_UNITS\n\n\t\t\tvarying vec4 worldPos;\n\t\t\tvarying vec3 worldStart;\n\t\t\tvarying vec3 worldEnd;\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t#endif\n\n\t\t#else\n\n\t\t\tvarying vec2 vUv;\n\n\t\t#endif\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {\n\n\t\t\tfloat mua;\n\t\t\tfloat mub;\n\n\t\t\tvec3 p13 = p1 - p3;\n\t\t\tvec3 p43 = p4 - p3;\n\n\t\t\tvec3 p21 = p2 - p1;\n\n\t\t\tfloat d1343 = dot( p13, p43 );\n\t\t\tfloat d4321 = dot( p43, p21 );\n\t\t\tfloat d1321 = dot( p13, p21 );\n\t\t\tfloat d4343 = dot( p43, p43 );\n\t\t\tfloat d2121 = dot( p21, p21 );\n\n\t\t\tfloat denom = d2121 * d4343 - d4321 * d4321;\n\n\t\t\tfloat numer = d1343 * d4321 - d1321 * d4343;\n\n\t\t\tmua = numer / denom;\n\t\t\tmua = clamp( mua, 0.0, 1.0 );\n\t\t\tmub = ( d1343 + d4321 * ( mua ) ) / d4343;\n\t\t\tmub = clamp( mub, 0.0, 1.0 );\n\n\t\t\treturn vec2( mua, mub );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tfloat alpha = opacity;\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t// Find the closest points on the view ray and the line segment\n\t\t\t\tvec3 rayEnd = normalize( worldPos.xyz ) * 1e5;\n\t\t\t\tvec3 lineDir = worldEnd - worldStart;\n\t\t\t\tvec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );\n\n\t\t\t\tvec3 p1 = worldStart + lineDir * params.x;\n\t\t\t\tvec3 p2 = rayEnd * params.y;\n\t\t\t\tvec3 delta = p1 - p2;\n\t\t\t\tfloat len = length( delta );\n\t\t\t\tfloat norm = len / linewidth;\n\n\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\tfloat dnorm = fwidth( norm );\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tif ( norm > 0.5 ) {\n\n\t\t\t\t\t\t\tdiscard;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#endif\n\n\t\t\t#else\n\n\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\n\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\tfloat len2 = a * a + b * b;\n\t\t\t\t\tfloat dlen = fwidth( len2 );\n\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\n\n\t\t\t\t\t}\n\n\t\t\t\t#else\n\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t\t\t}\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, alpha );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t`\n};\n\nclass LineMaterial extends ShaderMaterial {\n\n\tconstructor( parameters ) {\n\n\t\tsuper( {\n\n\t\t\ttype: 'LineMaterial',\n\n\t\t\tuniforms: UniformsUtils.clone( ShaderLib[ 'line' ].uniforms ),\n\n\t\t\tvertexShader: ShaderLib[ 'line' ].vertexShader,\n\t\t\tfragmentShader: ShaderLib[ 'line' ].fragmentShader,\n\n\t\t\tclipping: true // required for clipping support\n\n\t\t} );\n\n\t\tthis.isLineMaterial = true;\n\n\t\tObject.defineProperties( this, {\n\n\t\t\tcolor: {\n\n\t\t\t\tenumerable: true,\n\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn this.uniforms.diffuse.value;\n\n\t\t\t\t},\n\n\t\t\t\tset: function ( value ) {\n\n\t\t\t\t\tthis.uniforms.diffuse.value = value;\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tworldUnits: {\n\n\t\t\t\tenumerable: true,\n\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn 'WORLD_UNITS' in this.defines;\n\n\t\t\t\t},\n\n\t\t\t\tset: function ( value ) {\n\n\t\t\t\t\tif ( value === true ) {\n\n\t\t\t\t\t\tthis.defines.WORLD_UNITS = '';\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tdelete this.defines.WORLD_UNITS;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tlinewidth: {\n\n\t\t\t\tenumerable: true,\n\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn this.uniforms.linewidth.value;\n\n\t\t\t\t},\n\n\t\t\t\tset: function ( value ) {\n\n\t\t\t\t\tthis.uniforms.linewidth.value = value;\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tdashed: {\n\n\t\t\t\tenumerable: true,\n\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn Boolean( 'USE_DASH' in this.defines );\n\n\t\t\t\t},\n\n\t\t\t\tset( value ) {\n\n\t\t\t\t\tif ( Boolean( value ) !== Boolean( 'USE_DASH' in this.defines ) ) {\n\n\t\t\t\t\t\tthis.needsUpdate = true;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( value === true ) {\n\n\t\t\t\t\t\tthis.defines.USE_DASH = '';\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tdelete this.defines.USE_DASH;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tdashScale: {\n\n\t\t\t\tenumerable: true,\n\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn this.uniforms.dashScale.value;\n\n\t\t\t\t},\n\n\t\t\t\tset: function ( value ) {\n\n\t\t\t\t\tthis.uniforms.dashScale.value = value;\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tdashSize: {\n\n\t\t\t\tenumerable: true,\n\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn this.uniforms.dashSize.value;\n\n\t\t\t\t},\n\n\t\t\t\tset: function ( value ) {\n\n\t\t\t\t\tthis.uniforms.dashSize.value = value;\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tdashOffset: {\n\n\t\t\t\tenumerable: true,\n\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn this.uniforms.dashOffset.value;\n\n\t\t\t\t},\n\n\t\t\t\tset: function ( value ) {\n\n\t\t\t\t\tthis.uniforms.dashOffset.value = value;\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tgapSize: {\n\n\t\t\t\tenumerable: true,\n\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn this.uniforms.gapSize.value;\n\n\t\t\t\t},\n\n\t\t\t\tset: function ( value ) {\n\n\t\t\t\t\tthis.uniforms.gapSize.value = value;\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\topacity: {\n\n\t\t\t\tenumerable: true,\n\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn this.uniforms.opacity.value;\n\n\t\t\t\t},\n\n\t\t\t\tset: function ( value ) {\n\n\t\t\t\t\tthis.uniforms.opacity.value = value;\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tresolution: {\n\n\t\t\t\tenumerable: true,\n\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn this.uniforms.resolution.value;\n\n\t\t\t\t},\n\n\t\t\t\tset: function ( value ) {\n\n\t\t\t\t\tthis.uniforms.resolution.value.copy( value );\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\talphaToCoverage: {\n\n\t\t\t\tenumerable: true,\n\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn Boolean( 'USE_ALPHA_TO_COVERAGE' in this.defines );\n\n\t\t\t\t},\n\n\t\t\t\tset: function ( value ) {\n\n\t\t\t\t\tif ( Boolean( value ) !== Boolean( 'USE_ALPHA_TO_COVERAGE' in this.defines ) ) {\n\n\t\t\t\t\t\tthis.needsUpdate = true;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( value === true ) {\n\n\t\t\t\t\t\tthis.defines.USE_ALPHA_TO_COVERAGE = '';\n\t\t\t\t\t\tthis.extensions.derivatives = true;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tdelete this.defines.USE_ALPHA_TO_COVERAGE;\n\t\t\t\t\t\tthis.extensions.derivatives = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} );\n\n\t\tthis.setValues( parameters );\n\n\t}\n\n}\n\nexport { LineMaterial };\n", "import {\n\tBox3,\n\tInstancedInterleavedBuffer,\n\tInterleavedBufferAttribute,\n\tLine3,\n\tMathUtils,\n\tMatrix4,\n\tMesh,\n\tSphere,\n\tVector3,\n\tVector4\n} from 'three';\nimport { LineSegmentsGeometry } from '../lines/LineSegmentsGeometry.js';\nimport { LineMaterial } from '../lines/LineMaterial.js';\n\nconst _start = new Vector3();\nconst _end = new Vector3();\n\nconst _start4 = new Vector4();\nconst _end4 = new Vector4();\n\nconst _ssOrigin = new Vector4();\nconst _ssOrigin3 = new Vector3();\nconst _mvMatrix = new Matrix4();\nconst _line = new Line3();\nconst _closestPoint = new Vector3();\n\nconst _box = new Box3();\nconst _sphere = new Sphere();\nconst _clipToWorldVector = new Vector4();\n\nlet _ray, _instanceStart, _instanceEnd, _lineWidth;\n\n// Returns the margin required to expand by in world space given the distance from the camera,\n// line width, resolution, and camera projection\nfunction getWorldSpaceHalfWidth( camera, distance, resolution ) {\n\n\t// transform into clip space, adjust the x and y values by the pixel width offset, then\n\t// transform back into world space to get world offset. Note clip space is [-1, 1] so full\n\t// width does not need to be halved.\n\t_clipToWorldVector.set( 0, 0, - distance, 1.0 ).applyMatrix4( camera.projectionMatrix );\n\t_clipToWorldVector.multiplyScalar( 1.0 / _clipToWorldVector.w );\n\t_clipToWorldVector.x = _lineWidth / resolution.width;\n\t_clipToWorldVector.y = _lineWidth / resolution.height;\n\t_clipToWorldVector.applyMatrix4( camera.projectionMatrixInverse );\n\t_clipToWorldVector.multiplyScalar( 1.0 / _clipToWorldVector.w );\n\n\treturn Math.abs( Math.max( _clipToWorldVector.x, _clipToWorldVector.y ) );\n\n}\n\nfunction raycastWorldUnits( lineSegments, intersects ) {\n\n\tfor ( let i = 0, l = _instanceStart.count; i < l; i ++ ) {\n\n\t\t_line.start.fromBufferAttribute( _instanceStart, i );\n\t\t_line.end.fromBufferAttribute( _instanceEnd, i );\n\n\t\tconst pointOnLine = new Vector3();\n\t\tconst point = new Vector3();\n\n\t\t_ray.distanceSqToSegment( _line.start, _line.end, point, pointOnLine );\n\t\tconst isInside = point.distanceTo( pointOnLine ) < _lineWidth * 0.5;\n\n\t\tif ( isInside ) {\n\n\t\t\tintersects.push( {\n\t\t\t\tpoint,\n\t\t\t\tpointOnLine,\n\t\t\t\tdistance: _ray.origin.distanceTo( point ),\n\t\t\t\tobject: lineSegments,\n\t\t\t\tface: null,\n\t\t\t\tfaceIndex: i,\n\t\t\t\tuv: null,\n\t\t\t\tuv2: null,\n\t\t\t} );\n\n\t\t}\n\n\t}\n\n}\n\nfunction raycastScreenSpace( lineSegments, camera, intersects ) {\n\n\tconst projectionMatrix = camera.projectionMatrix;\n\tconst material = lineSegments.material;\n\tconst resolution = material.resolution;\n\tconst matrixWorld = lineSegments.matrixWorld;\n\n\tconst geometry = lineSegments.geometry;\n\tconst instanceStart = geometry.attributes.instanceStart;\n\tconst instanceEnd = geometry.attributes.instanceEnd;\n\n\tconst near = - camera.near;\n\n\t//\n\n\t// pick a point 1 unit out along the ray to avoid the ray origin\n\t// sitting at the camera origin which will cause \"w\" to be 0 when\n\t// applying the projection matrix.\n\t_ray.at( 1, _ssOrigin );\n\n\t// ndc space [ - 1.0, 1.0 ]\n\t_ssOrigin.w = 1;\n\t_ssOrigin.applyMatrix4( camera.matrixWorldInverse );\n\t_ssOrigin.applyMatrix4( projectionMatrix );\n\t_ssOrigin.multiplyScalar( 1 / _ssOrigin.w );\n\n\t// screen space\n\t_ssOrigin.x *= resolution.x / 2;\n\t_ssOrigin.y *= resolution.y / 2;\n\t_ssOrigin.z = 0;\n\n\t_ssOrigin3.copy( _ssOrigin );\n\n\t_mvMatrix.multiplyMatrices( camera.matrixWorldInverse, matrixWorld );\n\n\tfor ( let i = 0, l = instanceStart.count; i < l; i ++ ) {\n\n\t\t_start4.fromBufferAttribute( instanceStart, i );\n\t\t_end4.fromBufferAttribute( instanceEnd, i );\n\n\t\t_start4.w = 1;\n\t\t_end4.w = 1;\n\n\t\t// camera space\n\t\t_start4.applyMatrix4( _mvMatrix );\n\t\t_end4.applyMatrix4( _mvMatrix );\n\n\t\t// skip the segment if it's entirely behind the camera\n\t\tconst isBehindCameraNear = _start4.z > near && _end4.z > near;\n\t\tif ( isBehindCameraNear ) {\n\n\t\t\tcontinue;\n\n\t\t}\n\n\t\t// trim the segment if it extends behind camera near\n\t\tif ( _start4.z > near ) {\n\n\t\t\tconst deltaDist = _start4.z - _end4.z;\n\t\t\tconst t = ( _start4.z - near ) / deltaDist;\n\t\t\t_start4.lerp( _end4, t );\n\n\t\t} else if ( _end4.z > near ) {\n\n\t\t\tconst deltaDist = _end4.z - _start4.z;\n\t\t\tconst t = ( _end4.z - near ) / deltaDist;\n\t\t\t_end4.lerp( _start4, t );\n\n\t\t}\n\n\t\t// clip space\n\t\t_start4.applyMatrix4( projectionMatrix );\n\t\t_end4.applyMatrix4( projectionMatrix );\n\n\t\t// ndc space [ - 1.0, 1.0 ]\n\t\t_start4.multiplyScalar( 1 / _start4.w );\n\t\t_end4.multiplyScalar( 1 / _end4.w );\n\n\t\t// screen space\n\t\t_start4.x *= resolution.x / 2;\n\t\t_start4.y *= resolution.y / 2;\n\n\t\t_end4.x *= resolution.x / 2;\n\t\t_end4.y *= resolution.y / 2;\n\n\t\t// create 2d segment\n\t\t_line.start.copy( _start4 );\n\t\t_line.start.z = 0;\n\n\t\t_line.end.copy( _end4 );\n\t\t_line.end.z = 0;\n\n\t\t// get closest point on ray to segment\n\t\tconst param = _line.closestPointToPointParameter( _ssOrigin3, true );\n\t\t_line.at( param, _closestPoint );\n\n\t\t// check if the intersection point is within clip space\n\t\tconst zPos = MathUtils.lerp( _start4.z, _end4.z, param );\n\t\tconst isInClipSpace = zPos >= - 1 && zPos <= 1;\n\n\t\tconst isInside = _ssOrigin3.distanceTo( _closestPoint ) < _lineWidth * 0.5;\n\n\t\tif ( isInClipSpace && isInside ) {\n\n\t\t\t_line.start.fromBufferAttribute( instanceStart, i );\n\t\t\t_line.end.fromBufferAttribute( instanceEnd, i );\n\n\t\t\t_line.start.applyMatrix4( matrixWorld );\n\t\t\t_line.end.applyMatrix4( matrixWorld );\n\n\t\t\tconst pointOnLine = new Vector3();\n\t\t\tconst point = new Vector3();\n\n\t\t\t_ray.distanceSqToSegment( _line.start, _line.end, point, pointOnLine );\n\n\t\t\tintersects.push( {\n\t\t\t\tpoint: point,\n\t\t\t\tpointOnLine: pointOnLine,\n\t\t\t\tdistance: _ray.origin.distanceTo( point ),\n\t\t\t\tobject: lineSegments,\n\t\t\t\tface: null,\n\t\t\t\tfaceIndex: i,\n\t\t\t\tuv: null,\n\t\t\t\tuv2: null,\n\t\t\t} );\n\n\t\t}\n\n\t}\n\n}\n\nclass LineSegments2 extends Mesh {\n\n\tconstructor( geometry = new LineSegmentsGeometry(), material = new LineMaterial( { color: Math.random() * 0xffffff } ) ) {\n\n\t\tsuper( geometry, material );\n\n\t\tthis.isLineSegments2 = true;\n\n\t\tthis.type = 'LineSegments2';\n\n\t}\n\n\t// for backwards-compatibility, but could be a method of LineSegmentsGeometry...\n\n\tcomputeLineDistances() {\n\n\t\tconst geometry = this.geometry;\n\n\t\tconst instanceStart = geometry.attributes.instanceStart;\n\t\tconst instanceEnd = geometry.attributes.instanceEnd;\n\t\tconst lineDistances = new Float32Array( 2 * instanceStart.count );\n\n\t\tfor ( let i = 0, j = 0, l = instanceStart.count; i < l; i ++, j += 2 ) {\n\n\t\t\t_start.fromBufferAttribute( instanceStart, i );\n\t\t\t_end.fromBufferAttribute( instanceEnd, i );\n\n\t\t\tlineDistances[ j ] = ( j === 0 ) ? 0 : lineDistances[ j - 1 ];\n\t\t\tlineDistances[ j + 1 ] = lineDistances[ j ] + _start.distanceTo( _end );\n\n\t\t}\n\n\t\tconst instanceDistanceBuffer = new InstancedInterleavedBuffer( lineDistances, 2, 1 ); // d0, d1\n\n\t\tgeometry.setAttribute( 'instanceDistanceStart', new InterleavedBufferAttribute( instanceDistanceBuffer, 1, 0 ) ); // d0\n\t\tgeometry.setAttribute( 'instanceDistanceEnd', new InterleavedBufferAttribute( instanceDistanceBuffer, 1, 1 ) ); // d1\n\n\t\treturn this;\n\n\t}\n\n\traycast( raycaster, intersects ) {\n\n\t\tconst worldUnits = this.material.worldUnits;\n\t\tconst camera = raycaster.camera;\n\n\t\tif ( camera === null && ! worldUnits ) {\n\n\t\t\tconsole.error( 'LineSegments2: \"Raycaster.camera\" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.' );\n\n\t\t}\n\n\t\tconst threshold = ( raycaster.params.Line2 !== undefined ) ? raycaster.params.Line2.threshold || 0 : 0;\n\n\t\t_ray = raycaster.ray;\n\n\t\tconst matrixWorld = this.matrixWorld;\n\t\tconst geometry = this.geometry;\n\t\tconst material = this.material;\n\n\t\t_lineWidth = material.linewidth + threshold;\n\n\t\t_instanceStart = geometry.attributes.instanceStart;\n\t\t_instanceEnd = geometry.attributes.instanceEnd;\n\n\t\t// check if we intersect the sphere bounds\n\t\tif ( geometry.boundingSphere === null ) {\n\n\t\t\tgeometry.computeBoundingSphere();\n\n\t\t}\n\n\t\t_sphere.copy( geometry.boundingSphere ).applyMatrix4( matrixWorld );\n\n\t\t// increase the sphere bounds by the worst case line screen space width\n\t\tlet sphereMargin;\n\t\tif ( worldUnits ) {\n\n\t\t\tsphereMargin = _lineWidth * 0.5;\n\n\t\t} else {\n\n\t\t\tconst distanceToSphere = Math.max( camera.near, _sphere.distanceToPoint( _ray.origin ) );\n\t\t\tsphereMargin = getWorldSpaceHalfWidth( camera, distanceToSphere, material.resolution );\n\n\t\t}\n\n\t\t_sphere.radius += sphereMargin;\n\n\t\tif ( _ray.intersectsSphere( _sphere ) === false ) {\n\n\t\t\treturn;\n\n\t\t}\n\n\t\t// check if we intersect the box bounds\n\t\tif ( geometry.boundingBox === null ) {\n\n\t\t\tgeometry.computeBoundingBox();\n\n\t\t}\n\n\t\t_box.copy( geometry.boundingBox ).applyMatrix4( matrixWorld );\n\n\t\t// increase the box bounds by the worst case line width\n\t\tlet boxMargin;\n\t\tif ( worldUnits ) {\n\n\t\t\tboxMargin = _lineWidth * 0.5;\n\n\t\t} else {\n\n\t\t\tconst distanceToBox = Math.max( camera.near, _box.distanceToPoint( _ray.origin ) );\n\t\t\tboxMargin = getWorldSpaceHalfWidth( camera, distanceToBox, material.resolution );\n\n\t\t}\n\n\t\t_box.expandByScalar( boxMargin );\n\n\t\tif ( _ray.intersectsBox( _box ) === false ) {\n\n\t\t\treturn;\n\n\t\t}\n\n\t\tif ( worldUnits ) {\n\n\t\t\traycastWorldUnits( this, intersects );\n\n\t\t} else {\n\n\t\t\traycastScreenSpace( this, camera, intersects );\n\n\t\t}\n\n\t}\n\n}\n\nexport { LineSegments2 };\n", "import { LineSegmentsGeometry } from '../lines/LineSegmentsGeometry.js';\n\nclass LineGeometry extends LineSegmentsGeometry {\n\n\tconstructor() {\n\n\t\tsuper();\n\n\t\tthis.isLineGeometry = true;\n\n\t\tthis.type = 'LineGeometry';\n\n\t}\n\n\tsetPositions( array ) {\n\n\t\t// converts [ x1, y1, z1,  x2, y2, z2, ... ] to pairs format\n\n\t\tconst length = array.length - 3;\n\t\tconst points = new Float32Array( 2 * length );\n\n\t\tfor ( let i = 0; i < length; i += 3 ) {\n\n\t\t\tpoints[ 2 * i ] = array[ i ];\n\t\t\tpoints[ 2 * i + 1 ] = array[ i + 1 ];\n\t\t\tpoints[ 2 * i + 2 ] = array[ i + 2 ];\n\n\t\t\tpoints[ 2 * i + 3 ] = array[ i + 3 ];\n\t\t\tpoints[ 2 * i + 4 ] = array[ i + 4 ];\n\t\t\tpoints[ 2 * i + 5 ] = array[ i + 5 ];\n\n\t\t}\n\n\t\tsuper.setPositions( points );\n\n\t\treturn this;\n\n\t}\n\n\tsetColors( array ) {\n\n\t\t// converts [ r1, g1, b1,  r2, g2, b2, ... ] to pairs format\n\n\t\tconst length = array.length - 3;\n\t\tconst colors = new Float32Array( 2 * length );\n\n\t\tfor ( let i = 0; i < length; i += 3 ) {\n\n\t\t\tcolors[ 2 * i ] = array[ i ];\n\t\t\tcolors[ 2 * i + 1 ] = array[ i + 1 ];\n\t\t\tcolors[ 2 * i + 2 ] = array[ i + 2 ];\n\n\t\t\tcolors[ 2 * i + 3 ] = array[ i + 3 ];\n\t\t\tcolors[ 2 * i + 4 ] = array[ i + 4 ];\n\t\t\tcolors[ 2 * i + 5 ] = array[ i + 5 ];\n\n\t\t}\n\n\t\tsuper.setColors( colors );\n\n\t\treturn this;\n\n\t}\n\n\tfromLine( line ) {\n\n\t\tconst geometry = line.geometry;\n\n\t\tthis.setPositions( geometry.attributes.position.array ); // assumes non-indexed\n\n\t\t// set colors, maybe\n\n\t\treturn this;\n\n\t}\n\n}\n\nexport { LineGeometry };\n", "import { LineSegments2 } from '../lines/LineSegments2.js';\nimport { LineGeometry } from '../lines/LineGeometry.js';\nimport { LineMaterial } from '../lines/LineMaterial.js';\n\nclass Line2 extends LineSegments2 {\n\n\tconstructor( geometry = new LineGeometry(), material = new LineMaterial( { color: Math.random() * 0xffffff } ) ) {\n\n\t\tsuper( geometry, material );\n\n\t\tthis.isLine2 = true;\n\n\t\tthis.type = 'Line2';\n\n\t}\n\n}\n\nexport { Line2 };\n", "import { mat4, vec3 } from 'gl-matrix';\r\nimport { Group, Matrix4 } from 'three';\r\nimport { Line2 } from 'three/examples/jsm/lines/Line2.js';\r\n\r\nconst glTempPos = new Float64Array( 3 );\r\nconst glTempMatrix = new Float64Array( 16 );\r\nconst tempMatrix = new Matrix4();\r\nconst tempParentMatrixWorld = new Matrix4();\r\nexport class IKLinkHelper extends Group {\r\n\r\n\tconstructor( link ) {\r\n\r\n\t\tsuper();\r\n\t\tthis.frame = link;\r\n\r\n\t\tconst line = new Line2();\r\n\t\tline.geometry.setPositions( [\r\n\t\t\t0, 0, 0,\r\n\t\t\t0, 0, 0,\r\n\t\t] );\r\n\t\tline.material.color.set( 0xffffff );\r\n\t\tline.material.linewidth = 2;\r\n\t\tthis.add( line );\r\n\t\tthis.line = line;\r\n\r\n\t}\r\n\r\n\tupdate() {\r\n\r\n\t\tconst { frame, line } = this;\r\n\t\tif ( frame.parent ) {\r\n\r\n\t\t\tglTempPos[ 0 ] = 0;\r\n\t\t\tglTempPos[ 1 ] = 0;\r\n\t\t\tglTempPos[ 2 ] = 0;\r\n\r\n\t\t\tmat4.invert( glTempMatrix, frame.matrix );\r\n\t\t\tvec3.transformMat4( glTempPos, glTempPos, glTempMatrix );\r\n\r\n\t\t\tline.geometry.setPositions( [\r\n\t\t\t\t...glTempPos,\r\n\t\t\t\t0, 0, 0,\r\n\t\t\t] );\r\n\t\t\tline.visible = true;\r\n\r\n\t\t\tif ( vec3.length( glTempPos ) < 1e-7 ) {\r\n\r\n\t\t\t\tline.visible = false;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tline.visible = false;\r\n\r\n\t\t}\r\n\r\n\r\n\t}\r\n\r\n\tupdateMatrixWorld( ...args ) {\r\n\r\n\t\tconst frame = this.frame;\r\n\t\tframe.updateMatrixWorld();\r\n\t\tif ( frame.isJoint ) {\r\n\r\n\t\t\tif ( frame.parent ) {\r\n\r\n\t\t\t\ttempMatrix.set( ...frame.matrix ).transpose();\r\n\t\t\t\ttempParentMatrixWorld.set( ...frame.parent.matrixWorld ).transpose();\r\n\t\t\t\tthis.matrix.multiplyMatrices( tempParentMatrixWorld, tempMatrix );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\ttempMatrix.set( ...frame.matrix ).transpose();\r\n\t\t\t\tthis.matrix.set( ...frame.matrix ).transpose();\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.matrix.set( ...frame.matrixWorld ).transpose();\r\n\r\n\t\t}\r\n\r\n\t\tthis.matrix.decompose( this.position, this.quaternion, this.scale );\r\n\t\tsuper.updateMatrixWorld( ...args );\r\n\r\n\t}\r\n\r\n\tdispose() {\r\n\r\n\t\tthis.traverse( c => {\r\n\r\n\t\t\tif ( c.material ) {\r\n\r\n\t\t\t\tc.material.dispose();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( c.geometry ) {\r\n\r\n\t\t\t\tc.geometry.dispose();\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n}\r\n", "import { BoxBufferGeometry, Vector3, CylinderBufferGeometry, SphereBufferGeometry, Mesh, MeshStandardMaterial } from 'three';\r\nimport { Line2 } from 'three/examples/jsm/lines/Line2.js';\r\nimport { IKLinkHelper } from './IKLinkHelper.js';\r\nimport { DOF } from '../core/Joint.js';\r\nimport { HALF_PI } from '../core/utils/constants.js';\r\n\r\nconst tempPos = new Vector3();\r\nconst tempRot = new Vector3();\r\n\r\nclass RotationLimitHelper extends Mesh {\r\n\r\n\tconstructor( material, dof ) {\r\n\r\n\t\tsuper( undefined, material );\r\n\t\tthis._dof = dof;\r\n\t\tthis._min = null;\r\n\t\tthis._delta = null;\r\n\t\tthis.setLimits( 0, 2 * Math.PI );\r\n\r\n\r\n\t}\r\n\r\n\tsetLimits( min, max ) {\r\n\r\n\t\tconst delta = Math.min( max - min, 2 * Math.PI );\r\n\t\tif ( min === - Infinity ) {\r\n\r\n\t\t\tmin = 0;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this._min === min && this._delta === delta ) {\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tthis._min = min;\r\n\t\tthis._delta = delta;\r\n\r\n\t\tif ( this.geometry ) {\r\n\r\n\t\t\tthis.geometry.dispose();\r\n\r\n\t\t}\r\n\r\n\t\tconst dof = this._dof;\r\n\t\tconst geometry = new CylinderBufferGeometry( 0.075, 0.075, 1e-7, 100, 1, false, min, delta );\r\n\r\n\t\tif ( dof === DOF.EX ) {\r\n\r\n\t\t\tgeometry.rotateZ( HALF_PI );\r\n\r\n\t\t}\r\n\r\n\t\tif ( dof === DOF.EZ ) {\r\n\r\n\t\t\tgeometry.rotateX( HALF_PI );\r\n\r\n\t\t}\r\n\r\n\t\tthis.geometry = geometry;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport class IKJointHelper extends IKLinkHelper {\r\n\r\n\tconstructor( joint ) {\r\n\r\n\t\tsuper( joint );\r\n\r\n\t\tconst xRotationMesh = new Mesh(\r\n\t\t\tnew CylinderBufferGeometry( 0.05, 0.05, 0.25, 30, 1 ).rotateZ( HALF_PI ),\r\n\t\t\tnew MeshStandardMaterial(),\r\n\t\t);\r\n\r\n\t\tconst xRotationLimits = new RotationLimitHelper(\r\n\t\t\tnew MeshStandardMaterial(),\r\n\t\t\tDOF.EX,\r\n\t\t);\r\n\r\n\t\tconst yRotationMesh = new Mesh(\r\n\t\t\tnew CylinderBufferGeometry( 0.05, 0.05, 0.25, 30, 1 ),\r\n\t\t\tnew MeshStandardMaterial(),\r\n\t\t);\r\n\r\n\t\tconst yRotationLimits = new RotationLimitHelper(\r\n\t\t\tnew MeshStandardMaterial(),\r\n\t\t\tDOF.EY,\r\n\t\t);\r\n\r\n\t\tconst zRotationMesh = new Mesh(\r\n\t\t\tnew CylinderBufferGeometry( 0.05, 0.05, 0.25, 30, 1 ).rotateX( HALF_PI ),\r\n\t\t\tnew MeshStandardMaterial(),\r\n\t\t);\r\n\r\n\t\tconst zRotationLimits = new RotationLimitHelper(\r\n\t\t\tnew MeshStandardMaterial(),\r\n\t\t\tDOF.EZ,\r\n\t\t);\r\n\t\tzRotationLimits.rotation.set( HALF_PI, 0, 0 );\r\n\r\n\t\tconst freeRotationMesh = new Mesh(\r\n\t\t\tnew SphereBufferGeometry( 0.05, 30, 30 ),\r\n\t\t\tnew MeshStandardMaterial(),\r\n\t\t);\r\n\r\n\t\tconst fixedMesh = new Mesh(\r\n\t\t\tnew BoxBufferGeometry( 0.05, 0.05, 0.05 ),\r\n\t\t\tnew MeshStandardMaterial(),\r\n\t\t);\r\n\r\n\t\tconst translationMesh = new Line2();\r\n\t\ttranslationMesh.geometry.setPositions( [\r\n\t\t\t0, 0, 0,\r\n\t\t\t1, 0, 0,\r\n\t\t\t1, 1, 0,\r\n\t\t\t1, 1, 1,\r\n\t\t] );\r\n\t\ttranslationMesh.material.color.set( 0xffffff );\r\n\t\ttranslationMesh.material.side = 2;\r\n\t\ttranslationMesh.material.linewidth = 2;\r\n\r\n\t\tthis.add(\r\n\t\t\txRotationMesh,\r\n\t\t\tyRotationMesh,\r\n\t\t\tzRotationMesh,\r\n\t\t\txRotationLimits,\r\n\t\t\tyRotationLimits,\r\n\t\t\tzRotationLimits,\r\n\t\t\tfreeRotationMesh,\r\n\t\t\ttranslationMesh,\r\n\t\t\tfixedMesh,\r\n\t\t);\r\n\r\n\t\tthis.xRotationMesh = xRotationMesh;\r\n\t\tthis.yRotationMesh = yRotationMesh;\r\n\t\tthis.zRotationMesh = zRotationMesh;\r\n\t\tthis.xRotationLimits = xRotationLimits;\r\n\t\tthis.yRotationLimits = yRotationLimits;\r\n\t\tthis.zRotationLimits = zRotationLimits;\r\n\t\tthis.translationMesh = translationMesh;\r\n\t\tthis.freeRotationMesh = freeRotationMesh;\r\n\t\tthis.fixedMesh = fixedMesh;\r\n\r\n\t}\r\n\r\n\tsetJointScale( s ) {\r\n\r\n\t\tthis.xRotationMesh.scale.setScalar( s );\r\n\t\tthis.yRotationMesh.scale.setScalar( s );\r\n\t\tthis.zRotationMesh.scale.setScalar( s );\r\n\t\tthis.xRotationLimits.scale.setScalar( s );\r\n\t\tthis.yRotationLimits.scale.setScalar( s );\r\n\t\tthis.zRotationLimits.scale.setScalar( s );\r\n\t\tthis.freeRotationMesh.scale.setScalar( s );\r\n\t\tthis.fixedMesh.scale.setScalar( s );\r\n\r\n\t}\r\n\r\n\tupdate() {\r\n\r\n\t\tsuper.update();\r\n\r\n\t\tconst {\r\n\t\t\txRotationMesh,\r\n\t\t\tyRotationMesh,\r\n\t\t\tzRotationMesh,\r\n\t\t\txRotationLimits,\r\n\t\t\tyRotationLimits,\r\n\t\t\tzRotationLimits,\r\n\t\t\tfreeRotationMesh,\r\n\t\t\ttranslationMesh,\r\n\t\t\tfixedMesh,\r\n\t\t} = this;\r\n\t\tconst joint = this.frame;\r\n\t\txRotationMesh.visible = false;\r\n\t\tyRotationMesh.visible = false;\r\n\t\tzRotationMesh.visible = false;\r\n\t\txRotationLimits.visible = false;\r\n\t\tyRotationLimits.visible = false;\r\n\t\tzRotationLimits.visible = false;\r\n\t\tfreeRotationMesh.visible = false;\r\n\t\ttranslationMesh.visible = false;\r\n\t\tfixedMesh.visible = false;\r\n\r\n\t\tif ( joint.translationDoFCount !== 0 ) {\r\n\r\n\t\t\ttranslationMesh.visible = true;\r\n\r\n\t\t}\r\n\r\n\t\tif ( joint.rotationDoFCount === 3 ) {\r\n\r\n\t\t\tfreeRotationMesh.visible = true;\r\n\t\t\txRotationLimits.visible = true;\r\n\t\t\tyRotationLimits.visible = true;\r\n\t\t\tzRotationLimits.visible = true;\r\n\r\n\t\t} else {\r\n\r\n\t\t\txRotationMesh.visible = Boolean( joint.dofFlags[ DOF.EX ] );\r\n\t\t\tyRotationMesh.visible = Boolean( joint.dofFlags[ DOF.EY ] );\r\n\t\t\tzRotationMesh.visible = Boolean( joint.dofFlags[ DOF.EZ ] );\r\n\r\n\t\t\txRotationLimits.visible = Boolean( joint.dofFlags[ DOF.EX ] );\r\n\t\t\tyRotationLimits.visible = Boolean( joint.dofFlags[ DOF.EY ] );\r\n\t\t\tzRotationLimits.visible = Boolean( joint.dofFlags[ DOF.EZ ] );\r\n\r\n\t\t}\r\n\r\n\t\tif ( joint.translationDoFCount === 0 && joint.rotationDoFCount === 0 ) {\r\n\r\n\t\t\t// fixedMesh.visible = true;\r\n\t\t\tthis.visible = this.line.visible;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tupdateMatrixWorld( ...args ) {\r\n\r\n\t\tconst {\r\n\t\t\txRotationMesh,\r\n\t\t\tyRotationMesh,\r\n\t\t\tzRotationMesh,\r\n\t\t\txRotationLimits,\r\n\t\t\tyRotationLimits,\r\n\t\t\tzRotationLimits,\r\n\t\t\tfreeRotationMesh,\r\n\t\t\ttranslationMesh,\r\n\t\t} = this;\r\n\t\tconst joint = this.frame;\r\n\r\n\t\ttempPos.set(\r\n\t\t\tjoint.getDoFValue( DOF.X ),\r\n\t\t\tjoint.getDoFValue( DOF.Y ),\r\n\t\t\tjoint.getDoFValue( DOF.Z ),\r\n\t\t);\r\n\r\n\t\ttempRot.set(\r\n\t\t\tjoint.getDoFValue( DOF.EX ),\r\n\t\t\tjoint.getDoFValue( DOF.EY ),\r\n\t\t\tjoint.getDoFValue( DOF.EZ ),\r\n\t\t);\r\n\r\n\t\ttranslationMesh.scale.copy( tempPos );\r\n\r\n\t\txRotationMesh.position.copy( tempPos );\r\n\t\txRotationLimits.position.copy( tempPos );\r\n\t\txRotationLimits.setLimits(\r\n\t\t\tjoint.getMinLimit( DOF.EX ),\r\n\t\t\tjoint.getMaxLimit( DOF.EX ),\r\n\t\t);\r\n\r\n\t\tyRotationMesh.position.copy( tempPos );\r\n\t\tyRotationMesh.rotation.set( tempRot.x, 0, 0 );\r\n\t\tyRotationLimits.position.copy( tempPos );\r\n\t\tyRotationLimits.rotation.set( tempRot.x, 0, 0 );\r\n\t\tyRotationLimits.setLimits(\r\n\t\t\tjoint.getMinLimit( DOF.EY ),\r\n\t\t\tjoint.getMaxLimit( DOF.EY ),\r\n\t\t);\r\n\r\n\t\tzRotationMesh.position.copy( tempPos );\r\n\t\tzRotationMesh.rotation.set( tempRot.x, tempRot.y, 0 );\r\n\t\tzRotationLimits.position.copy( tempPos );\r\n\t\tzRotationLimits.rotation.set( tempRot.x, tempRot.y, 0 );\r\n\t\tzRotationLimits.setLimits(\r\n\t\t\tjoint.getMinLimit( DOF.EZ ),\r\n\t\t\tjoint.getMaxLimit( DOF.EZ ),\r\n\t\t);\r\n\r\n\t\tfreeRotationMesh.position.copy( tempPos );\r\n\r\n\t\tsuper.updateMatrixWorld( ...args );\r\n\r\n\t}\r\n\r\n}\r\n", "import { Group, Vector2, Color } from 'three';\r\nimport { IKJointHelper } from './IKJointHelper.js';\r\nimport { IKLinkHelper } from './IKLinkHelper.js';\r\nimport { findRoots } from '../core/utils/findRoots.js';\r\n\r\nconst currLinks = new Set();\r\nconst currJoints = new Set();\r\nexport class IKRootsHelper extends Group {\r\n\r\n\tconstructor( roots = [] ) {\r\n\r\n\t\tsuper();\r\n\t\tthis.roots = Array.isArray( roots ) ? [ ...roots ] : [ roots ];\r\n\t\tthis.joints = new Map();\r\n\t\tthis.links = new Map();\r\n\t\tthis.resolution = new Vector2( 1000, 1000 );\r\n\t\tthis.drawThrough = false;\r\n\t\tthis.color = new Color( 0xffffff );\r\n\t\tthis.jointScale = 1;\r\n\r\n\t\tthis.updateStructure();\r\n\r\n\t}\r\n\r\n\t_updateHelpers() {\r\n\r\n\t\tconst { drawThrough, resolution, color, jointScale } = this;\r\n\t\tthis.traverse( c => {\r\n\r\n\t\t\tconst material = c.material;\r\n\t\t\tif ( material ) {\r\n\r\n\t\t\t\tmaterial.color.copy( color );\r\n\r\n\t\t\t\tif ( material.isLineMaterial ) {\r\n\r\n\t\t\t\t\tmaterial.uniforms.resolution.value.copy( resolution );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( drawThrough ) {\r\n\r\n\t\t\t\t\tmaterial.opacity = 0.1;\r\n\t\t\t\t\tmaterial.transparent = true;\r\n\t\t\t\t\tmaterial.depthWrite = false;\r\n\t\t\t\t\tmaterial.depthTest = false;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tmaterial.opacity = 1;\r\n\t\t\t\t\tmaterial.transparent = false;\r\n\t\t\t\t\tmaterial.depthWrite = true;\r\n\t\t\t\t\tmaterial.depthTest = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( c instanceof IKJointHelper ) {\r\n\r\n\t\t\t\tc.setJointScale( jointScale );\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tsetColor( c ) {\r\n\r\n\t\tif ( c.isColor ) {\r\n\r\n\t\t\tthis.color.copy( c );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.color.set( c );\r\n\r\n\t\t}\r\n\r\n\t\tthis._updateHelpers();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetJointScale( s ) {\r\n\r\n\t\tthis.jointScale = s;\r\n\t\tthis._updateHelpers();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetDrawThrough( value ) {\r\n\r\n\t\tthis.drawThrough = value;\r\n\t\tthis._updateHelpers();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetResolution( width, height ) {\r\n\r\n\t\tthis.resolution.set( width, height );\r\n\t\tthis._updateHelpers();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tupdateStructure() {\r\n\r\n\t\tconst { joints, links } = this;\r\n\r\n\t\tconst roots = findRoots( this.roots );\r\n\r\n\t\tcurrJoints.clear();\r\n\t\tjoints.forEach( ( helper, joint ) => currJoints.add( joint ) );\r\n\r\n\t\tcurrLinks.clear();\r\n\t\tlinks.forEach( ( helper, links ) => currLinks.add( links ) );\r\n\r\n\t\tfor ( let i = 0, l = roots.length; i < l; i ++ ) {\r\n\r\n\t\t\tconst root = roots[ i ];\r\n\t\t\troot.updateMatrixWorld( true );\r\n\t\t\troot.traverse( c => {\r\n\r\n\t\t\t\tif ( c.isJoint ) {\r\n\r\n\t\t\t\t\tlet helper;\r\n\t\t\t\t\tif ( joints.has( c ) ) {\r\n\r\n\t\t\t\t\t\thelper = joints.get( c );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\thelper = new IKJointHelper( c );\r\n\t\t\t\t\t\tthis.add( helper );\r\n\t\t\t\t\t\tjoints.set( c, helper );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\thelper.update();\r\n\t\t\t\t\tcurrJoints.delete( c );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tlet helper;\r\n\t\t\t\t\tif ( links.has( c ) ) {\r\n\r\n\t\t\t\t\t\thelper = links.get( c );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\thelper = new IKLinkHelper( c );\r\n\t\t\t\t\t\tthis.add( helper );\r\n\t\t\t\t\t\tlinks.set( c, helper );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\thelper.update();\r\n\t\t\t\t\tcurrLinks.delete( c );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\r\n\t\tcurrJoints.forEach( joint => {\r\n\r\n\t\t\tconst helper = joints.get( joint );\r\n\t\t\tthis.remove( helper );\r\n\t\t\thelper.dispose();\r\n\r\n\t\t} );\r\n\r\n\t\tcurrLinks.forEach( link => {\r\n\r\n\t\t\tconst helper = links.get( link );\r\n\t\t\tthis.remove( helper );\r\n\t\t\thelper.dispose();\r\n\r\n\t\t} );\r\n\r\n\t\tthis._updateHelpers();\r\n\r\n\t}\r\n\r\n\tdispose() {\r\n\r\n\t\tconst { links, joints } = this;\r\n\t\tjoints.forEach( ( [ joint, helper ] ) => {\r\n\r\n\t\t\tthis.remove( helper );\r\n\t\t\thelper.dispose();\r\n\r\n\t\t} );\r\n\t\tjoints.clear();\r\n\r\n\t\tlinks.forEach( ( [ link, helper ] ) => {\r\n\r\n\t\t\tthis.remove( helper );\r\n\t\t\thelper.dispose();\r\n\r\n\t\t} );\r\n\t\tlinks.clear();\r\n\r\n\t}\r\n\r\n}\r\n", "import { Euler } from 'three';\r\nimport { quat } from 'gl-matrix';\r\nimport { Joint, DOF } from '../core/Joint.js';\r\nimport { Link } from '../core/Link.js';\r\n\r\nconst tempVec = new Float64Array( 3 );\r\nconst tempVec2 = new Float64Array( 3 );\r\nconst tempEuler = new Euler();\r\n\r\nexport function urdfRobotToIKRoot( urdfNode, trimUnused = false, isRoot = true ) {\r\n\r\n\tlet rootNode = null;\r\n\tlet node;\r\n\tlet doReturn = true;\r\n\r\n\tif ( urdfNode.isURDFRobot ) {\r\n\r\n\t\trootNode = new Joint();\r\n\t\trootNode.name = '__world_joint__';\r\n\t\trootNode.setDoF( DOF.X, DOF.Y, DOF.Z, DOF.EX, DOF.EY, DOF.EZ );\r\n\r\n\t\tnode = new Link();\r\n\t\tnode.name = urdfNode.name;\r\n\r\n\t\trootNode.addChild( node );\r\n\r\n\t} else if ( urdfNode.isURDFLink ) {\r\n\r\n\t\tnode = new Link();\r\n\t\tnode.name = urdfNode.name;\r\n\t\tdoReturn = ! trimUnused;\r\n\r\n\t} else if ( urdfNode.isURDFJoint ) {\r\n\r\n\t\trootNode = new Joint();\r\n\r\n\t\tconst jointType = urdfNode.jointType;\r\n\t\tswitch ( jointType ) {\r\n\r\n\t\t\tcase 'continuous':\r\n\t\t\tcase 'revolute':\r\n\t\t\tcase 'prismatic': {\r\n\r\n\t\t\t\tconst link = new Link();\r\n\t\t\t\trootNode.addChild( link );\r\n\r\n\t\t\t\tconst joint = new Joint();\r\n\t\t\t\tjoint.name = urdfNode.name;\r\n\t\t\t\tlink.addChild( joint );\r\n\r\n\t\t\t\tconst fixedLink = new Link();\r\n\t\t\t\tjoint.addChild( fixedLink );\r\n\r\n\t\t\t\tconst fixedJoint = new Joint();\r\n\t\t\t\tfixedLink.addChild( fixedJoint );\r\n\r\n\t\t\t\ttempVec[ 0 ] = 0;\r\n\t\t\t\ttempVec[ 1 ] = 0;\r\n\t\t\t\ttempVec[ 2 ] = 1;\r\n\r\n\t\t\t\ttempVec2[ 0 ] = urdfNode.axis.x;\r\n\t\t\t\ttempVec2[ 1 ] = urdfNode.axis.y;\r\n\t\t\t\ttempVec2[ 2 ] = urdfNode.axis.z;\r\n\r\n\t\t\t\t// orient the joint such that +Z is pointing down the URDF rotation axis\r\n\t\t\t\tquat.rotationTo( joint.quaternion, tempVec, tempVec2 );\r\n\t\t\t\tquat.invert( fixedJoint.quaternion, joint.quaternion );\r\n\t\t\t\tjoint.setMatrixNeedsUpdate();\r\n\t\t\t\tfixedJoint.setMatrixNeedsUpdate();\r\n\r\n\t\t\t\tif ( jointType === 'revolute' || jointType === 'continuous' ) {\r\n\r\n\t\t\t\t\tjoint.setDoF( DOF.EZ );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tjoint.setDoF( DOF.Z );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( jointType !== 'continuous' ) {\r\n\r\n\t\t\t\t\tjoint.setMinLimits( urdfNode.limit.lower );\r\n\t\t\t\t\tjoint.setMaxLimits( urdfNode.limit.upper );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnode = fixedJoint;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcase 'fixed': {\r\n\r\n\t\t\t\tnode = rootNode;\r\n\t\t\t\tdoReturn = ! trimUnused;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcase 'planar':\r\n\t\t\tcase 'floating':\r\n\t\t\tdefault:\r\n\r\n\t\t\t\tconsole.error( `urdfRobotToIKRoot: Joint type ${jointType} not supported.` );\r\n\t\t\t\tdoReturn = ! trimUnused;\r\n\r\n\t\t}\r\n\r\n\t} else {\r\n\r\n\t\treturn null;\r\n\r\n\t}\r\n\r\n\t// don't position the urdf root because we're treating the positions at\r\n\t// degrees of freedom\r\n\tif ( ! isRoot ) {\r\n\r\n\t\t( rootNode || node )\r\n\t\t\t.setPosition(\r\n\t\t\t\turdfNode.position.x,\r\n\t\t\t\turdfNode.position.y,\r\n\t\t\t\turdfNode.position.z,\r\n\t\t\t);\r\n\r\n\t\t( rootNode || node )\r\n\t\t\t.setQuaternion(\r\n\t\t\t\turdfNode.quaternion.x,\r\n\t\t\t\turdfNode.quaternion.y,\r\n\t\t\t\turdfNode.quaternion.z,\r\n\t\t\t\turdfNode.quaternion.w,\r\n\t\t\t);\r\n\r\n\t}\r\n\r\n\tconst children = urdfNode.children;\r\n\tfor ( let i = 0, l = children.length; i < l; i ++ ) {\r\n\r\n\t\tconst res = urdfRobotToIKRoot( children[ i ], trimUnused, false );\r\n\r\n\t\tif ( res ) {\r\n\r\n\t\t\tnode.addChild( res );\r\n\t\t\tdoReturn = true;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\treturn ( ! trimUnused || doReturn ) ? rootNode || node : null;\r\n\r\n}\r\n\r\nexport function setIKFromUrdf( ikRoot, urdfRoot ) {\r\n\r\n\tikRoot.setDoFValue( DOF.X, urdfRoot.position.x );\r\n\tikRoot.setDoFValue( DOF.Y, urdfRoot.position.y );\r\n\tikRoot.setDoFValue( DOF.Z, urdfRoot.position.z );\r\n\r\n\ttempEuler.copy( urdfRoot.rotation );\r\n\ttempEuler.reorder( 'ZYX' );\r\n\tikRoot.setDoFValue( DOF.EX, tempEuler.x );\r\n\tikRoot.setDoFValue( DOF.EY, tempEuler.y );\r\n\tikRoot.setDoFValue( DOF.EZ, tempEuler.z );\r\n\r\n\tikRoot.traverse( c => {\r\n\r\n\t\tif ( c.isJoint ) {\r\n\r\n\t\t\tconst name = c.name;\r\n\t\t\tif ( name in urdfRoot.joints ) {\r\n\r\n\t\t\t\tc.setDoFValues( urdfRoot.joints[ name ].angle );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t} );\r\n\r\n}\r\n\r\nexport function setUrdfFromIK( urdfRoot, ikRoot ) {\r\n\r\n\tikRoot.updateMatrixWorld();\r\n\turdfRoot.matrix.set( ...ikRoot.matrixWorld ).transpose();\r\n\turdfRoot.matrix.decompose(\r\n\t\turdfRoot.position,\r\n\t\turdfRoot.quaternion,\r\n\t\turdfRoot.scale,\r\n\t);\r\n\r\n\t// urdfRoot.position.set(\r\n\t// \tikRoot.getDoFValue( DOF.X ),\r\n\t// \tikRoot.getDoFValue( DOF.Y ),\r\n\t// \tikRoot.getDoFValue( DOF.Z ),\r\n\t// );\r\n\t// urdfRoot.rotation.set(\r\n\t// \tikRoot.getDoFValue( DOF.EX ),\r\n\t// \tikRoot.getDoFValue( DOF.EY ),\r\n\t// \tikRoot.getDoFValue( DOF.EZ ),\r\n\t// );\r\n\r\n\tikRoot.traverse( c => {\r\n\r\n\t\tif ( c.isJoint ) {\r\n\r\n\t\t\tconst ikJoint = c;\r\n\t\t\tconst urdfJoint = urdfRoot.joints[ c.name ];\r\n\t\t\tif ( urdfJoint ) {\r\n\r\n\t\t\t\tif ( urdfJoint.jointType === 'prismatic' ) {\r\n\r\n\t\t\t\t\turdfJoint.setJointValue( ikJoint.getDoFValue( DOF.Z ) );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\turdfJoint.setJointValue( ikJoint.getDoFValue( DOF.EZ ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t} );\r\n\r\n}\r\n"],
  "mappings": "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AAY;AAAA,EACb,CAAE;AAAA,EAEF;AAAA;AAAA,IACU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAsOV;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",
  "names": ["solve", "identity", "invert", "create", "create", "len", "magnitude", "mat", "scale", "add", "clone", "copy", "create", "dot", "equals", "exactEquals", "fromValues", "identity", "invert", "len", "length", "lerp", "mul", "multiply", "normalize", "random", "rotateX", "rotateY", "rotateZ", "scale", "set", "slerp", "sqrLen", "squaredLength", "str", "add", "clone", "copy", "create", "equals", "exactEquals", "fromValues", "mul", "multiply", "rotateX", "rotateY", "rotateZ", "round", "scale", "set", "str", "sub", "subtract", "create", "clone", "fromValues", "copy", "set", "add", "subtract", "multiply", "round", "scale", "len", "angle", "rotateX", "rotateY", "rotateZ", "str", "exactEquals", "equals", "sub", "mul", "add", "ceil", "clone", "copy", "create", "cross", "dist", "distance", "div", "divide", "dot", "equals", "exactEquals", "floor", "forEach", "fromValues", "inverse", "len", "length", "lerp", "max", "min", "mul", "multiply", "negate", "normalize", "random", "round", "scale", "scaleAndAdd", "set", "sqrDist", "sqrLen", "squaredDistance", "squaredLength", "str", "sub", "subtract", "transformMat4", "transformQuat", "zero", "create", "clone", "fromValues", "copy", "set", "add", "subtract", "multiply", "divide", "ceil", "floor", "min", "max", "round", "scale", "scaleAndAdd", "distance", "squaredDistance", "length", "squaredLength", "negate", "inverse", "normalize", "len", "dot", "cross", "lerp", "random", "transformMat4", "transformQuat", "zero", "str", "exactEquals", "equals", "sub", "mul", "div", "dist", "sqrDist", "sqrLen", "forEach", "create", "identity", "dot", "multiply", "rotateX", "rotateY", "rotateZ", "scale", "slerp", "random", "invert", "str", "clone", "fromValues", "copy", "set", "add", "mul", "lerp", "length", "len", "squaredLength", "sqrLen", "normalize", "exactEquals", "equals", "create", "forEach", "create", "tempQuat", "d1", "d2", "tempPos", "tempQuat", "tempPos2", "tempQuat2", "tempInverse", "tempMatrix", "tempQuat", "min", "max", "tempPos", "tempQuat", "tempEuler", "SVD", "transpose", "identity", "scale", "multiply", "create", "copy", "clone", "linearSolve", "invert", "add", "subtract", "str", "tempQuat", "tempPos", "tempQuat2", "tempPos2", "freeJoints", "l", "targetJoints", "dof", "dofResultInfo", "set", "_box", "distance", "length", "tempMatrix", "tempPos", "min", "max", "links", "tempEuler"]
}
